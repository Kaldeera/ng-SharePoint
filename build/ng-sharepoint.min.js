/*
 * ng-sharepoint
 * https://github.com/Kaldeera/ng-sharepoint/
 * Pau Codina & Pedro Castro - Kaldeera
 * Version: 0.0.1 - 2016-04-27
 * License: MIT
 */
function OnIframeLoadFinish(){var a;if("undefined"!=typeof this.Picker&&(a=this.Picker),null!==a&&"undefined"!=typeof a.readyState&&null!==a.readyState&&"complete"===a.readyState)if(document.body.scrollLeft=g_scrollLeft,document.body.scrollTop=g_scrollTop,g_scrollTop=document.getElementById("s4-workspace").scrollTop,a.style.display="block","undefined"!=typeof document.frames&&Boolean(document.frames)){var b=document.frames[a.id];null!==b&&"function"==typeof b.focus&&b.focus()}else a.focus();setTimeout(function(){document.getElementById("s4-workspace").scrollTop=g_scrollTop},1)}String.prototype.ltrim=function(a){return this.replace(new RegExp("^"+a),"")},String.prototype.rtrim=function(a){return this.replace(new RegExp(a+"*$"),"")},String.prototype.trimS=function(a){return this.replace(new RegExp("^"+a),"").replace(new RegExp(a+"*$"),"")};var utils={isGuid:function(a){var b=new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$");return b.test((a||"").trim().ltrim("{").rtrim("}"))},getQueryStringParameter:function(a){var b=window.location.search.split("?");if(b.length>1){b=b[1].split("&");for(var c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]==a)return d[1]}}},getQueryStringParamByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null!==d?decodeURIComponent(d[1].replace(/\+/g," ")):void 0},parseQuery:function(a){if(void 0===a)return"";var b="";return angular.forEach(a,function(a,c){var d=c+"="+a;"restfunc"===c.toLowerCase()&&(d="$"+a),b+=(""===b?"?":"&")+d}),b},parseError:function(a){var b={data:a.data,code:a.errorCode,message:a.errorMessage};try{var c=a.data.body.rtrim("\x00");if(-1!=a.data.contentType.indexOf("application/json")){var d=angular.fromJson(c).error;b.code=d.code,b.message=d.message.value}else b.message=c}catch(e){}return b},parseSPResponse:function(a){var b={};if(204!==a.statusCode&&204!==a.status&&(b=angular.fromJson(a.body||a.data||'{ "d": {} }').d,b.results&&(b=b.results)),null!==a.headers&&a.headers["X-REQUESTDIGEST"]){var c=document.getElementById("__REQUESTDIGEST");null!==c&&(c.value=a.headers["X-REQUESTDIGEST"])}return b},cleanDeferredProperties:function(a){var b=a;angular.forEach(a,function(a,c){"object"==typeof a&&null!==a&&"__parent"!==c&&(a.__deferred?delete b[c]:utils.cleanDeferredProperties(a))})},getFunctionParameterNames:function(a){var b=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,d=a.toString().replace(b,""),e=d.slice(d.indexOf("(")+1,d.indexOf(")")).match(c);return e||[]},extend:function(a){if("object"!=typeof a)return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},deepExtend:function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var a,b,c,d,e=arguments[0],f=Array.prototype.slice.call(arguments,1);return f.forEach(function(f){if("object"==typeof f)for(a in f)a in f&&(c=e[a],b=f[a],b!==e&&("object"==typeof b&&null!==b?b instanceof Date?e[a]=new Date(b.getTime()):b instanceof RegExp?e[a]=new RegExp(b):"object"==typeof c&&null!==c?(d=Array.isArray(b)?Array.isArray(c)?c:[]:Array.isArray(c)?{}:c,e[a]=utils.deepExtend(d,b)):(d=Array.isArray(b)?[]:{},e[a]=utils.deepExtend(d,b)):e[a]=b))}),e}};angular.module("CamlHelper",[]).value("CamlOperatorEnumerator",{CamlQueryOperator:{BeginsWith:"BeginsWith",Contains:"Contains",DateRangesOverlap:"DateRangesOverlap",Eq:"Eq",Geq:"Geq",Gt:"Gt",In:"In",Includes:"Includes",IsNotNull:"IsNotNull",IsNull:"IsNull",Leq:"Leq",Lt:"Lt",Neq:"Neq",NotIncludes:"NotIncludes"}}).provider("CamlQueryHelperProvider",function(){"use strict";var a=function(a){this.CamlQueryHelper=function(){return{Query:"",OrderByFields:"",GroupByFiels:"",Wrap:function(a,b){return"<"+a+">"+b+"</"+a+">"},Join:function(b,c,d,e,f){var g;g=f?"<FieldRef Name='"+c+"' LookupId='True' />":"<FieldRef Name='"+c+"' />";var h=b,i="";switch(b){case a.CamlQueryOperator.In:e=e.replace("[",""),e=e.replace("]","");var j=e.split(","),k="<Values>";j.forEach(function(a){var b=a.trim(),c="";c=isNaN(parseInt(b))?"<Value Type='Text'>"+b+"</Value>":"<Value Type='Integer'>"+b+"</Value>",k+=c}),k+="</Values>",i=g+k;break;case a.CamlQueryOperator.IsNull:case a.CamlQueryOperator.IsNotNull:i=g;break;default:var l="<Value Type='"+d+"'>"+e+"</Value>";i=g+l}return this.Wrap(h,i)},OrJoin:function(a,b,c,d,e){var f=this.Join(a,b,c,d,e);this.Query?(this.Query+=f,this.Query=this.Wrap("Or",this.Query)):this.Query+=f},AndJoin:function(a,b,c,d,e){var f=this.Join(a,b,c,d,e);this.Query?(this.Query+=f,this.Query=this.Wrap("And",this.Query)):this.Query+=f},AddOrderByField:function(a,b){this.OrderByFields+="<FieldRef Name='"+a+"' Ascending='"+b+"' />"},AddGroupByField:function(a){this.GroupByFiels+="<FieldRef Name='"+a+"' />"},ToString:function(){var a="",b="",c="";return this.Query&&(a=this.Wrap("Where",this.Query)),this.OrderByFields&&(b=this.Wrap("OrderBy",this.OrderByFields)),this.GroupByFiels&&(c=this.Wrap("GroupBy",this.GroupByFiels)),"<Query>"+a+c+b+"</Query>"}}}};this.$get=function(b){return new a(b)}}).provider("ODataSentencePartProvider",function(){var a=function(a){this.ODataSentencePart=function(b,c,d){return{Expression:b,Join:c,Fields:d,ProcessOk:!1,Operator:"",Left:"",Right:"",Field:"",Value:"",process:function(){if(this.testOperator(" eq ")&&this.processOperator(" eq ",a.CamlQueryOperator.Eq),this.testOperator(" ne ")&&this.processOperator(" ne ",a.CamlQueryOperator.Neq),this.testOperator(" gt ")&&this.processOperator(" gt ",a.CamlQueryOperator.Gt),this.testOperator(" ge ")&&this.processOperator(" ge ",a.CamlQueryOperator.Geq),this.testOperator(" lt ")&&this.processOperator(" lt ",a.CamlQueryOperator.Lt),this.testOperator(" le ")&&this.processOperator(" le ",a.CamlQueryOperator.Leq),this.testOperator(" lt ")&&this.processOperator(" lt ",a.CamlQueryOperator.Lt),this.testOperator(" in ")&&this.processOperator(" in ",a.CamlQueryOperator.In),this.testOperator(" contains ")&&this.processOperator(" contains ",a.CamlQueryOperator.Contains),this.testOperator(" beginswith ")&&this.processOperator(" beginswith ",a.CamlQueryOperator.Contains),this.testOperator(" isnull")&&this.processOperator(" isnull",a.CamlQueryOperator.IsNull),this.testOperator(" isnotnull")&&this.processOperator(" isnotnull",a.CamlQueryOperator.IsNotNull),!this.ProcessOk)throw"Invalid sentence: "+this.Expression;if(!this.isValidFieldInternalName(this.Fields,this.Left,this.Right)&&!this.isValidFieldInternalName(this.Fields,this.Right,this.Left))throw"Invalid sentence, any valid field vas specified ("+this.Expression+")"},isValidFieldInternalName:function(a,b,c){try{return this.Field=this.Fields.Fields[b],this.Value=c,!0}catch(d){return!1}},processOperator:function(a,b){this.Operator=b;var c=this.Expression.indexOf(a);this.Left=this.Expression.substring(0,c),this.Right=this.Expression.substring(c+a.length),this.ProcessOk=!0},testOperator:function(a){return-1==this.Expression.toLowerCase().indexOf(a)?!1:!0}}}};this.$get=function(b){return new a(b)}}).provider("ODataParserProvider",function(){var a=function(a,b){this.ODataParser=function(c){if(void 0===c)throw"fieldsSchema not specified";return{Filter:"",Sort:"",Select:"",Top:"",Paging:!1,Skip:"",Sentences:[],FieldsSchema:c,parseExpression:function(a){this.Filter="",this.Sort="",this.Select="",this.Top="",this.Skip="",this.GroupBy="",this.Paging=!1,void 0!==a.filter&&(this.Filter=a.filter),void 0!==a.orderBy&&(this.Sort=a.orderBy),void 0!==a.select&&(this.Select=a.select),void 0!==a.groupBy&&(this.GroupBy=a.groupBy),void 0!==a.top&&(this.Top=a.top),void 0!==a.paging&&(this.Paging=a.paging),void 0!==a.skip&&(this.Skip=a.skip);for(var b=this.Filter;b.length>0;){var c=this.getNextSentence(b),d=c.dataSentencePart;d.process(),b=c.expression,this.Sentences.push(d)}},getCAMLQuery:function(){var b="",c=a.CamlQueryHelper();this.Sentences.reverse();for(var d=0;d<this.Sentences.length;d++){var e=!1,f=this.Sentences[d];if("Lookup"==f.Field.get_typeAsString()||"User"==f.Field.get_typeAsString()||"LookupMulti"==f.Field.get_typeAsString()||"UserMulti"==f.Field.get_typeAsString()){var g=f.Value;g=g.replace("[",""),g=g.replace("]","");var h=g.split(",");e=isNaN(parseInt(h[0]))?!1:!0}switch(f.Join){case"or":c.OrJoin(f.Operator,f.Field.get_internalName(),f.Field.get_typeAsString(),f.Value,e);break;default:c.AndJoin(f.Operator,f.Field.get_internalName(),f.Field.get_typeAsString(),f.Value,e)}}if(this.Sort.length>0)for(var i=this.Sort.split(","),j=0;j<i.length;j++)if(""!==i[j]){var k=i[j],l=k.trim().split(" ");try{var m=this.FieldsSchema.Fields[l[0]],n=!0;l.length>1&&"desc"==l[1].trim().toLowerCase()&&(n=!1),c.AddOrderByField(m.get_internalName(),n)}catch(o){throw o}}if(void 0!==this.GroupBy&&""!==this.GroupBy)for(var p=this.GroupBy.split(","),q=0;q<p.length;q++){var r=p[q].trim();r.length>0&&c.AddGroupByField(r)}b=c.ToString();var s="";void 0!==this.Top&&""!==this.Top&&(s+="<RowLimit Paged='TRUE'>"+this.Top+"</RowLimit>");var t="";if(this.Select.length>0){t="<ViewFields>";for(var u=this.Select.split(","),v=0;v<u.length;v++){var w=u[v].trim();w.length>0&&(t+="<FieldRef Name='"+w+"' />")}t+="</ViewFields>"}return"<View>"+t+b+s+"</View>"},getNextSentence:function(a){var c=-1,d=" and ";c=a.toLowerCase().indexOf(d),-1==c&&(d=" or ",c=a.toLowerCase().indexOf(d)),-1==c&&(c=a.length,d="");var e=a.substring(0,c);a=a.substring(c+d.length);var f=b.ODataSentencePart(e,d.trim(),this.FieldsSchema),g={expression:a,dataSentencePart:f};return g}}}};this.$get=function(b,c,d){return new a(b,c,d)}}),angular.module("ngSharePoint",["CamlHelper"]),angular.module("ngSharePoint").config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]),angular.module("ngSharePoint").value("Constants",{errorTemplate:"templates/error.html",userProfileUrl:"_layouts/userdisp.aspx?ID="}),angular.module("ngSharePoint").provider("SharePoint",[function(){"use strict";var a=function(a,b,c,d){this.getCurrentWeb=function(){return this.getWeb()},this.getWeb=function(a){var e=b.defer();return c.SharePointReady().then(function(){new d(a).then(function(a){e.resolve(a)})}),e.promise}};this.$get=function(b,c,d,e){return new a(b,c,d,e)}}]),angular.module("ngSharePoint").factory("SPCache",["$q","$cacheFactory",function(a,b){"use strict";return{getCache:function(a){var c=b.get(a);return void 0===c&&(c=b(a)),c},getCacheValue:function(a,b){return this.getCache(a).get(b)},setCacheValue:function(a,b,c){this.getCache(a).put(b,c)},removeCacheValue:function(a,b){this.getCache(a).remove(b)}}}]),angular.module("ngSharePoint").provider("SPConfig",[function(){"use strict";var a=this;a.options={force15LayoutsDirectory:!1,loadMinimalSharePointInfraestructure:!0,forceLoadResources:!1,resourceFiles:function(){var b=function(){var b=["core"];this.get=function(){return b},this.add=function(c){var d=!1;angular.isArray(c)?anfular.forEach(c,function(a){angular.isString(a)&&(b.push(a),d=!0)}):angular.isString(c)&&(b.push(c),d=!0),d&&(a.options.forceLoadResources=!0)}};return new b}()},a.$get=function(){var b=function(){};return b.options=a.options,b}}]),angular.module("ngSharePoint").factory("SPContentType",["$q","SPCache","SPFolder","SPListItem",function(a,b){"use strict";var c=function(a,c,d){if(void 0===a)throw"@parentObject parameter not specified in SPContentType constructor.";if(void 0===c)throw"@id parameter not specified in SPContentType constructor.";if(this.id=c,this.__parent=a,this.apiUrl=this.__parent.apiUrl+"/ContentTypes('"+this.id+"')",this.Fields=b.getCacheValue("SPContentTypeFieldsCache",this.apiUrl),void 0!==d){if(void 0!==d.Fields&&void 0!==d.Fields.results){var e={};angular.forEach(d.Fields.results,function(a){e[a.InternalName]=a}),d.Fields=e}utils.cleanDeferredProperties(d),angular.extend(this,d)}};return c.prototype.getFields=function(){var c=this,d=a.defer();if(void 0!==this.Fields)d.resolve(this.Fields);else{var e=new SP.RequestExecutor("/");e.executeAsync({url:c.apiUrl+"/Fields",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a),f={};angular.forEach(e,function(a){f[a.InternalName]=a}),c.Fields=f,b.setCacheValue("SPContentTypeFieldsCache",c.apiUrl,f),d.resolve(f)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},c.prototype.setJSLink=function(b){var c,d=this,e=a.defer();d.__parent.url&&(c=d.__parent.url),void 0===c&&d.__parent.web&&(c=d.__parent.web.url);var f;f=void 0===c?SP.ClientContext.get_current():new SP.ClientContext(c);var g=f.get_web(),h=g.get_lists().getByTitle(d.__parent.Title),i=h.get_contentTypes(),j=i.getById(d.id);return j.set_jsLink(b),j.update(),f.executeQueryAsync(function(){e.resolve(j)},function(a,b){e.reject({sender:a,args:b})}),e.promise},c.prototype.getJSLink=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor("/");return d.executeAsync({url:b.apiUrl+"/jsLink",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);c.resolve(b)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c}]),angular.module("ngSharePoint").factory("SPExpressionResolvercurrentUser",["SharePoint",function(a){"use strict";function b(a){for(var b,c=[];b=d.exec(a);)b.shift(),c.push(b.join(""));return c}function c(a,b,c){if(void 0!==a.expressions){var d={currentUser:{}};if(angular.isArray(b)){for(var e=c,f=b.length-1;f>0;f--){var g=e;e={},e[b[f]]=g}d.currentUser[b[0]]=e}else d.currentUser[b]=c;a.expressions=utils.deepExtend(d,a.expressions)}}var d=/[\[./]([\w )]+)/g;return{resolve:function(d,e){return a.getCurrentWeb().then(function(a){return a.getList("UserInfoList").then(function(a){var f=b(d);return a.getItemProperty(_spPageContextInfo.userId,f.join("/")).then(function(a){var b=a[f[f.length-1]];return c(e,f,b),"expressions.currentUser."+f.join(".")},function(){return"expressions.currentUser."+f.join(".")})})})}}}]),angular.module("ngSharePoint").factory("SPExpressionResolveritem",[function(){"use strict";function a(a){for(var b,d=[];b=c.exec(a);)b.shift(),d.push(b.join(""));return d}function b(a,b,c){if(void 0!==a.expressions){var d={item:{}};if(angular.isArray(b)){for(var e=c,f=b.length-1;f>0;f--){var g=e;e={},e[b[f]]=g}d.item[b[0]]=e}else d.item[b]=c;a.expressions=utils.deepExtend(d,a.expressions)}}var c=/[\[./]([\w )]+)/g;return{resolve:function(c,d){var e=a(c);if(1==e.length){var f=d.item[e[0]];return b(d,e[0],f),"expressions.item."+e[0]}return d.item.list.getItemProperty(d.item.Id,e.join("/")).then(function(a){var c=a[e[e.length-1]];return b(d,e,c),"expressions.item."+e.join(".")},function(){return"expressions.item."+e.join(".")})}}}]),angular.module("ngSharePoint").factory("SPExpressionResolverlist",[function(){"use strict";function a(a){for(var b,d=[];b=c.exec(a);)b.shift(),d.push(b.join(""));return d}function b(a,b,c){if(void 0!==a.expressions){var d={list:{}};if(angular.isArray(b)){for(var e=c,f=b.length-1;f>0;f--){var g=e;e={},e[b[f]]=g}d.list[b[0]]=e}else d.list[b]=c;a.expressions=utils.deepExtend(d,a.expressions)}}var c=/[\[./]([\w )]+)/g;return{resolve:function(c,d){var e=a(c);return d.item.list.getProperties().then(function(a){var c=a[e[0]];return b(d,e[0],c),"expressions.list."+e[0]})}}}]),angular.module("ngSharePoint").factory("SPExpressionResolverparam",[function(){"use strict";function a(a){for(var c,d=[];c=b.exec(a);)c.shift(),d.push(c.join(""));return d}var b=/[\[./]([\w )]+)/g;return{resolve:function(b,c){var d=a(b)[0],e=utils.getQueryStringParamByName(d);if(void 0!==c.expressions){var f={param:{}};f.param[d]=e,c.expressions=utils.deepExtend(f,c.expressions)}return"expressions.param."+d}}}]),angular.module("ngSharePoint").factory("SPExpressionResolverweb",[function(){"use strict";function a(a){for(var b,d=[];b=c.exec(a);)b.shift(),d.push(b.join(""));return d}function b(a,b,c){if(void 0!==a.expressions){var d={web:{}};if(angular.isArray(b)){for(var e=c,f=b.length-1;f>0;f--){var g=e;e={},e[b[f]]=g}d.web[b[0]]=e}else d.web[b]=c;a.expressions=utils.deepExtend(d,a.expressions)}}var c=/[\[./]([\w )]+)/g;return{resolve:function(c,d){var e=a(c);return d.item.list.web.getProperties().then(function(a){var c=a[e[0]];return b(d,e[0],c),"expressions.web."+e[0]})}}}]),angular.module("ngSharePoint").provider("SPExpressionResolver",[function(){"use strict";var a={},b=function(b,c,d,e){function f(d,e,g,h){g=g||0,h=h||c.defer();var i=d[g++];if(void 0===i)return h.resolve(),h.promise;var j=i.substring(0,i.indexOf(/\W/.exec(i))),k="SPExpressionResolver"+j;void 0!==a[j]&&(k=a[j]);var l=b.get(k),m=l.resolve(i,e);return c.when(m).then(function(a){d[g-1]=a,f(d,e,g,h)},function(a){d[g-1]=a,f(d,e,g,h)}),h.promise}var g=/{(\w+\W*[\w\s./\[\]\(\)]+)}(?!})/g;this.resolve=function(a,b){var d=c.defer(),e=[];return angular.isString(a)&&(a=a.replace(g,function(a,b){var c=e.indexOf(b);return-1==c&&(e.push(b),c=e.length-1),"{e:"+c+"}"})),f(e,b).then(function(){for(var b=0;b<e.length;b++)a=a.replace(new RegExp("{e:"+b+"}","g"),e[b]);d.resolve(a)}),d.promise}};this.$get=function(a,c,d,e){return new b(a,c,d,e)}}]),angular.module("ngSharePoint").service("SPFieldDirective",["$compile","$http","$templateCache","$q","SPUtils",function(a,b,c,d,e){function f(){var a=this.modelCtrl.$viewValue;angular.isDefined(a)||(a=null),this.modelCtrl.$setViewValue(a)}function g(a,b){a!==b&&this.modelCtrl.$setViewValue(a)}this.baseLinkFn=function(h,i,j,k){var l=this;h.formCtrl=k[0],h.modelCtrl=k[1],h.name=j.name,l.name=h.name,h.schema=h.formCtrl.getFieldSchema(j.name),h.item=h.formCtrl.getItem(),h.currentMode=h.mode||h.formCtrl.getFormMode(),h.formCtrl.registerField(this),h.$on("$destroy",function(){h.formCtrl.unregisterField(l)}),angular.isFunction(l.parserFn)&&h.modelCtrl.$parsers.unshift(l.parserFn),angular.isFunction(l.formatterFn)&&h.modelCtrl.$formatters.unshift(l.formatterFn),l.setElementHTML=function(b){if(l.replaceAll===!0){var c=a(b)(h);i.replaceWith(c),i=c}else i.html(b),a(i)(h)},l.getFieldTemplate=function(){var a=d.defer(),e="templates/form-templates/spfield-"+l.fieldTypeName+"-"+h.currentMode+".html";return"display"===h.currentMode&&l.displayTemplateUrl&&(e=l.displayTemplateUrl),"edit"===h.currentMode&&l.editTemplateUrl&&(e=l.editTemplateUrl),b.get(e,{cache:c}).success(function(d){if(angular.isDefined(h.schema)&&angular.isDefined(h.schema.extendedTemplate)){var e=d,f=h.schema.extendedTemplate;angular.isDefined(f[h.currentMode])&&(f=f[h.currentMode]);var g="display"===h.currentMode&&f.replaceOnDisplay===!0||"edit"===h.currentMode&&f.replaceOnEdit===!0||f.replace===!0;angular.isDefined(f.url)?b.get(f.url,{cache:c}).success(function(b){e=g?b:d+b,a.resolve(e)}):angular.isDefined(f.html)?(e=g?f.html:d+f.html,a.resolve(e)):a.resolve(e)}else a.resolve(d)}),a.promise},l.renderField=function(){l.getFieldTemplate().then(function(a){l.setElementHTML(a),angular.isFunction(l.postRenderFn)&&l.postRenderFn.apply(l,arguments)})},l.setValidity=function(a,b){"edit"===h.currentMode&&h.modelCtrl.$setValidity(a,b)},l.validate=function(){if("edit"===h.currentMode){var a=d.defer();return h.modelCtrl.$dirty=!0,f.apply(h,arguments),angular.isFunction(l.onValidateFn)?d.when(l.onValidateFn.apply(l,arguments)).then(function(){void 0!==h.schema&&void 0!==h.schema.onValidate?d.when(e.callFunctionWithParams(h.schema.onValidate,h)).then(function(){a.resolve()}):a.resolve()}):void 0!==h.schema&&void 0!==h.schema.onValidate?d.when(e.callFunctionWithParams(h.schema.onValidate,h)).then(function(){a.resolve()}):a.resolve(),a.promise}},h.modelCtrl.$render=function(){angular.isFunction(l.renderFn)?l.renderFn(l,arguments):h.value=h.modelCtrl.$viewValue};var m=!0;angular.isFunction(l.init)&&(m=l.init()),d.when(m).then(function(){h.$watch(function(){return h.mode||h.formCtrl.getFormMode()},function(a){h.currentMode=a,angular.isFunction(l.watchModeFn)?l.watchModeFn.apply(l,arguments):l.renderField()}),h.$watch("value",function(){g.apply(h,arguments),angular.isFunction(l.watchValueFn)&&l.watchValueFn.apply(l,arguments)},!0)})}}]),angular.module("ngSharePoint").factory("SPFile",["SPObjectProvider","$q","$http",function(a,b,c){"use strict";var d=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPFile constructor.";if(void 0===b)throw"@path parameter not specified in SPFile constructor.";this.web=a,this.apiUrl="/GetfileByServerRelativeUrl('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return d.prototype.updateAPIUrlById=function(a,b){if(void 0===a)throw"@list parameter not specified in updateAPIUrlById.";if(void 0===b)throw"@itemId parameter not specified in updateAPIUrlById.";this.apiUrl=a.apiUrl+"/GetItemById("+b+")/file"},d.prototype.getProperties=function(a){var c=this,d=b.defer(),e=new SP.RequestExecutor(c.web.url);return e.executeAsync({url:c.apiUrl+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(c,b),d.resolve(c)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},d.prototype.getList=function(){var c=b.defer(),d=this;if(void 0===this.List&&void 0!==this.ListItemAllFields&&void 0!==this.ListItemAllFields.ParentList){var e=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);this.List=e}return void 0!==this.List?c.resolve(this.List):this.getProperties({$expand:"ListItemAllFields,ListItemAllFields/ParentList"}).then(function(){var b=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);d.List=b,c.resolve(b)}),c.promise},d.prototype.getFileListItem=function(){var c=b.defer(),d=this;return void 0!==this.ListItem?c.resolve(this.ListItem):void 0!==this.List?this.getProperties({$expand:"ListItemAllFields,ListItemAllFields/ParentList"}).then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),d.updateAPIUrlById(d.List,d.ListItem.Id),c.resolve(d.ListItem)}):this.getList().then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),d.updateAPIUrlById(d.List,d.ListItem.Id),c.resolve(d.ListItem)}),c.promise},d.prototype.rename=function(a){var c=this,d=b.defer();return this.getFileListItem().then(function(){var b=c.List.Id,e=c.ListItem.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(b);c._fileItem=h.getItemById(e),c._fileItem.set_item("FileLeafRef",a),c._fileItem.update(),f.load(c._fileItem),f.executeQueryAsync(function(){c.getProperties().then(function(){d.resolve()})},function(a,b){var c={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};d.reject(c)})}),d.promise},d.prototype.removeFile=function(a){var c=this,d=b.defer(),e={Accept:"application/json; odata=verbose"},f=c.apiUrl+"/recycle";a===!0&&(f=f.rtrim("/recycle"),e["X-HTTP-Method"]="DELETE");var g=new SP.RequestExecutor(c.web.url);return g.executeAsync({url:f,method:"POST",headers:e,success:function(){d.resolve()},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},d.prototype.moveFile=function(a){var d=this,e=b.defer(),f={Accept:"application/json; odata=verbose"},g=document.getElementById("__REQUESTDIGEST");null!==g&&(f["X-RequestDigest"]=g.value);var h=d.apiUrl+"/moveto(newurl='"+a+"/"+d.Name+"',flags=1)";return c({method:"POST",url:h,headers:f}).then(function(){e.resolve()},function(a){var b=utils.parseError({data:a.data.error,errorCode:a.data.error.code,errorMessage:a.data.error.message});b.data.body=b.data.message.value,b.message=b.data.code,e.reject(b)}),e.promise},d.prototype.copyFile=function(a){var d=this,e=b.defer(),f={Accept:"application/json; odata=verbose"},g=document.getElementById("__REQUESTDIGEST");null!==g&&(f["X-RequestDigest"]=g.value);var h=d.apiUrl+"/copyto(strnewurl='"+a+"/"+d.Name+"',boverwrite=true)";return c({method:"POST",url:h,headers:f}).then(function(){e.resolve()},function(a){var b=utils.parseError({data:a.data.error,errorCode:a.data.error.code,errorMessage:a.data.error.message});b.data.body=b.data.message.value,b.message=b.data.code,e.reject(b)}),e.promise},d.prototype.checkOut=function(){var a=this,c=b.defer(),d=a.apiUrl+"/checkout",e=new SP.RequestExecutor(a.web.url);return e.executeAsync({url:d,method:"POST",success:function(){a.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){c.resolve()})},error:function(b,d,e){var f=utils.parseError({data:b,errorCode:d,errorMessage:e});a.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){c.reject(f)})}}),c.promise},d.prototype.undoCheckOut=function(){var a=this,c=b.defer(),d=a.apiUrl+"/undocheckout",e=new SP.RequestExecutor(a.web.url);return e.executeAsync({url:d,method:"POST",success:function(){a.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){delete a.CheckedOutByUser,c.resolve()})},error:function(b,d,e){var f=utils.parseError({data:b,errorCode:d,errorMessage:e});a.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){c.reject(f)})}}),c.promise},d.prototype.checkIn=function(a){var c=this,d=b.defer();return a=a||"",c.getFileListItem().then(function(){var b=c.List.Id,e=c.ListItemAllFields.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(b),i=h.getItemById(e);c._file=i.get_file(),c._file.checkIn(a,1),f.load(c._file),f.executeQueryAsync(function(){c.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){delete c.CheckedOutByUser,d.resolve()})},function(a,b){var e={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){d.reject(e)})})}),d.promise},d}]),angular.module("ngSharePoint").factory("SPFolder",["SPObjectProvider","SPUtils","$q",function(a,b,c){"use strict";var d=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPFolder constructor.";if(void 0===b)throw"@path parameter not specified in SPFolder constructor.";this.web=a,this.apiUrl="/GetFolderByServerRelativeUrl('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return d.prototype.getProperties=function(a){var b=this,d=c.defer(),e=new SP.RequestExecutor(b.web.url);return e.executeAsync({url:b.apiUrl+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var c=utils.parseSPResponse(a);utils.cleanDeferredProperties(c),angular.extend(b,c),d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},d.prototype.getFiles=function(b){var d=this,e=c.defer(),f=new SP.RequestExecutor(d.web.url);return f.executeAsync({url:d.apiUrl+"/Files"+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(b){var c=utils.parseSPResponse(b),f=[];angular.forEach(c,function(b){var c=a.getSPFile(d.web,b.ServerRelativeUrl,b);void 0!=d.List&&(c.List=d.List),f.push(c)}),e.resolve(f)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.getFolders=function(a){var b=this,e=c.defer(),f=new SP.RequestExecutor(b.web.url);return f.executeAsync({url:b.apiUrl+"/Folders"+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var c=utils.parseSPResponse(a),f=[];angular.forEach(c,function(a){var c=new d(b.web,a.ServerRelativeUrl,a);void 0!==b.List&&(c.List=b.List),f.push(c)}),e.resolve(f)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.getList=function(){var b=c.defer(),d=this;if(void 0===this.List&&void 0!==this.ListItemAllFields&&void 0!==this.ListItemAllFields.ParentList){var e=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);this.List=e}return void 0!==this.List?b.resolve(this.List):this.getProperties({$expand:"ListItemAllFields,ListItemAllFields/ParentList"}).then(function(){var c=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);d.List=c,b.resolve(c)}),b.promise},d.prototype.getFolderListItem=function(){var b=c.defer(),d=this;return void 0!==this.ListItem?b.resolve(this.ListItem):this.getList().then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),b.resolve(d.ListItem)}),b.promise},d.prototype.addFolder=function(a){var b=this,e=c.defer(),f=(b.ServerRelativeUrl||"").rtrim("/")+"/"+a,g=b.apiUrl+"/folders",h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value);var j=new SP.RequestExecutor(b.web.url),k={__metadata:{type:"SP.Folder"},ServerRelativeUrl:f};return j.executeAsync({url:g,method:"POST",headers:h,body:angular.toJson(k),success:function(a){var c=utils.parseSPResponse(a),g=new d(b.web,f,c);e.resolve(g)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.addFile=function(d,e,f){var g=this,h=c.defer(),i=(g.ServerRelativeUrl+"/"+d,g.apiUrl+"/files/add(url='"+d+"',overwrite="+(f===!1?"false":"true")+")"),j=new SP.RequestExecutor(g.web.url);return b.getFileBinary(e).then(function(b){var c={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},d=document.getElementById("__REQUESTDIGEST");null!==d&&(c["X-RequestDigest"]=d.value),j.executeAsync({url:i,method:"POST",headers:c,body:b,binaryStringRequestBody:!0,success:function(b){var c=utils.parseSPResponse(b),d=a.getSPFile(g.web,c.ServerRelativeUrl,c);d.List=g.List,h.resolve(d)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});h.reject(d)}})}),h.promise},d.prototype.rename=function(a){var b=this,d=c.defer();return this.getFolderListItem().then(function(){var c=b.List.Id,e=b.ListItem.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(c);b._folder=h.getItemById(e),b._folder.set_item("FileLeafRef",a),b._folder.update(),f.load(b._folder),f.executeQueryAsync(function(){b.Name=a,d.resolve()},function(a,b){var c={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};d.reject(c)})}),d.promise},d.prototype.removeFolder=function(a,b){var d,e=this,f=c.defer();if("string"==typeof a){var g=a;d=e.ServerRelativeUrl+"/"+g}else"object"==typeof a&&(d=a.ServerRelativeUrl);var h=e.web.apiUrl+"/GetFolderByServerRelativeUrl('"+d+"')/recycle";b===!0&&(h=h.rtrim("/recycle"));var i=new SP.RequestExecutor(e.web.url);return i.executeAsync({url:h,method:"POST",success:function(){f.resolve()},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},d}]),angular.module("ngSharePoint").factory("SPGroup",["$q","SPHttp","SPCache","SPObjectProvider",function(a,b,c,d){"use strict";var e=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPGroup constructor.";if(void 0===b)throw"@groupName parameter not specified in SPGroup constructor.";this.web=a,this.apiUrl="number"==typeof b?"/sitegroups/GetById('"+b+"')":"/sitegroups/GetByName('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return e.prototype.getProperties=function(){var a=this,c=a.apiUrl;return b.get(c).then(function(b){return utils.cleanDeferredProperties(b),angular.extend(a,b),a})},e.prototype.getOwner=function(){var a=this,c=a.apiUrl+"/Owner";
return b.get(c).then(function(b){utils.cleanDeferredProperties(b);var c;return c=8===b.PrincipalType?d.getSPGroup(a.web,b.Id,b):d.getSPUser(a.web,b.Id,b),a.Owner=c,a})},e.prototype.getUsers=function(){var c=this,e=c.apiUrl+"/Users",f=c.Users;return void 0===f&&(f=b.get(e).then(function(a){var b=[];return angular.forEach(a,function(a){b.push(d.getSPUser(c.web,a.Id,a))}),c.Users=b,b})),a.when(f)},e}]),angular.module("ngSharePoint").service("SPHttp",["$q","$http",function(a,b){"use strict";this.get=function(c){var d=a.defer();return b({url:c,method:"GET",headers:{Accept:"application/json; odata=verbose"}}).then(function(a){var b=utils.parseSPResponse(a);d.resolve(b)},function(a){var b=utils.parseError({data:a.config,errorCode:a.status,errorMessage:a.statusText});d.reject(b)}),d.promise},this.post=function(){}}]),angular.module("ngSharePoint").factory("SPList",["$q","SPHttp","SPCache","SPFolder","SPListItem","SPContentType","SPObjectProvider",function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,d){if(void 0===a)throw"@web parameter not specified in SPList constructor.";if(void 0===b)throw"@listName parameter not specified in SPList constructor.";this.web=a,this.listName=b.trim().ltrim("{").rtrim("}"),this.apiUrl=utils.isGuid(this.listName)?"/Lists(guid'"+this.listName+"')":"userinfolist"==this.listName.toLowerCase()?"/SiteUserInfoList":"/Lists/GetByTitle('"+this.listName+"')",this.apiUrl=a.apiUrl+this.apiUrl,this.Fields=c.getCacheValue("SPListFieldsCache",this.apiUrl),void 0!==d&&(utils.cleanDeferredProperties(d),angular.extend(this,d))};return h.prototype.getListItemEntityTypeFullName=function(){var b=this,c=a.defer();return this.ListItemEntityTypeFullName?c.resolve(this.ListItemEntityTypeFullName):b.getProperties().then(function(){c.resolve(b.ListItemEntityTypeFullName)}),c.promise},h.prototype.getProperties=function(b){var d=this,e=a.defer(),g="Views";if(b?b.$expand=g+(b.$expand?","+b.$expand:""):b={$expand:g},void 0!==this.Created){var h=!0;if(void 0!==b.$expand&&angular.forEach(b.$expand.split(/, */g),function(a){h=h&&void 0!==d[a]}),h)return e.resolve(this),e.promise}var i=new SP.RequestExecutor(d.web.url);return i.executeAsync({url:d.apiUrl+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);if(utils.cleanDeferredProperties(b),angular.extend(d,b),void 0!==d.Fields&&void 0!==d.Fields.results){var g={};angular.forEach(d.Fields.results,function(a){g[a.InternalName]=a}),d.Fields=g,c.setCacheValue("SPListFieldsCache",d.apiUrl,g)}if(void 0!==d.ContentTypes&&void 0!==d.ContentTypes.results){var h=[];angular.forEach(d.ContentTypes.results,function(a){h.push(new f(d,a.StringId,a))}),d.ContentTypes=h}e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},h.prototype.updateProperties=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f={__metadata:{type:"SP.List"}};angular.extend(f,b);var g={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*"},h=document.getElementById("__REQUESTDIGEST");return null!==h&&(g["X-RequestDigest"]=h.value),e.executeAsync({url:c.apiUrl,method:"POST",body:angular.toJson(f),headers:g,success:function(a){utils.parseSPResponse(a);angular.extend(c,b),d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},h.prototype.getFields=function(){var b=this,d=a.defer();if(void 0!==this.Fields)d.resolve(this.Fields);else{var e=new SP.RequestExecutor(b.web.url);e.executeAsync({url:b.apiUrl+"/Fields",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a),f={};angular.forEach(e,function(a){f[a.InternalName]=a}),b.Fields=f,c.setCacheValue("SPListFieldsCache",b.apiUrl,f),d.resolve(f)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},h.prototype.getContentTypes=function(){var b=this,c=a.defer();if(void 0!==this.ContentTypes)c.resolve(this.ContentTypes);else{var d=new SP.RequestExecutor(b.web.url);d.executeAsync({url:b.apiUrl+"/ContentTypes",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a),e=[];angular.forEach(d,function(a){e.push(new f(b,a.StringId,a))}),b.ContentTypes=e,c.resolve(e)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}})}return c.promise},h.prototype.getContentType=function(b){var c=this,d=a.defer();return c.getContentTypes().then(function(){var a=c.ContentTypes[0];angular.forEach(c.ContentTypes,function(c){c.StringId===b&&(a=c),c.Name===b&&(a=c)}),d.resolve(a)}),d.promise},h.prototype.getRootFolder=function(){var b=this,c=a.defer();if(void 0!==this.RootFolder)c.resolve(this.RootFolder);else{var e=new SP.RequestExecutor(b.web.url);e.executeAsync({url:b.apiUrl+"/RootFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a);this.RootFolder=new d(b.web,e.ServerRelativeUrl,e),this.RootFolder.List=b,c.resolve(this.RootFolder)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}})}return c.promise},h.prototype.getWorkflowAssociationByName=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f=utils.parseQuery({$filter:"enabled eq true and Name eq '"+b+"'"});return e.executeAsync({url:c.apiUrl+"/WorkflowAssociations"+f,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);d.resolve(b.length>0?b[0]:void 0)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},h.prototype.renderListData=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"};return e.executeAsync({url:c.apiUrl+"/renderlistdata()",method:"POST",body:angular.toJson({viewXml:b}),headers:f,success:function(a){var b=angular.fromJson(utils.parseSPResponse(a).RenderListData);angular.forEach(b.Row,function(a){angular.forEach(a,function(b,c){angular.isArray(b)&&1===b.length&&(a[c]=b[0])})}),d.resolve(b.Row)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},h.prototype.getListItems=function(b,c){var d=this,f=a.defer(),h=new SP.RequestExecutor(d.web.url),i="ContentType,File,File/ParentFolder,Folder,Folder/ParentFolder",j="";return void 0===this.$skiptoken||c?(b?(void 0!==b.$expand&&(b.$expand=b.$expand.substring(0,b.$expand.lastIndexOf(i))),b.$expand=i+(b.$expand?","+b.$expand:"")):b={$expand:i},j=utils.parseQuery(b)):j="?"+this.$skiptoken,h.executeAsync({url:d.apiUrl+"/Items"+j,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a),c=[];if(angular.forEach(b,function(a){if(void 0!==a.File&&void 0===a.File.__deferred){var b=g.getSPFile(d.web,a.File.ServerRelativeUrl,a.File);b.List=d,a.File=b}if(void 0!==a.Folder&&void 0===a.Folder.__deferred){var f=g.getSPFolder(d.web,a.Folder.ServerRelativeUrl,a.Folder);f.List=d,a.Folder=f}var h=new e(d,a);c.push(h)}),204!=a.statusCode&&a.body){var h=angular.fromJson(a.body||'{ "d": {} }').d;h.__next&&(d.$skiptoken="$"+h.__next.substring(h.__next.indexOf("skiptoken")))}f.resolve(c)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},h.prototype.getItemById=function(b,c){var d=this,f=a.defer(),h=new SP.RequestExecutor(d.web.url),i="ContentType,File,File/ParentFolder,Folder,Folder/ParentFolder",j={$expand:i+(c?","+c:"")};return h.executeAsync({url:d.apiUrl+"/getItemById("+b+")"+utils.parseQuery(j),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);if(void 0!==b.File&&void 0===b.File.__deferred){var c=g.getSPFile(d.web,b.File.ServerRelativeUrl,b.File);c.List=d,b.File=c}if(void 0!==b.Folder&&void 0===b.Folder.__deferred){var h=g.getSPFolder(d.web,b.Folder.ServerRelativeUrl,b.Folder);h.List=d,b.Folder=h}var i=new e(d,b);f.resolve(i)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},h.prototype.getItemProperty=function(b,c){var d=this,e=a.defer(),f=new SP.RequestExecutor(d.web.url);return f.executeAsync({url:d.apiUrl+"/getItemById("+b+")/"+c.ltrim("/"),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},h.prototype.getDefaultViewUrl=function(){var b=this,c=a.defer();if(void 0!==this.defaultViewUrl)return c.resolve(this.defaultViewUrl),c.promise;b.Id;b.context=new SP.ClientContext(b.web.url);var d=b.context.get_web();return b._list=void 0!==b.Id?d.get_lists().getById(b.Id):d.get_lists().getByTitle(b.listName),b.context.load(b._list,"DefaultViewUrl"),b.context.executeQueryAsync(function(){b.defaultViewUrl=b._list.get_defaultViewUrl(),c.resolve(b.defaultViewUrl)},function(a,b){var d={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.reject(d)}),c.promise},h.prototype.getDefaultEditFormUrl=function(){var b=this,c=a.defer();if(void 0!==this.defaultEditFormUrl)return c.resolve(this.defaultEditFormUrl),c.promise;b.Id;b.context=new SP.ClientContext(b.web.url);var d=b.context.get_web();return b._list=void 0!==b.Id?d.get_lists().getById(b.Id):d.get_lists().getByTitle(b.listName),b.context.load(b._list,"DefaultEditFormUrl"),b.context.executeQueryAsync(function(){b.defaultEditFormUrl=b._list.get_defaultEditFormUrl(),c.resolve(b.defaultEditFormUrl)},function(a,b){var d={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.reject(d)}),c.promise},h.prototype.getDefaultDisplayFormUrl=function(){var b=this,c=a.defer();if(void 0!==this.defaultDisplayFormUrl)return c.resolve(this.defaultDisplayFormUrl),c.promise;b.Id;b.context=new SP.ClientContext(b.web.url);var d=b.context.get_web();return b._list=void 0!==b.Id?d.get_lists().getById(b.Id):d.get_lists().getByTitle(b.listName),b.context.load(b._list,"DefaultDisplayFormUrl"),b.context.executeQueryAsync(function(){b.defaultDisplayFormUrl=b._list.get_defaultDisplayFormUrl(),c.resolve(b.defaultDisplayFormUrl)},function(a,b){var d={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.reject(d)}),c.promise},h.prototype.getDefaultNewFormUrl=function(){var b=this,c=a.defer();if(void 0!==this.defaultNewFormUrl)return c.resolve(this.defaultNewFormUrl),c.promise;b.Id;b.context=new SP.ClientContext(b.web.url);var d=b.context.get_web();return b._list=void 0!==b.Id?d.get_lists().getById(b.Id):d.get_lists().getByTitle(b.listName),b.context.load(b._list,"DefaultNewFormUrl"),b.context.executeQueryAsync(function(){b.defaultNewFormUrl=b._list.get_defaultNewFormUrl(),c.resolve(b.defaultNewFormUrl)},function(a,b){var d={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.reject(d)}),c.promise},h.prototype.createItem=function(b){var c=this,d=a.defer();return c.getListItemEntityTypeFullName().then(function(a){var e=new SP.RequestExecutor(c.web.url),f={__metadata:{type:a}};angular.extend(f,b);var g={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},h=document.getElementById("__REQUESTDIGEST");null!==h&&(g["X-RequestDigest"]=h.value),e.executeAsync({url:c.apiUrl+"/items",method:"POST",body:angular.toJson(f),headers:g,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}),d.promise},h.prototype.updateItem=function(b,c){var d=this,e=a.defer();return d.getListItemEntityTypeFullName().then(function(a){var f=new SP.RequestExecutor(d.web.url),g={__metadata:{type:a}};angular.extend(g,c);var h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value),f.executeAsync({url:d.apiUrl+"/items("+b+")",method:"POST",body:angular.toJson(g),headers:h,success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},h.prototype.deleteItem=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f={Accept:"application/json; odata=verbose","X-HTTP-Method":"DELETE","IF-MATCH":"*"},g=document.getElementById("__REQUESTDIGEST");return null!==g&&(f["X-RequestDigest"]=g.value),e.executeAsync({url:c.apiUrl+"/items("+b+")",method:"POST",headers:f,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},h}]),angular.module("ngSharePoint").factory("SPListItem",["$q","SPUtils",function(a,b){"use strict";var c=function(a,b){if(void 0===a)throw"Required @list parameter not specified in SPListItem constructor.";if(this.list=a,void 0!==b)if("object"==typeof b&&void 0===b.concat)void 0!==b.list&&delete b.list,utils.cleanDeferredProperties(b),angular.extend(this,b);else{if(isNaN(parseInt(b)))throw"Incorrect @data parameter in SPListItem constructor.";this.Id=b}};return c.prototype.isNew=function(){return void 0===this.Id},c.prototype.getAPIUrl=function(){var a=this.list.apiUrl+"/Items";return void 0!==this.Id&&(a+="("+this.Id+")"),a},c.prototype.getProperties=function(b){var c=this,d=a.defer(),e={};void 0!==b&&(e.$expand=b);var f=new SP.RequestExecutor(c.list.web.url);return f.executeAsync({url:c.getAPIUrl()+utils.parseQuery(e),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);if(utils.cleanDeferredProperties(b),angular.extend(c,b),0===c.list.BaseType)switch(b.FileSystemObjectType){case 0:c.getFile().then(function(){d.resolve(b)});break;case 1:c.getFolder().then(function(){d.resolve(b)});break;default:d.resolve(b)}else d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.getFieldValuesAsHtml=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl()+"/FieldValuesAsHtml",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),b.FieldValuesAsHtml=d,c.resolve(this)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getFile=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl()+"/File?$expand=ParentFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getFolder=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl()+"/Folder?$expand=ParentFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getAttachments=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return this.isNew()?(b.AttachmentFiles=[],b.attachments={add:[],remove:[]},c.resolve(b.AttachmentFiles)):d.executeAsync({url:b.getAPIUrl()+"/AttachmentFiles",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);b.AttachmentFiles=d,b.attachments={add:[],remove:[]},c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.addAttachment=function(c){var d=this,e=a.defer(),f=new SP.RequestExecutor(d.list.web.url);return b.getFileBinary(c).then(function(a){var b={Accept:"application/json; odata=verbose"},g=document.getElementById("__REQUESTDIGEST");null!==g&&(b["X-RequestDigest"]=g.value),f.executeAsync({url:d.getAPIUrl()+"/AttachmentFiles/add(FileName='"+c.name+"')",method:"POST",binaryStringRequestBody:!0,body:a,state:"Update",headers:b,success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},c.prototype.removeAttachment=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.list.web.url),f={Accept:"application/json; odata=verbose","X-HTTP-Method":"DELETE"},g=document.getElementById("__REQUESTDIGEST");return null!==g&&(f["X-RequestDigest"]=g.value),e.executeAsync({url:c.getAPIUrl()+"/AttachmentFiles('"+b+"')",method:"POST",headers:f,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.processAttachments=function(){function b(d,e,f){e=e||0,f=f||a.defer();var g=d[e++];if(void 0===g)return f.resolve(),f.promise;switch(g.operation.toLowerCase()){case"add":c.addAttachment(g.file)["finally"](function(){b(d,e,f)})["catch"](function(a){try{var b=a.data.statusCode+" ("+a.data.statusText+")";alert(g.file.name+"\n\n"+a.code+"\n"+b+"\n\n"+a.message)}catch(c){console.log(a),alert("Error attaching the file "+g.file.name)}});break;case"remove":c.removeAttachment(g.fileName)["finally"](function(){b(d,e,f)})}return f.promise}var c=this,d=a.defer();if(void 0!==this.attachments){var e=[];void 0!==this.attachments.remove&&this.attachments.remove.length>0&&angular.forEach(this.attachments.remove,function(a){e.push({operation:"remove",fileName:a})}),void 0!==this.attachments.add&&this.attachments.add.length>0&&angular.forEach(this.attachments.add,function(a){e.push({operation:"add",file:a})}),b(e).then(function(){c.attachments.add=[],c.attachments.remove=[],d.resolve()})}else d.resolve();return d.promise},c.prototype.save=function(){var b=this,c=a.defer();return b.list.getListItemEntityTypeFullName().then(function(a){var d=new SP.RequestExecutor(b.list.web.url),e={__metadata:{type:a}},f=angular.extend({},b);delete f.list,delete f.apiUrl;for(var g in f)"function"==typeof f[g]&&delete f[g];angular.forEach(b.list.Fields,function(a){("Computed"===a.TypeAsString||a.ReadOnlyField)&&"ContentTypeId"!==a.EntityPropertyName&&delete f[a.EntityPropertyName];var b=a.originalTypeAsString||a.TypeAsString,c=a.EntityPropertyName;("Lookup"==b||"LookupMulti"==b||"User"==b||"UserMulti"==b)&&(c+="Id"),("LookupMulti"==b||"MultiChoice"==b||"UserMulti"==b)&&null===f[c]&&delete f[c],a.Required===!0&&null===f[c]&&delete f[c]}),delete f.attachments,delete f.AttachmentFiles,delete f.ContentType,delete f.FieldValuesAsHtml,delete f.Folder,delete f.File,angular.extend(e,f);var h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value),b.isNew()||angular.extend(h,{"X-HTTP-Method":"MERGE","IF-MATCH":"*"}),d.executeAsync({url:b.getAPIUrl(),method:"POST",body:angular.toJson(e),headers:h,success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),b.processAttachments().then(function(){c.resolve(d)},function(){c.resolve(d)})},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}})}),c.promise},c.prototype.remove=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.list.web.url),f={Accept:"application/json; odata=verbose"},g=document.getElementById("__REQUESTDIGEST");null!==g&&(f["X-RequestDigest"]=g.value);var h=c.getAPIUrl()+"/recycle";return b===!0&&(h=h.rtrim("/recycle"),f["X-HTTP-Method"]="DELETE",f["IF-MATCH"]="*"),e.executeAsync({url:h,method:"POST",headers:f,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.runWorkflow=function(b,c){var d=this,e=a.defer(),f=new SP.RequestExecutor(d.list.web.url);if(void 0===b)throw"Required @workflowName parameter not specified in SPListItem.runWorkflow method.";if(utils.isGuid(b)){var g=new SP.ClientContext(d.list.web.url),h=g.get_web(),i=h.get_lists().getById(d.list.Id);d._item=i.getItemById(d.Id),g.load(d._item),g.executeQueryAsync(function(){var a={"content-type":"text/xml;charset='utf-8'"},c=document.getElementById("__REQUESTDIGEST");null!==c&&(a["X-RequestDigest"]=c.value);var g='<soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap12="http://www.w3.org/2003/05/soap-envelope"><soap12:Body><StartWorkflow xmlns="http://schemas.microsoft.com/sharepoint/soap/workflow/"><item>';g+=_spPageContextInfo.webAbsoluteUrl+d._item.get_item("FileRef"),g+="</item><templateId>",g+=b,g+="</templateId><workflowParameters><root /></workflowParameters></StartWorkflow></soap12:Body></soap12:Envelope>",f.executeAsync({url:d.list.web.url.rtrim("/")+"/_vti_bin/workflow.asmx",method:"POST",dataType:"xml",async:!0,headers:a,body:g,success:function(){d.getProperties().then(function(){e.resolve()})},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})})}else this.list.getWorkflowAssociationByName(b).then(function(a){return a.length>0?d.runWorkflow(a[0].Id,c):(console.error("There is no associated workflow with name "+b),void e.reject("There is no associated workflow with name "+b))});return e.promise},c}]),angular.module("ngSharePoint").factory("SPObjectProvider",["$injector",function(a){"use strict";return{getSPWeb:function(b){var c=a.get("SPWeb");return new c(b)},getSPList:function(b,c,d){var e=a.get("SPList");return new e(b,c,d)},getSPListItem:function(b,c){var d=a.get("SPListItem");return new d(b,c)},getSPFolder:function(b,c,d){var e=a.get("SPFolder");return new e(b,c,d)},getSPFile:function(b,c,d){var e=a.get("SPFile");return new e(b,c,d)},getSPGroup:function(b,c,d){var e=a.get("SPGroup");return new e(b,c,d)},getSPUser:function(b,c,d){var e=a.get("SPUser");return new e(b,c,d)}}}]),function(){"use strict";function a(a){function b(){z=y.get_ribbon(),A=y.get_commandDispatcher(),E=!0,B.resolve()}function c(){return E===!0&&B.resolve(),SP.SOD.executeOrDelayUntilScriptLoaded(function(){y=SP.Ribbon.PageManager.get_instance(),y.add_ribbonInited(b);try{z=y.get_ribbon()}catch(a){}z?b():"function"==typeof _ribbonStartInit&&_ribbonStartInit(_ribbon.initialTabId,!1,null)},"sp.ribbon.js"),B.promise}function d(){c().then(function(){z.refresh()})}function e(a,b,c,d,e,f,g){var h=new CUI.Tab(z,a,b,c,d,e||!1,f||"",g||null);return z.addChild(h),z.refresh(),h}function f(a){var b=z.getChild(a);return null===b&&(b=z.getChildByTitle(a)),b}function g(){var a=z.getChild("Ribbon.ListForm.Edit");return null===a&&(a=z.getChild("Ribbon.DocLibListForm.Edit")),null===a&&(a=z.getChild("Ribbon.PostListForm.Edit")),a}function h(){return z.getChild(z.get_selectedTabId())}function i(a,b,c,d,e){var f,g,h,i=z.getChild(a);return null!==i&&(f=new CUI.Group(z,b,c,d,e,null),i.addChild(f),g=j(f),h=k(g),z.refresh()),{group:f,layout:g,section:h}}function j(a){var b=a.get_id()+".Layout",c=new CUI.Layout(z,b,b);return a.addChild(c),c}function k(a){var b=a.get_id()+".Section",c=new CUI.Section(z,b,2,"Top");return a.addChild(c),c}function l(a,b,c,d,e){var f=new CUI.ControlProperties;return f.Command=a,f.Id=a+".ControlProperties",f.TemplateAlias="o1",f.Image32by32=e||"_layouts/15/images/placeholder32x32.png",f.ToolTipTitle=c||b,f.ToolTipDescription=d||c||"",f.LabelText=b,f}function m(a,b,c,d,e,f){var g=new CUI.Controls.Button(z,b,l(b,c,d,e,f)),h=g.createComponentForDisplayMode("Large"),i=a.getRow(1);i.addChild(h)}function n(a){if(!angular.isArray(a)){if(!angular.isString(a))return!1;a=[a]}return a}function o(a,b){var c=n(b),d=y.getPageComponentById(a);return d&&c?(A.registerMultipleCommandHandler(d,c),z.refresh(),!0):!1}function p(a,b){var c=n(b),d=y.getPageComponentById(a);return d&&c?(A.unregisterMultipleCommandHandler(d,c),z.refresh(),!0):!1}function q(a){var b={},c=a.$6_0;if(c)for(var d=c.getEnumerator();d.moveNext();){var e=d.get_current();b[e.get_id()]=e,angular.extend(b[e.get_id()],q(e))}return b}function r(){var a=z.get_selectedTabId(),b=q(z);return z.selectTabById(a),b}function s(a,b){var c,d,g=a||"Toolbar "+u(),j="Ribbon.ngSharePoint."+g.replace(/ /g,"-"),k=j+".Command";if(b){if(c=f(b),null===c){var l="Ribbon.ngSharePoint."+b.replace(/ /g,"-");c=e(l,b,"",l+".Command"),w(l+".Command",angular.noop,!0)}}else c=h();return d=i(c.get_id(),j,g,k),w(k,angular.noop,!0),d}function t(a,b,c,d,e,f,g){var h=a.group.get_id()+".Button-"+v();m(a.section,h,b,d,e,f),a.group.selectLayout(a.layout.get_id()),w(h,c,g)}function u(){return C++}function v(){return D++}function w(a,b,c){var d=y.getPageComponentById("ngSharePointPageComponent");d||(d=x()),d.addCommand(a,b,c)&&o(d.getId(),a)}function x(){Type.registerNamespace("ngSharePointPageComponent"),ngSharePointPageComponent=function(){ngSharePointPageComponent.initializeBase(this)},ngSharePointPageComponent.initializePageComponent=function(){var a=ngSharePointPageComponent.get_instance();return y.addPageComponent(a),a},ngSharePointPageComponent.get_instance=function(){return angular.isDefined(ngSharePointPageComponent.instance)||(ngSharePointPageComponent.instance=new ngSharePointPageComponent),ngSharePointPageComponent.instance},ngSharePointPageComponent.prototype={init:function(){this._commands=[],this._handledCommands={}},getGlobalCommands:function(){return this._commands},getFocusedCommands:function(){return[]},handleCommand:function(a,b,c){return this._handledCommands[a].handle(a,b,c)},canHandleCommand:function(a){var b=this._handledCommands[a].enabled;return angular.isFunction(b)?b():!!b},isFocusable:function(){return!1},receiveFocus:function(){return!0},yieldFocus:function(){return!1},getId:function(){return"ngSharePointPageComponent"},addCommand:function(a,b,c){return CUI.ScriptUtility.isNullOrUndefined(a)||CUI.ScriptUtility.isNullOrUndefined(b)||Array.contains(this._commands,a)?!1:(this._handledCommands[a]={handle:b,enabled:c},this._commands.push(a),!0)}},p("WebPartWPQ2","Ribbon.ListForm.Edit.Commit.Publish"),p("WebPartWPQ2","Ribbon.ListForm.Edit.Commit.Cancel"),p("WebPartWPQ2","Ribbon.ListForm.Edit.Actions.AttachFile"),p("WebPartWPQ1","Ribbon.ListForm.Edit.Commit.Publish"),p("WebPartWPQ1","Ribbon.ListForm.Edit.Commit.Cancel"),p("WebPartWPQ1","Ribbon.ListForm.Edit.Actions.AttachFile"),ngSharePointPageComponent.registerClass("ngSharePointPageComponent",CUI.Page.PageComponent);var a=ngSharePointPageComponent.initializePageComponent();return a}var y,z,A,B=a.defer(),C=1,D=1,E=!1,F={ready:c,refresh:d,addTab:e,getTab:f,getEditTab:g,getDefaultTab:h,addGroupToTab:i,addLayoutToGroup:j,addSectionToLayout:k,addButtonToSection:m,registerComponentCommands:o,unregisterComponentCommands:p,getStructure:r,createToolbar:s,addButtonToToolbar:t,registerCommand:w};return F}angular.module("ngSharePoint").factory("SPRibbon",a),a.$inject=["$q","$timeout"]}(),angular.module("ngSharePoint").factory("SPUser",["$q","SPObjectProvider","SPHttp",function(a,b,c){var d=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPUser constructor.";if(void 0===b)throw"@userId parameter not specified in SPUser constructor.";this.web=a,"number"==typeof b?this.apiUrl="/SiteUserInfoList/getItemById('"+b+"')":"string"==typeof b&&(this.apiUrl="/siteusers/getByLoginName(@v)?@v='"+encodeURIComponent(b)+"'"),this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c),void 0===this.LoginName&&void 0!==this.Name&&(this.LoginName=this.Name))};return d.prototype.getProperties=function(a){var b=this,d=b.apiUrl+utils.parseQuery(a);return c.get(d).then(function(a){return utils.cleanDeferredProperties(a),angular.extend(b,a),b.LoginName=b.Name,b})},d.prototype.getGroups=function(){var a=this,d=a.web.apiUrl+"/getUserById("+a.Id+")/Groups";return c.get(d).then(function(c){var d=[];return angular.forEach(c,function(c){var e=b.getSPGroup(a.web,c.Id,c);d.push(e)}),a.Groups=d,d})},d}]),angular.module("ngSharePoint").factory("SPUtils",["SPConfig","$q","$http","$injector","ODataParserProvider",function(a,b,c,d,e){"use strict";var f=!1;return{inDesignMode:function(){var a=window.g_disableCheckoutInEditMode,b=document.forms[MSOWebPartPageFormName],c=b.MSOLayout_InDesignMode||b._wikiPageMode;return!!(a||c&&c.value)},SharePointReady:function(){var c=b.defer(),d=this;return void 0===window.SP&&(f=!0),f?c.resolve():SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){var e=[],g=[];e.push(d.loadScript("SP.RequestExecutor.js","SP.RequestExecutor")),a.options.loadMinimalSharePointInfraestructure===!1&&(e.push(d.loadScript("SP.UserProfiles.js","SP.UserProfiles")),e.push(d.loadScript("datepicker.debug.js","clickDatePicker")),e.push(d.loadScript("clienttemplates.js","SPClientTemplates")),e.push(d.loadScript("clientforms.js","SPClientForms")),e.push(d.loadScript("clientpeoplepicker.js","SPClientPeoplePicker")),e.push(d.loadScript("autofill.js","SPClientAutoFill")),e.push(d.loadScript(_spPageContextInfo.currentLanguage+"/initstrings.js","Strings")),e.push(d.loadScript(_spPageContextInfo.currentLanguage+"/strings.js","Strings"))),b.all(e).then(function(){(a.options.loadMinimalSharePointInfraestructure===!1||a.options.forceLoadResources)&&angular.forEach(a.options.resourceFiles.get(),function(a){-1==a.indexOf(".resx")&&(a+=".resx"),g.push(d.loadResourceFile(a))}),b.all(g).then(function(){f=!0,c.resolve()},function(a){console.error("Error loading SharePoint resources dependences.",a),c.reject(a)})},function(a){console.error("Error loading SharePoint scripts dependences.",a),c.reject(a)})}),c.promise},loadResourceFile:function(d){var e,f=b.defer(),g=d.lastIndexOf(".resx"),h=d.substr(0,-1!=g?g:d.length),i="?name="+h+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name||_spPageContextInfo.currentUICultureName);return e=a.options.force15LayoutsDirectory?"/_layouts/15/ScriptResx.ashx"+i:SP.Utilities.Utility.getLayoutsPageUrl("ScriptResx.ashx")+i,c.get(e).success(function(a){window.Resources=window.Resources||{},a=a.replace(/align - right|align-right/g,"align_right"),a=a.replace(/e - mail|e-mail/g,"email"),a=a.replace(/e - Mail|e-Mail/g,"email"),a=a.replace(/tty - TDD|tty-TDD/g,"tty_TDD");try{var b=eval;b(a),window.Res=window.Res||void 0,void 0!==window.Res&&(window.Resources[h]=window.Res)}catch(c){console.error(c)}f.resolve()}).error(function(){f.resolve()}),f.promise},loadScript:function(c,d){var e=b.defer();return a.options.force15LayoutsDirectory?SP.SOD.registerSod(c,"/_layouts/15/"+c):SP.SOD.registerSod(c,SP.Utilities.Utility.getLayoutsPageUrl(c)),EnsureScriptFunc(c,d,function(){e.resolve()}),e.promise},generateCamlQuery:function(a,b){var c,d="";if(void 0===a)c=SP.CamlQuery.createAllItemsQuery();else{if("string"==typeof a)d=a;else if("object"==typeof a){var f=e.ODataParser(b);
f.parseExpression(a),d=f.getCAMLQuery()}if(d&&(c=new SP.CamlQuery,c.set_viewXml(d)),a.pagingInfo){var g=new SP.ListItemCollectionPosition;g.set_pagingInfo(a.pagingInfo),c.set_listItemCollectionPosition(g)}}return c},getRegionalSettings:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=b.get_web(),d=c.get_regionalSettings(),e=d.get_timeZone();b.load(d),b.load(e),b.executeQueryAsync(function(){d.TimeZone=e,a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},refreshDigestValue:function(a){var d=b.defer(),e=(a||_spPageContextInfo.webAbsoluteUrl)+"/_api/contextinfo";return c({url:e,method:"POST",headers:{Accept:"application/json; odata=verbose"}}).then(function(a){var b=document.getElementById("__REQUESTDIGEST");null!==b&&(b.value=a.data.d.GetContextWebInformation.FormDigestValue),d.resolve(a.data.d.GetContextWebInformation.FormDigestValue)},function(a){console.log(a.data),d.reject(a.data)}),d.promise},getCurrentUser:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=b.get_web(),d=c.get_currentUser();b.load(d),b.executeQueryAsync(function(){a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},getUserInfoByLoginName:function(a){var c=b.defer(),d=new SP.ClientContext.get_current,e=d.get_web().ensureUser(a);return d.load(e),d.executeQueryAsync(function(){var a=e.get_objectData();c.resolve(a.get_properties())},function(a,b){c.reject({sender:a,args:b})}),c.promise},getUserRegionalSettings:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=new SP.UserProfiles.PeopleManager(b),d=c.getMyProperties();b.load(d),b.executeQueryAsync(function(){a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},parseXmlString:function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0===a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getCurrentUserLCID:function(){var a=b.defer(),d=_spPageContextInfo.webServerRelativeUrl.rtrim("/")+"/_layouts/15/regionalsetng.aspx?Type=User";return c.get(d).success(function(b){var c,d,e=angular.element(b);if(angular.forEach(e,function(a){a.tagName&&"form"===a.tagName.toLowerCase()&&(c=a)}),void 0!==c)if(c.querySelector("#ctl00_PlaceHolderMain_ctl08_ChkFollowWebRegionalSettings").checked)d=_spPageContextInfo.currentLanguage;else{var f=c.querySelector("#ctl00_PlaceHolderMain_ctl02_ctl01_DdlwebLCID"),g=f.querySelector("[selected]");d=g.value}a.resolve(d)}),a.promise},getWebById:function(a){var c=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext,d=b.get_site(),e=d.openWebById(a.ltrim("{").rtrim("}"));b.load(e,"ServerRelativeUrl"),b.executeQueryAsync(function(){c.resolve(e)},function(a,b){c.reject({sender:a,args:b})})}),c.promise},getFileBinary:function(a){var c=b.defer(),d=new FileReader;return d.onload=function(a){for(var b=a.target.result,d=new Uint8Array(b),e="",f=0;f<d.length;f++)e+=String.fromCharCode(d[f]);c.resolve(e)},d.onerror=function(a){c.reject(a.target.error)},d.readAsArrayBuffer(a),c.promise},callFunctionWithParams:function(a,b){var c=!0;if(a){{d.annotate(a)}c=d.invoke(a,b,b)}return c}}}]),angular.module("ngSharePoint").factory("SPWeb",["$q","SPHttp","SPUtils","SPList","SPUser","SPGroup","SPFolder",function(a,b,c,d,e,f,g){"use strict";var h=function(a){return this.url=a,this.getApiUrl()};return h.prototype.getApiUrl=function(){var b=this,d=a.defer();return void 0!==this.apiUrl?d.resolve(this):void 0===this.url?(this.url=void 0!==window._spPageContextInfo?window._spPageContextInfo.webServerRelativeUrl:"/",this.apiUrl=this.url.rtrim("/")+"/_api/web",d.resolve(this)):(this.url=this.url.trim().ltrim("{").rtrim("}"),utils.isGuid(this.url)?c.getWebById(this.url).then(function(a){b.url=a.get_serverRelativeUrl(),b.apiUrl=b.url.rtrim("/")+"/_api/web",d.resolve(b)}):(this.apiUrl=this.url.rtrim("/")+"/_api/web",d.resolve(this))),d.promise},h.prototype.getProperties=function(a){var d=this,e="RegionalSettings/TimeZone";return c.SharePointReady().then(function(){a?a.$expand=e+(a.$expand?","+a.$expand:""):a={$expand:e};var c=d.apiUrl+utils.parseQuery(a);return b.get(c).then(function(a){return utils.cleanDeferredProperties(a),angular.extend(d,a),a})})},h.prototype.getLists=function(){var a=this;return c.SharePointReady().then(function(){var c=a.apiUrl+"/Lists";return b.get(c).then(function(b){var c=[];return angular.forEach(b,function(b){var e=new d(a,b.Id,b);c.push(e)}),c})})},h.prototype.getList=function(b){var c=a.defer();return c.resolve(new d(this,b)),c.promise},h.prototype.getRootFolder=function(){var c=this,d=this.RootFolder;if(void 0===d){var e=c.apiUrl+"/RootFolder";d=b.get(e).then(function(a){return c.RootFolder=new g(c,a.ServerRelativeUrl,a),c.RootFolder.web=c,c.RootFolder})}return a.when(d)},h.prototype.getCurrentUser=function(){var c=a.defer(),d=this;if(void 0!==this.currentUser)c.resolve(this.currentUser);else{var e;if(void 0!==window._spPageContextInfo)e=window._spPageContextInfo.userId;else{var f=this.apiUrl+"/currentUser";e=b.get(f).then(function(a){return a.Id})}a.when(e).then(function(a){d.getUserById(a).then(function(a){d.currentUser=a,c.resolve(a)},function(a){c.reject(a)})})}return c.promise},h.prototype.getUserById=function(a){return new e(this,a).getProperties()},h.prototype.getSiteGroups=function(){var d=this,e=d.Groups;return void 0===e&&(e=c.SharePointReady().then(function(){var a=d.apiUrl+"/SiteGroups";return b.get(a).then(function(a){var b=[];return angular.forEach(a,function(a){var c=new f(d,a.Id,a);b.push(c)}),d.Groups=b,b})})),a.when(e)},h}]),function(){"use strict";function a(a,b,c,d,e){function f(f,g,h,i){function j(){return void 0!==h.noredirect?!1:i.allowRedirect}function k(){switch(g.removeAttr("sp-action"),g.attr("ng-click","makeAction();"+(h.ngClick||"")),g.attr("ng-disabled","isInDesignMode || formCtrl.getFormStatus() != status.IDLE || enabled === false"),g.addClass("spform-toolbar-element spform-toolbar-action"),h.spAction.toLowerCase()){case"save":""===g.html()&&g.append(Strings.STS.L_SaveButtonCaption),f.action=n,q=q||"default",d.ready().then(function(){d.registerCommand("Ribbon.ListForm.Edit.Commit.Publish",p,!0)});break;case"cancel":""===g.html()&&g.append(Strings.STS.L_CancelButtonCaption),f.action=o,q=q||"default",d.ready().then(function(){d.registerCommand("Ribbon.ListForm.Edit.Commit.Cancel",p,!0)});break;case"close":""===g.html()&&g.append(Strings.STS.L_CloseButtonCaption),f.action=o,q=q||"default";break;default:f.action=f.spAction,("true"===h.showInRibbon||!angular.isDefined(h.showInRibbon)&&i.showToolbarInRibbon())&&d.ready().then(function(){var a=i.getRibbonToolbar();a&&d.addButtonToToolbar(a,m(),p,r,s,t,l)})}a(g)(f)}function l(){return f.enabled!==!1&&f.formCtrl.getFormStatus()==f.status.IDLE}function m(){var a="";return a="input"==g.get(0).tagName.toLowerCase()?g.val():g.text()}function n(){return SP.UI.ModalDialog.get_childDialog()&&(f.dialogResult=SP.UI.DialogResult.OK),f.formCtrl.save()}function o(){return SP.UI.ModalDialog.get_childDialog()&&(f.dialogResult=SP.UI.DialogResult.cancel),f.formCtrl.cancel()}function p(){f.formCtrl.setFormStatus(f.status.PROCESSING);var a;switch(f.spAction.toLowerCase()){case"save":case"cancel":case"close":;a=c.callFunctionWithParams(f.action,f);break;default:a=c.callFunctionWithParams(f.$parent[f.spAction],f.$parent)}b.when(a).then(function(a){if(a!==!1&&q&&j()){var c=f.formCtrl.getItem(),d=c.list;switch(q.toLowerCase()){case"display":d.getDefaultDisplayFormUrl().then(function(a){var b=window.location.search,d="ID="+c.Id;-1==b.indexOf(d)&&(b=""===b?"?"+d:"?"+d+"&"+b.substr(1)),window.location=a+b});break;case"edit":d.getDefaultEditFormUrl().then(function(a){var b=window.location.search,d="ID="+c.Id;-1==b.indexOf(d)&&(b=""===b?"?"+d:"?"+d+"&"+b.substr(1)),window.location=a+b});break;case"new":d.getDefaultNewFormUrl().then(function(a){window.location=a});break;case"default":var g=SP.UI.ModalDialog.get_childDialog();if(g)e(function(){try{f.dialogReturnValue=c,g.commonModalDialogClose(f.dialogResult,f.dialogReturnValue)}catch(a){g.close(f.dialogResult)}});else{var h=utils.getQueryStringParamByName("Source");void 0===h&&(h=d.getDefaultViewUrl()),b.when(h).then(function(a){window.location=a})}break;default:window.location=q}}},function(a){a&&console.error(a)})["finally"](function(){f.formCtrl.setFormStatus(f.status.IDLE)})}f.formCtrl=i.getFormCtrl(),f.isInDesignMode=c.inDesignMode(),f.status=f.formCtrl.status,f.makeAction=p;var q=h.redirectUrl,r=(h.ngClick,h.tooltip),s=h.description,t=h.ribbonButtonImage;f.$watch("enabled",d.refresh),f.$watch(function(){return f.formCtrl.getFormStatus()},d.refresh),k()}var g={restrict:"A",require:"^spformToolbar",priority:500,terminal:!0,scope:{spAction:"@",redirectUrl:"@",enabled:"="},link:f};return g}angular.module("ngSharePoint").directive("spAction",a),a.$inject=["$compile","$q","SPUtils","SPRibbon","$timeout"]}(),angular.module("ngSharePoint").directive("spIf",["$compile","SPExpressionResolver",function(a,b){var c={restrict:"A",terminal:!0,priority:600,link:function(c,d,e){b.resolve(e.spIf,c).then(function(b){c.$eval(b)?(d.removeAttr("sp-if"),d=a(d,600)(c)):(d.remove(),d=null)})}};return c}]),angular.module("ngSharePoint").directive("spfieldAttachments",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(b){var c={fieldTypeName:"attachments",replaceAll:!1,init:function(){b.DeleteAttachmentText=STSHtmlEncode(Strings.STS.L_DeleteDocItem_Text),b.AttachFileText=Resources.core.cui_ButAttachFile,b.LanguageID=_spPageContextInfo.currentLanguage.toString()},renderFn:function(a,d){(null!==a||void 0!==d)&&(c.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),b.$parent.item.getAttachments().then(function(a){b.attachmentFiles=a,c.renderField()},function(a){b.errorMsg=a.message,c.setElementHTML('<span style="color: brown">{{errorMsg}}</span>')}))}};a.baseLinkFn.apply(c,arguments),b.onFileSelect=function(a,c){angular.forEach(a,function(a){for(var c=-1,d=0;d<b.attachmentFiles.length;d++)if(b.attachmentFiles[d].FileName==a.name){c=d;break}c>=0?alert(Strings.STS.L_ConflictReplaceTitle+" '"+a.name+"'."):(b.$parent.item.attachments.add.push(a),b.attachmentFiles.push({FileName:a.name,local:!0}))}),c.target.value=""},b.removeAttachment=function(a,c,d){if(a.preventDefault(),d){for(var e=0;e<b.$parent.item.attachments.add.length;e++)if(b.$parent.item.attachments.add[e].name==b.attachmentFiles[c].FileName){b.$parent.item.attachments.add.splice(e,1);break}b.attachmentFiles.splice(c,1)}else{var f=Strings.STS.L_ConfirmDelete_TXT;recycleBinEnabled&&(f=Strings.STS.L_ConfirmRecycle_TXT),confirm(f)&&(b.$parent.item.attachments.remove.push(b.attachmentFiles[c].FileName),b.attachmentFiles.splice(c,1))}return!1}}};return b}]),angular.module("ngSharePoint").directive("fileSelect",["$parse","$timeout","SPRibbon",function(a,b,c){var d=function(d,e,f){var g=a(f.fileSelect);if(e.removeAttr("file-select"),"input"!==e[0].tagName.toLowerCase()||e.attr("type")&&"file"!==e.attr("type").toLowerCase()){for(var h=angular.element('<input type="file">'),i=0;i<e[0].attributes.length;i++)h.attr(e[0].attributes[i].name,e[0].attributes[i].value);e.attr("data-multiple")&&h.attr("multiple","true"),h.css({position:"absolute",top:"0px",bottom:"0px",right:"0px",width:"200%",margin:"0px",padding:"0px",opacity:"0",filter:"alpha(opacity=0)","z-index":"1000",cursor:"pointer"}),e.append(h),h.parent()[0]!=e[0]&&(e.wrap("<span>"),e.css("z-index","-1000"),e.parent().append(h),e=e.parent()),(""===e.css("position")||"static"===e.css("position"))&&e.css("position","relative"),e.css({display:"inline-block",overflow:"hidden",cursor:"pointer"}),e=h}e.bind("change",function(a){var c=[],e=a.__files_||a.target.files;if(null!==e)for(var f=0;f<e.length;f++)c.push(e.item(f));b(function(){g(d,{$files:c,$event:a})})}),c.ready().then(function(){c.attachFileElement=e,c.registerCommand("Ribbon.ListForm.Edit.Actions.AttachFile",function(){c.attachFileElement.click()},!0)})};return d}]),angular.module("ngSharePoint").directive("spfieldBoolean",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"boolean",replaceAll:!1,renderFn:function(){b.value=b.modelCtrl.$viewValue,b.displayValue=STSHtmlEncode(b.modelCtrl.$viewValue?Strings.STS.L_SPYes:Strings.STS.L_SPNo)},formatterFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a},parserFn:function(a){return b.lastValue!==b.value&&(b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a),a}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldCalculated",["SPFieldDirective","SPUtils",function(a,b){var c={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(c){var d={fieldTypeName:"text",replaceAll:!1,init:function(){switch(c.schema.OutputType){case SP.FieldType.text:d.fieldTypeName="text";break;case SP.FieldType.dateTime:d.fieldTypeName="datetime",c.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo;break;case SP.FieldType["boolean"]:d.fieldTypeName="boolean";break;case SP.FieldType.number:d.fieldTypeName="number";var a=b.parseXmlString(c.schema.SchemaXml),e=a.documentElement.getAttribute("Percentage")||"false",f=a.documentElement.getAttribute("Decimals")||"auto";c.schema.Percentage="true"===e.toLowerCase(),c.schema.Decimals=parseInt(f),c.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo;break;case SP.FieldType.currency:d.fieldTypeName="currency",c.currencyLocaleId=c.schema.CurrencyLocaleId,c.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo}},watchValueFn:function(a){switch(c.schema.OutputType){case SP.FieldType.text:break;case SP.FieldType.dateTime:c.dateModel=null!==c.value&&void 0!==c.value?new Date(c.value):null;break;case SP.FieldType["boolean"]:c.displayValue=STSHtmlEncode(a?Strings.STS.L_SPYes:Strings.STS.L_SPNo);break;case SP.FieldType.number:c.value=parseFloat(a);break;case SP.FieldType.currency:c.value=parseFloat(a)}},watchModeFn:function(){c.currentMode="display",d.renderField()}};a.baseLinkFn.apply(d,arguments)}};return c}]),angular.module("ngSharePoint").directive("spfieldChoice",["SharePoint","SPFieldDirective","$q","$timeout",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(e){function f(b){var f=c.defer(),h=e.item.list.web;return void 0!==b.Web&&(h=a.getWeb(b.Web)),c.when(h).then(function(a){a.getList(b.List).then(function(a){g(b),a.getListItems(b.Query).then(function(a){e.items=a;var c=[];e.dropDownValue=void 0,e.schema.Required||c.push(void 0),angular.forEach(a,function(a){c.push(a[b.Field||"Title"])}),d(function(){e.$apply(function(){e.dropDownValue=e.value,e.choices=c})})})},function(a){f.reject(a)})}),f.promise}function g(a){if(void 0===e.dependences)return a;if(0===e.dependences.length)return a;var b=e.schema.Choices.ListQuery.Query.originalFilter;return e.schema.Choices.ListQuery.Query.originalFilter=b,angular.forEach(e.dependences,function(a){var c="{"+a.field;c+=void 0!==a.fieldValue?"."+a.fieldValue+"}":"}",b=b.replace(c,a.value)}),e.schema.Choices.ListQuery.Query.$filter=b,a}var h={fieldTypeName:"choice",replaceAll:!1,init:function(){void 0!==e.schema.Choices.ListQuery?(e.choices=[],"edit"===e.currentMode&&f(e.schema.Choices.ListQuery)):e.choices=e.schema.Choices.results,e.chooseText=STSHtmlEncode(Strings.STS.L_Choose_Text),e.choiceFillInDisplayText=STSHtmlEncode(Strings.STS.L_ChoiceFillInDisplayText),e.selectedOption=null,e.dropDownValue=null,e.fillInChoiceValue=null},renderFn:function(){if(e.value=e.modelCtrl.$viewValue,e.schema.FillInChoice&&-1==e.choices.indexOf(e.value))e.fillInChoiceValue=e.value,e.selectedOption="FillInButton";else switch(e.schema.EditFormat){case 0:void 0!==e.choices&&(e.dropDownValue=e.value),e.selectedOption="DropDownButton";break;case 1:e.selectedOption=e.value}},formatterFn:function(a){return e.formCtrl.fieldValueChanged(e.schema.InternalName,a,e.lastValue),e.lastValue=a,a},parserFn:function(a){var b;return void 0!==e.items&&(b=e.items.find(function(b){return b.campo14===a})),e.formCtrl.fieldValueChanged(e.schema.InternalName,a,e.lastValue,b),e.lastValue=a,a}};if(b.baseLinkFn.apply(h,arguments),"edit"===e.currentMode&&void 0!==e.schema.Choices.ListQuery&&void 0!==e.schema.Choices.ListQuery.Query&&void 0!==e.schema.Choices.ListQuery.Query.$filter){e.schema.Choices.ListQuery.Query.originalFilter=e.schema.Choices.ListQuery.Query.$filter,e.dependences=[];var i=/{(\w+\W*[\w\s./\[\]\(\)]+)}(?!})/g;i.lastIndex=0;for(var j;j=i.exec(e.schema.Choices.ListQuery.Query.$filter);){var k,l,m=j[1].split(".");m.length>1?(k=m[0],l=m[1]):(k=m[0],l=void 0),e.dependences.push({field:k,fieldValue:l})}angular.forEach(e.dependences,function(a){e.$on(a.field+"_changed",function(a,b,c,d){angular.forEach(e.dependences,function(c){a.name===c.field+"_changed"&&(c.value=void 0!==c.fieldValue?void 0!==d?d[c.fieldValue]:void 0:b)}),e.dropDownValue=void 0,e.value=void 0,e.modelCtrl.$setViewValue(e.dropDownValue),f(e.schema.Choices.ListQuery)})})}e.$watch("fillInChoiceValue",function(a,b){a!=b&&void 0!==a&&null!==a&&(e.selectedOption="FillInButton",e.modelCtrl.$setViewValue(a))}),e.$watch("selectedOption",function(a,b){if(a!=b)if("FillInButton"==e.selectedOption){e.modelCtrl.$setViewValue(e.fillInChoiceValue);var c=document.getElementById(e.schema.InternalName+"_"+e.schema.Id+"_$FillInChoice");c&&c.focus()}else switch(e.schema.EditFormat){case 0:e.value=e.dropDownValue,e.modelCtrl.$setViewValue(e.dropDownValue);break;case 1:e.value=e.selectedOption,e.modelCtrl.$setViewValue(e.selectedOption)}}),e.dropDownChanged=function(){e.selectedOption="DropDownButton",e.modelCtrl.$setViewValue(e.dropDownValue),void 0===e.dropDownValue&&(e.formCtrl.fieldValueChanged(e.schema.InternalName,void 0,e.lastValue,void 0),e.lastValue=e.value),e.value=e.dropDownValue},e.dropDownClick=function(){e.selectedOption="DropDownButton"},e.fillInChoiceClick=function(){e.selectedOption="FillInButton"}}};return e}]),angular.module("ngSharePoint").directive("spfieldContenttypeid",["SPFieldDirective","$q","$http","$templateCache","$compile","$filter","$location","$window",function(a,b,c,d,e,f,g,h){var i={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"contenttypeid",replaceAll:!1,init:function(){b.ContentTypes=f("filter")(b.item.list.ContentTypes,function(a){return a.Hidden?!1:"0x0120"===a.StringId.substr(0,6)?!1:!0}),b.selectedContentType=null},renderFn:function(){b.value=b.modelCtrl.$viewValue,b.schema.Title=b.item.list.Fields.ContentType.Title;var a=f("filter")(b.ContentTypes,{StringId:b.modelCtrl.$viewValue});a.length>0&&(b.selectedContentType=a[0],b.schema.Description=b.selectedContentType.Description)}};a.baseLinkFn.apply(c,arguments),b.contentTypeChanged=function(){if(b.value!==b.modelCtrl.$viewValue){var a=utils.getQueryStringParameter("ContentTypeId");if(a===b.value)return;h.location.href=void 0===a?h.location.href+"&ContentTypeId="+b.value:h.location.href.replace(a,b.value)}}}};return i}]),angular.module("ngSharePoint").directive("spfieldControl",["$compile","$templateCache","$http",function(a){var b={restrict:"EA",require:"?^spform",replace:!0,templateUrl:"templates/form-templates/spfield-control.html",link:function(b,c,d,e){function f(){return d.mode||e.getFormMode()}function g(){var a="";c.replaceWith(a),c=a}if(null!==e){var h=d.name||d.spfieldControl,i=e.getFieldSchema(h);if(void 0!==i){if("Attachments"===h){var j=e.getItem();if(void 0!==j&&void 0!==j.list&&j.list.EnableAttachments===!1)return console.error('Can\'t add "Attachments" field because the attachments are disabled in the list.'),void g()}e.initField(i.EntityPropertyName).then(function(){if("hidden"==d.mode)return void c.addClass("ng-hide");var g=i.originalTypeAsString;"UserMulti"===g&&(g="User");var j=i.EntityPropertyName+("Lookup"==g||"LookupMulti"==g||"User"==g||"UserMulti"==g?"Id":"");if(g=i.TypeAsString,"UserMulti"===g&&(g="User"),("Lookup"==g||"LookupMulti"==g)&&null!==i.PrimaryFieldId){var k=e.getFieldSchema(i.PrimaryFieldId);void 0!==k&&(j=k.InternalName+"Id",d.mode="display")}d.required&&(i.Required="true"==d.required);var l=' ng-model="item.'+j+'"',m=' name="'+h+'"',n=d.mode?' mode="'+d.mode+'"':"",o=d.dependsOn?' depends-on="'+d.dependsOn+'"':"",p="hidden"==d.mode?' ng-hide="true"':"",q="";switch("edit"==f()&&(q=' ng-required="'+i.Required+'"'),i.TypeAsString){case"Text":case"Note":q+=' ng-maxlength="'+i.MaxLength+'"'}void 0!==i.RenderAs&&(g=i.RenderAs),d.renderAs&&(g=d.renderAs);var r="",s=["name","mode","required","dependsOn","renderAs"];angular.forEach(d.$attr,function(a,b){-1==s.indexOf(b)&&(r+=" "+a+'="'+d[b]+'"')}),"display"===d.mode&&(q="");var t="<spfield-"+g+l+m+n+o+p+q+r+' class="spfield-body-control '+g+'"></spfield-'+g+">",u=a(t)(b);c.replaceWith(u),c=u})}else console.error('Unknown field "'+d.name+'"'),g()}}};return b}]),angular.module("ngSharePoint").directive("spfieldCurrency",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"currency",replaceAll:!1,init:function(){b.currencyLocaleId=b.schema.CurrencyLocaleId,b.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo},formatterFn:function(a){return"string"==typeof a&&(a=parseFloat(a),isNaN(a)&&(a=void 0)),b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a},parserFn:function(a){return b.lastValue!==parseFloat(a)&&(b.formCtrl.fieldValueChanged(b.schema.InternalName,parseFloat(a),b.lastValue),b.lastValue=parseFloat(a)),parseFloat(a)}};a.baseLinkFn.apply(c,arguments),b.modelCtrl.$validators.number=function(a,b){return void 0===b||!isNaN(b)&&isFinite(b)}}};return b}]),angular.module("ngSharePoint").directive("spfieldDatetime",["SPFieldDirective","$filter","$timeout","$q","SPUtils",function(a,b,c,d,e){var f={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(f){function g(){var a=d.defer();return f.formCtrl.getWebRegionalSettings().then(function(c){f.webRegionalSettings=c,e.getRegionalSettings().then(function(a){f.regionalSettings=a,f.direction=a.get_isRightToLeft()?"rtl":"ltr"}),e.getCurrentUserLCID().then(function(c){f.lcid=c,f.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo;var d=["00","05","10","15","20","25","30","35","40","45","50","55"],e=["12 AM","1 AM","2 AM","3 AM","4 AM","5 AM","6 AM","7 AM","8 AM","9 AM","10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM","7 PM","8 PM","9 PM","10 PM","11 PM"],g=["00:","01:","02:","03:","04:","05:","06:","07:","08:","09:","10:","11:","12:","13:","14:","15:","16:","17:","18:","19:","20:","21:","22:","23:"],h="01:59:59.9999809",i="0111110",k="109207",l="2666269";f.hoursMode24=f.webRegionalSettings.Time24,f.idPrefix=f.schema.InternalName+"_"+f.schema.Id,f.minutes=d,f.hours=f.hoursMode24?g:e,f.datePickerPath=j(),f.datePickerUrl=STSHtmlEncode(f.datePickerPath)+"iframe.aspx?cal="+STSHtmlEncode(String(f.webRegionalSettings.CalendarType))+"&lcid="+STSHtmlEncode(f.lcid)+"&langid="+STSHtmlEncode(_spPageContextInfo.currentLanguage)+"&tz="+STSHtmlEncode(h)+"&ww="+STSHtmlEncode(i)+"&fdow="+STSHtmlEncode(f.webRegionalSettings.FirstDayOfWeek)+"&fwoy="+STSHtmlEncode(f.webRegionalSettings.FirstWeekOfYear)+"&hj="+STSHtmlEncode(f.webRegionalSettings.AdjustHijriDays)+"&swn="+STSHtmlEncode(f.webRegionalSettings.ShowWeeks)+"&minjday="+STSHtmlEncode(k)+"&maxjday="+STSHtmlEncode(l)+"&date=",f.DatePickerFrameID=g_strDatePickerFrameID,f.DatePickerImageID=g_strDatePickerImageID;var m=f.modelCtrl.$viewValue;if(null!==m&&void 0!==m){f.dateModel=new Date(m),f.dateOnlyModel=b("date")(f.dateModel,f.cultureInfo.dateTimeFormat.ShortDatePattern),f.minutesModel=f.dateModel.getMinutes().toString();var n=f.dateModel.getHours();f.hoursModel=n.toString()+(f.hoursMode24?":":""),10>n&&(f.hoursModel="0"+f.hoursModel)}else f.dateModel=f.dateOnlyModel=f.minutesModel=f.hoursModel=null;a.resolve()})}),a.promise}function h(){var a=this.Picker;if(void 0!==typeof a&&null!==a){var b=a.resultfunc;a.resultfunc=function(){b(),c(function(){f.$apply(function(){f.dateOnlyModel=a.resultfield.value})})}}}function i(a,b){if(a!==b&&void 0!==f.dateOnlyModel&&null!==f.dateOnlyModel)try{if(""===f.dateOnlyModel)f.modelCtrl.$setViewValue(null);else{for(var c=f.dateOnlyModel.split(f.cultureInfo.dateTimeFormat.DateSeparator),d=f.cultureInfo.dateTimeFormat.ShortDatePattern.split(f.cultureInfo.dateTimeFormat.DateSeparator),e={},g=0;g<d.length;g++)e[d[g]]=c[g];void 0!==e.yyyy&&2==e.yyyy.length&&(e.yyyy=(new Date).getUTCFullYear().toString().substr(0,2)+e.yyyy);var h=f.hoursModel;null!==h&&(h=f.hoursMode24?h.substr(0,h.length-1):h.substr(0,2));var i=f.minutesModel,j=Date.UTC(e.yyyy,(e.MM||e.M)-1,e.dd||e.d,h,i),k=60*new Date(j).getTimezoneOffset()*1e3;f.modelCtrl.$setViewValue(new Date(j+k))}}catch(l){f.modelCtrl.$setViewValue(null)}}function j(){var a=_spPageContextInfo.webServerRelativeUrl;return null===a&&(a=""),a.endsWith("/")&&(a=a.substring(0,a.length-1)),a+="/_layouts/15/"}var k={fieldTypeName:"datetime",replaceAll:!1,parserFn:function(a){return f.formCtrl.fieldValueChanged(f.schema.InternalName,a,f.lastValue),f.lastValue=a,a},renderFn:function(){g()},formatterFn:function(a){return"string"==typeof a&&(a=new Date(a)),f.formCtrl.fieldValueChanged(f.schema.InternalName,a,f.lastValue),f.lastValue=a,a}};a.baseLinkFn.apply(k,arguments),f.modelCtrl.$validators.date=function(a,b){return void 0===b?!0:null===b?!0:("string"==typeof b&&(b=new Date(b)),isNaN(b.getTime())?!1:angular.isDate(b))},f.showDatePicker=function(a){var b=f.idPrefix+"_$DateTimeFieldDate",c=document.getElementById(b+g_strDatePickerFrameID);return null!==c&&(Boolean(c.attachEvent)?c.attachEvent("onreadystatechange",h):Boolean(c.addEventListener)&&(c.Picker=c,c.readyState="complete",c.addEventListener("load",h,!1))),clickDatePicker(b,f.datePickerUrl,f.dateOnlyModel,a.originalEvent),!1},f.$watch("[dateOnlyModel, hoursModel, minutesModel]",i,!0)}};return f}]),angular.module("ngSharePoint").directive("spfieldDescription",[function(){var a={restrict:"EA",require:"?^spform",replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-description.html",link:function(a,b,c,d){null!==d&&(a.schema=d.getFieldSchema(c.name),a.$watch(function(){return a.mode||d.getFormMode()},function(b){a.currentMode=b}))}};return a}]),angular.module("ngSharePoint").directive("spfieldFile",["SPFieldDirective","$q","$http","$templateCache","$compile",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"file",replaceAll:!1,watchModeFn:function(){if("FileLeafRef"!==b.name)return void console.error("Unknown SPFile field");b.fileName=b.item.File.Name;var a=b.fileName.lastIndexOf(".");-1===a?(b.value=b.fileName,b.extension=""):(b.value=b.fileName.substr(0,b.fileName.lastIndexOf(".")),b.extension=b.fileName.substr(b.fileName.lastIndexOf("."))),b.url=b.item.File.ServerRelativeUrl,b.modelCtrl.$setViewValue(b.value),c.renderField()}};a.baseLinkFn.apply(c,arguments),b.modelCtrl.$validators.pattern=function(a,b){var c=/^[^\\\/:\*\?"<>\|\~#&{}%]+$/,d=/^\./,e=a||b;return c.test(e)&&!d.test(e)},b.EditOrDownload=function(a){switch(a.preventDefault(),b.extension.ltrim(".")){case"doc":case"docx":case"xsl":case"xslx":case"ppt":case"pptx":editDocumentWithProgID2(b.url,"","SharePoint.OpenDocuments","0",_spPageContextInfo.siteAbsoluteUrl,"0");break;default:document.location=b.url}return!1}}};return b}]),angular.module("ngSharePoint").directive("spfieldFocusElement",[function(){var a={restrict:"A",link:function(a,b){function c(b){for(var c=0;c<a.formCtrl.focusElements.length;c++)a.formCtrl.focusElements[c].name===b&&a.formCtrl.focusElements.splice(c,1)}a.formCtrl&&(a.formCtrl.focusElements=a.formCtrl.focusElements||[],c(a.name),a.formCtrl.focusElements.push({name:a.name,element:b}))}};return a}]),angular.module("ngSharePoint").directive("spfieldLabel",[function(){var a={restrict:"EA",require:"?^spform",replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-label.html",link:function(a,b,c,d){null!==d&&(a.schema=d.getFieldSchema(c.name),void 0!==c.label?a.label=c.label:a.$watch(function(){return a.schema?a.schema.Title:""},function(b){a.label=b}),a.$watch(function(){return a.mode||d.getFormMode()},function(b){a.currentMode=b}))}};return a}]),angular.module("ngSharePoint").directive("spfieldLookup",["SPFieldDirective","$q","$filter","SharePoint",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(e,f,g){function h(a){for(var b=0;b<e.lookupItems.length;b++)if(e.lookupItems[b].Id===a)return e.lookupItems[b];return void 0}function i(){var a=!1;if(angular.isDefined(e.schema.extendedTemplate)&&(angular.isDefined(e.schema.extendedTemplate.display)?a=!0:angular.isDefined(e.schema.extendedTemplate.edit)||(a=!0)),"display"===e.currentMode&&!a){var b=e.name.replace(/_/g,"_x005f_");if(void 0!==e.item.FieldValuesAsHtml&&void 0!==e.item.FieldValuesAsHtml[b])return void n.setElementHTML(e.item.FieldValuesAsHtml[b])}n.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),j(e.currentMode).then(function(){"edit"===e.currentMode&&(e.lookupItem={},null!==e.value&&void 0!==e.value&&e.value>0&&angular.forEach(e.lookupItems,function(a){a.Id==e.value&&(e.lookupItem=a)})),n.renderField()},function(a){e.errorMsg=a.message,n.setElementHTML(void 0===e.value?"":'<span style="color: brown">{{errorMsg}}</span>')})}function j(a){return"edit"===a?m():l()}function k(){var a=b.defer();return void 0===e.lookupList?d.getWeb(e.schema.LookupWebId).then(function(b){b.getList(e.schema.LookupList).then(function(b){e.lookupList=b,b.getProperties({$expand:"Forms,Fields"}).then(function(){a.resolve(e.lookupList)},function(b){a.reject(b)})},function(b){a.reject(b)})}):a.resolve(e.lookupList),a.promise}function l(){var a=b.defer();return void 0!==e.lookupItem?a.resolve(e.lookupItem):k().then(function(b){null===e.value||0===e.value||void 0===e.value?(e.lookupItem={title:"",url:""},a.resolve(e.lookupItem)):b.getItemById(e.value).then(function(b){var d=b[e.schema.LookupField],f=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===f.TypeAsString&&null!==d){var g="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo,h=new Date(d);d=c("date")(h,g.dateTimeFormat.ShortDatePattern+(0===f.DisplayFormat?"":" "+g.dateTimeFormat.ShortTimePattern))}"Number"===f.TypeAsString&&f.Percentage&&(d+="%"),"Computed"===f.TypeAsString&&null!==d&&(d=b.Title),e.lookupItem={title:d,url:b.list.Forms.results[0].ServerRelativeUrl+"?ID="+e.value+"&Source="+encodeURIComponent(window.location)},angular.extend(e.lookupItem,b),a.resolve(e.lookupItem)},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}function m(){var a=b.defer();
return void 0!==e.lookupItems?a.resolve(e.lookupItems):k().then(function(b){var c={$orderby:e.schema.LookupField,$top:999999};if(void 0!==e.schema.query&&angular.extend(c,e.schema.query),void 0!==e.dependency){if(void 0===e.dependency.value)return a.resolve(e.lookupItems),a.promise;void 0!==c.select?c.$select+=",":c.$select="*,",c.$select+=e.dependency.fieldName+"/Id",void 0!==c.$expand?c.$expand+=",":c.$expand="",c.$expand+=e.dependency.fieldName+"/Id",void 0!==c.$filter?c.$filter+=" and":c.$filter="",c.$filter+=e.dependency.fieldName+"/Id eq "+e.dependency.value}b.getListItems(c,!0).then(function(b){if(e.lookupItems=b,e.schema.Required||(e.lookupItems=[{Id:0,Title:STSHtmlEncode(Strings.STS.L_LookupFieldNoneOption)}].concat(b)),(null===e.value||void 0===e.value)&&(e.value=e.schema.Required?e.lookupItems.length>0?e.lookupItems[0].Id:null:0),void 0!==e.dependency){var c=e.lookupItems.reduce(function(a,b){return e.value===b.Id||a},!1);c||(e.value=e.lookupItems.length>0?e.lookupItems[0].Id:null)}e.valueChanged(),a.resolve(e.lookupItems)},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}var n={fieldTypeName:"lookup",replaceAll:!1,watchModeFn:function(){},renderFn:function(){e.value=e.modelCtrl.$viewValue,e.lookupItem=void 0,i()}};a.baseLinkFn.apply(n,arguments),void 0!==g.dependsOn&&(e.dependency={fieldName:g.dependsOn,value:e.item[g.dependsOn]},e.$on(g.dependsOn+"_changed",function(a,b){e.dependency={fieldName:g.dependsOn,value:b},e.lookupItems=void 0,i()})),e.valueChanged=function(){if(e.lastValue!==e.value){var a=h(e.value);e.formCtrl.fieldValueChanged(e.schema.InternalName,e.value,e.lastValue,a),e.lastValue=e.value}}}};return e}]),angular.module("ngSharePoint").directive("spfieldLookupmulti",["SPFieldDirective","$q","$filter","SharePoint",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(e,f,g){function h(){var a=!1;if(angular.isDefined(e.schema.extendedTemplate)&&(angular.isDefined(e.schema.extendedTemplate.display)?a=!0:angular.isDefined(e.schema.extendedTemplate.edit)||(a=!0)),"display"===e.currentMode&&!a){var b=e.name.replace(/_/g,"_x005f_");if(void 0!==e.item.FieldValuesAsHtml&&void 0!==e.item.FieldValuesAsHtml[b])return void o.setElementHTML(e.item.FieldValuesAsHtml[b])}(null===e.value||void 0===e.value)&&(e.value={results:[]}),o.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),i(e.currentMode).then(function(){o.renderField(e.currentMode)},function(a){e.errorMsg=a.message,o.setElementHTML(void 0===e.value?"":'<span style="color: brown">{{errorMsg}}</span>')})}function i(a){return"edit"===a?m():l()}function j(){var a=b.defer();return void 0===e.lookupList?d.getWeb(e.schema.LookupWebId).then(function(b){b.getList(e.schema.LookupList).then(function(b){e.lookupList=b,b.getProperties({$expand:"Forms"}).then(function(){b.getFields().then(function(){a.resolve(e.lookupList)})})})}):a.resolve(e.lookupList),a.promise}function k(a){var c=b.defer();return void 0!==e.lookupItems?c.resolve(e.lookupItems):j().then(function(b){b.getListItems(a).then(function(a){e.lookupItems=a,c.resolve(e.lookupItems)})}),c.promise}function l(){var a=b.defer();return void 0!==e.selectedLookupItems?a.resolve(e.selectedLookupItems):(e.selectedLookupItems=[],k().then(function(b){null!==e.value&&void 0!==e.value&&angular.forEach(e.value.results,function(a){var d=c("filter")(b,{Id:a},!0)[0];if(void 0!==d){var f=d[e.schema.LookupField],g=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===g.TypeAsString&&null!==f){var h=__cultureInfo||Sys.CultureInfo.CurrentCulture,i=new Date(f);f=c("date")(i,h.dateTimeFormat.ShortDatePattern+(0===g.DisplayFormat?"":" "+h.dateTimeFormat.ShortTimePattern))}"Computed"===g.TypeAsString&&null!==f&&(f=d.Title),e.selectedLookupItems.push({Title:f,url:d.list.Forms.results[0].ServerRelativeUrl+"?ID="+a+"&Source="+encodeURIComponent(window.location)})}}),a.resolve(e.selectedLookupItems)})),a.promise}function m(){var a=b.defer(),d={$orderby:e.schema.LookupField,$top:999999};return void 0!==e.schema.query&&angular.extend(d,e.schema.query),void 0!==e.dependency&&(void 0!==d.select?d.$select+=",":d.$select="*,",d.$select+=e.dependency.fieldName+"/Id",void 0!==d.$expand?d.$expand+=",":d.$expand="",d.$expand+=e.dependency.fieldName+"/Id",void 0!==d.$filter?d.$filter+=" and":d.$filter="",d.$filter+=e.dependency.fieldName+"/Id eq "+e.dependency.value),k(d).then(function(b){e.candidateItems=[],e.selectedCandidateItems=[],e.resultItems=[],e.selectedResultItems=[],angular.forEach(b,function(a){var b=a[e.schema.LookupField],d=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===d.TypeAsString){var f=__cultureInfo||Sys.CultureInfo.CurrentCulture,g=new Date(b);b=c("date")(g,f.dateTimeFormat.ShortDatePattern+(0===d.DisplayFormat?"":" "+f.dateTimeFormat.ShortTimePattern))}var h={id:a.Id,name:b,title:b,item:a};e.value&&e.value.results&&-1!=e.value.results.indexOf(a.Id)?e.resultItems.push(h):e.candidateItems.push(h)}),a.resolve()}),a.promise}function n(){var a=[];angular.forEach(e.resultItems,function(b){a.push(b.id)}),e.lastValue!==e.value&&(e.formCtrl.fieldValueChanged(e.schema.InternalName,{results:a},e.lastValue,e.resultItems),e.lastValue=e.value),e.value={results:a}}var o={fieldTypeName:"lookupmulti",replaceAll:!1,init:function(){e.idPrefix=e.schema.InternalName+"_"+e.schema.Id,e.addButtonText=STSHtmlEncode(Strings.STS.L_LookupMultiFieldAddButtonText)+" >",e.removeButtonText="< "+STSHtmlEncode(Strings.STS.L_LookupMultiFieldRemoveButtonText),e.candidateAltText=STSHtmlEncode(StBuildParam(Strings.STS.L_LookupMultiFieldCandidateAltText,e.schema.Title)),e.resultAltText=STSHtmlEncode(StBuildParam(Strings.STS.L_LookupMultiFieldResultAltText,e.schema.Title))},watchModeFn:function(){},renderFn:function(){e.value=e.modelCtrl.$viewValue,(null===e.value||void 0===e.value)&&(e.value={results:[]}),e.selectedLookupItems=void 0,h(),e.modelCtrl.$validators.required=function(a,b){return"edit"!=e.currentMode?!0:e.schema.Required?b&&b.results.length>0?!0:!1:!0}}};a.baseLinkFn.apply(o,arguments),void 0!==g.dependsOn&&e.$on(g.dependsOn+"_changed",function(a,b){e.dependency={fieldName:g.dependsOn,value:b},e.lookupItems=void 0,e.value=null,h()}),e.addItems=function(){e.resultItems=e.resultItems.concat(e.selectedCandidateItems),e.candidateItems=c("filter")(e.candidateItems,function(a){for(var b=!1,c=0;c<e.selectedCandidateItems.length;c++)if(a.id==e.selectedCandidateItems[c].id){b=!0;break}return!b}),e.selectedCandidateItems=[],n()},e.removeItems=function(){e.candidateItems=e.candidateItems.concat(e.selectedResultItems),e.resultItems=c("filter")(e.resultItems,function(a){for(var b=!1,c=0;c<e.selectedResultItems.length;c++)if(a.id==e.selectedResultItems[c].id){b=!0;break}return!b}),e.selectedResultItems=[],n()}}};return e}]),angular.module("ngSharePoint").directive("spfieldMultichoice",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){function c(){var a=[];angular.forEach(b.schema.Choices.results,function(c){-1!=b.choices.indexOf(c)&&a.push(c)}),b.schema.FillInChoice&&b.fillInChoiceCheckbox&&b.fillInChoiceValue&&a.push(b.fillInChoiceValue),b.modelCtrl.$setViewValue({results:a})}var d={fieldTypeName:"multichoice",replaceAll:!1,init:function(){b.chooseText=STSHtmlEncode(Strings.STS.L_Choose_Text),b.choiceFillInDisplayText=STSHtmlEncode(Strings.STS.L_ChoiceFillInDisplayText),b.fillInChoiceCheckbox=!1,b.fillInChoiceValue=null},renderFn:function(){var a=b.modelCtrl.$viewValue;(null===a||void 0===a)&&(a={results:[]}),b.choices=[].concat(a.results),b.schema.FillInChoice&&angular.forEach(b.choices,function(a){-1==b.schema.Choices.results.indexOf(a)&&(b.fillInChoiceCheckbox=!0,b.fillInChoiceValue=a)}),b.modelCtrl.$validators.required=function(a,c){return"edit"!=b.currentMode?!0:b.schema.Required?c&&c.results.length>0?!0:!1:!0}},formatterFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a},parserFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a}};a.baseLinkFn.apply(d,arguments),b.toggleCheckbox=function(a){var d=b.choices.indexOf(a);-1!=d?b.choices.splice(d,1):b.choices.push(a),c()},b.$watch("fillInChoiceValue",function(a,d){if(a!=d){var e=b.choices.indexOf(d);-1!=e&&b.choices.splice(e,1),c()}}),b.fillInChoiceCheckboxChanged=function(){if(b.fillInChoiceCheckbox){var a=document.getElementById(b.schema.InternalName+"_"+b.schema.Id+"FillInText");a&&a.focus()}c()}}};return b}]),angular.module("ngSharePoint").directive("spfieldNote",["SPFieldDirective","SPUtils","$q","$timeout",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(e){function f(){var a=c.defer(),d='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">';return d+="<soap:Body>",d+='<GetVersionCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/">',d+="<strlistID>"+e.item.list.Id+"</strlistID>",d+="<strlistItemID>"+e.item.Id+"</strlistItemID>",d+="<strFieldName>"+e.schema.EntityPropertyName+"</strFieldName>",d+="</GetVersionCollection>",d+="</soap:Body>",d+="</soap:Envelope>",$.ajax({url:e.item.list.web.url.rtrim("/")+"/_vti_bin/lists.asmx",type:"POST",data:d,dataType:"xml",contentType:"text/xml;charset='utf-8'",complete:function(c){if(200==c.status){var d=b.parseXmlString(c.responseText),f=d.getElementsByTagName("Version"),g=[];angular.forEach(f,function(a){var b=a.getAttribute("Editor"),c={id:0,name:""};if(b){var d=b.split(",");if(d.length>0){var f=d[0].split(";#");c.id=f[0],c.name=f[1]}}var h={value:a.getAttribute(e.schema.EntityPropertyName),modified:a.getAttribute("Modified"),editor:c};g.push(h)}),a.resolve(g)}else a.reject()}}),a.promise}var g={fieldTypeName:"note",replaceAll:!1,init:function(){var a=b.parseXmlString(e.schema.SchemaXml);e.rteFullHtml="FullHtml"==a.documentElement.getAttribute("RichTextMode"),e.rteHelpMessage=STSHtmlEncode(Strings.STS.L_RichTextHelpLink),e.rteLabelText=STSHtmlEncode(Strings.STS.L_RichTextHiddenLabelText),e.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo,e.schema.AppendOnly&&(e.versions=[],e.item.list.getDefaultViewUrl().then(function(a){e.defaultViewUrl=a,f().then(function(a){e.versions=a||[]})}))},renderFn:function(){e.value=e.modelCtrl.$viewValue,e.rteFullHtml&&d(function(){var a=document.getElementById(e.schema.EntityPropertyName+"_"+e.schema.Id+"_$TextField_inplacerte");a&&(a.innerHTML=e.value||"")})},formatterFn:function(a){return e.formCtrl.fieldValueChanged(e.schema.InternalName,a,e.lastValue),e.lastValue=a,a},parserFn:function(a){return e.formCtrl.fieldValueChanged(e.schema.InternalName,a,e.lastValue),e.lastValue=a,a}};a.baseLinkFn.apply(g,arguments),e.updateModel=function(){var a=document.getElementById(e.schema.EntityPropertyName+"_"+e.schema.Id+"_$TextField_inplacerte");a&&e.modelCtrl.$setViewValue(a.innerHTML)}}};return e}]),angular.module("ngSharePoint").directive("spfieldNumber",["SPFieldDirective","SPUtils",function(a,b){var c={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(c){var d={fieldTypeName:"number",replaceAll:!1,init:function(){var a=b.parseXmlString(c.schema.SchemaXml),d=a.documentElement.getAttribute("Percentage")||c.schema.Percentage||"false",e=a.documentElement.getAttribute("Decimals")||c.schema.Decimals||"auto";c.schema.Percentage="true"===d.toLowerCase(),c.schema.Decimals=parseInt(e),c.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo},formatterFn:function(a){return"string"==typeof a&&(a=parseFloat(a),isNaN(a)&&(a=void 0)),c.formCtrl.fieldValueChanged(c.schema.InternalName,a,c.lastValue),c.lastValue=a,a},parserFn:function(a){return c.lastValue!==parseFloat(a)&&(c.formCtrl.fieldValueChanged(c.schema.InternalName,parseFloat(a),c.lastValue),c.lastValue=parseFloat(a)),parseFloat(a)}};a.baseLinkFn.apply(d,arguments),c.modelCtrl.$validators.number=function(a,b){return void 0===b||!isNaN(b)&&isFinite(b)}}};return c}]),angular.module("ngSharePoint").directive("spPercentage",[function(){var a={restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$formatters.push(function(b){if(a.schema.Percentage&&void 0!==b){var c=isNaN(a.schema.Decimals)?2:a.schema.Decimals;return(100*b).toFixed(c)}return b}),d.$parsers.push(function(b){if(a.schema.Percentage&&void 0!==b){var c=parseFloat(b/100);return isNaN(b)?b:c}return b})}};return a}]),angular.module("ngSharePoint").directive("spfieldText",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"text",replaceAll:!1,formatterFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a},parserFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldUrl",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"url",replaceAll:!1,init:function(){b.UrlFieldTypeText=Strings.STS.L_UrlFieldTypeText,b.UrlFieldTypeDescription=Strings.STS.L_UrlFieldTypeDescription,b.UrlFieldClickText=Strings.STS.L_UrlFieldClickText,b.Description_Text=Strings.STS.L_Description_Text},renderFn:function(){var a=b.modelCtrl.$viewValue;(null===a||void 0===a)&&(a={Url:"",Description:""}),b.Url=a.Url,b.Description=a.Description,b.modelCtrl.$validators.required=function(a,c){return"edit"!=b.currentMode?!0:b.schema.Required?c&&void 0!==c.Url&&""!==c.Url?!0:!1:!0}},formatterFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a},parserFn:function(a){return b.formCtrl.fieldValueChanged(b.schema.InternalName,a,b.lastValue),b.lastValue=a,a}};a.baseLinkFn.apply(c,arguments),b.$watch("[Url,Description]",function(a,c){a!==c&&b.modelCtrl.$setViewValue({Url:b.Url,Description:b.Description})}),b.modelCtrl.$validators.url=function(a,b){if(void 0===b)return!0;if(null===b)return!0;if(void 0===b.Url||""===b.Url)return!0;var c=new RegExp("^http://");return c.test(b.Url)}}};return b}]),angular.module("ngSharePoint").directive("spfieldUser",["SPFieldDirective","$q","$timeout","$filter","SharePoint","SPUtils","$compile",function(a,b,c,d,e,f,g){var h={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(d,h,i){function j(){var a=!1;if(angular.isDefined(d.schema.extendedTemplate)&&(angular.isDefined(d.schema.extendedTemplate.display)?a=!0:angular.isDefined(d.schema.extendedTemplate.edit)||(a=!0)),"display"===d.currentMode&&!a){var b=d.name.replace(/_/g,"_x005f_");if(void 0!==d.item.FieldValuesAsHtml&&void 0!==d.item.FieldValuesAsHtml[b])return void q.setElementHTML(d.item.FieldValuesAsHtml[b])}null!==d.value&&void 0!==d.value||!d.schema.AllowMultipleValues||(d.value={results:[]}),q.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),m().then(function(){q.renderField(d.currentMode)},function(){q.setElementHTML('<div style="color: red;">Error al recuperar el usuario {{value}}.</div>')})}function k(){var a=b.defer();return void 0===d.lookupList?e.getWeb().then(function(b){b.getList(d.schema.LookupList).then(function(b){d.lookupList=b,a.resolve(d.lookupList)},function(){a.reject()})},function(){a.reject()}):a.resolve(d.lookupList),a.promise}function l(a){return k().then(function(b){return b.getItemById(a)})}function m(){var a=b.defer();if(void 0!==d.selectedUserItems)a.resolve(d.selectedUserItems);else{d.selectedUserItems=[];var c=[];if(d.schema.AllowMultipleValues)angular.forEach(d.value.results,function(a){var b=l(a).then(function(a){if(void 0!==a){var b={Title:a[d.schema.LookupField]||a.Title,url:a.list.web.url.rtrim("/")+"/_layouts/15/userdisp.aspx?ID="+d.value+"&Source="+encodeURIComponent(window.location),data:a};d.selectedUserItems.push(b)}});c.push(b)});else{var e={Title:"",url:"",data:null};if(null===d.value||void 0===d.value)d.selectedUserItems.push(e);else{var f=l(d.value).then(function(a){void 0!==a&&(e={Title:a[d.schema.LookupField]||a.Title,url:a.list.web.url.rtrim("/")+"/_layouts/15/userdisp.aspx?ID="+d.value+"&Source="+encodeURIComponent(window.location),data:a},d.selectedUserItems.push(e))});c.push(f)}}b.all(c).then(function(){a.resolve(d.selectedUserItems)})}return a.promise}function n(a){var c={Id:d.schema.Id,Title:d.schema.Title,Hidden:d.schema.Hidden,IMEMode:null,Name:d.schema.InternalName,Required:d.schema.Required,Direction:d.schema.Direction,FieldType:d.schema.TypeAsString,ReadOnlyField:d.schema.ReadOnlyField,Type:"User",DependentLookup:!1,AllowMultipleValues:d.schema.AllowMultipleValues,Presence:d.schema.Presence,WithPicture:!1,DefaultRender:!0,WithPictureDetail:!1,ListFormUrl:"/_layouts/15/listform.aspx",UserDisplayUrl:"/_layouts/15/userdisp.aspx",EntitySeparator:";",PictureOnly:!1,PictureSize:null,UserInfoListId:d.schema.LookupList,SharePointGroupID:d.schema.SelectionGroup,PrincipalAccountType:"User,DL,SecGroup,SPGroup",SearchPrincipalSource:15,ResolvePrincipalSource:15},e=[];angular.forEach(d.selectedUserItems,function(a){if(null!==a.data){var b=a.data.Title,c=a.data.Name,d={AutoFillDisplayText:b,AutoFillKey:c,AutoFillSubDisplayText:"",Description:b,DisplayText:b,EntityType:"User",IsResolved:!0,Key:c,ProviderDisplayName:"",ProviderName:"",Resolved:!0};e.push(d)}}),this.SPClientPeoplePicker_InitStandaloneControlWrapper(a,e,c);var h=this.SPClientPeoplePicker.SPClientPeoplePickerDict[a+"_TopSpan"];if(d.peoplePicker=h,void 0!==h&&null!==h){h.OnUserResolvedClientScript=function(a,c){var e=[],g=[];angular.forEach(c,function(a){if(a.IsResolved)if(d.schema.AllowMultipleValues||0===g.length){var c;c="User"===a.EntityType?f.getUserInfoByLoginName(a.Key).then(function(a){return e.push(a.Id),e}):b.when(e.push(a.EntityData.SPGroupID)),g.push(c)}else d.modelCtrl.$setViewValue(d.modelCtrl.$viewValue)}),g.length>0?b.all(g).then(function(){o(e)}):o(e)};var i=document.getElementById(d.peoplePicker.EditorElementId);i&&(i.setAttribute("data-spfield-focus-element","true"),g(angular.element(i))(d))}}function o(a){d.schema.AllowMultipleValues===!0?d.value.results=a:d.value=a[0]||null,d.modelCtrl.$setViewValue(d.value)}function p(a){var b=[];return angular.forEach(a,function(a){null!==a.data&&b.push(a.data)}),d.schema.AllowMultipleValues?b:b.length>0?b[0]:void 0}var q={fieldTypeName:"user",replaceAll:!1,init:function(){d.noUserPresenceAlt=STSHtmlEncode(Strings.STS.L_UserFieldNoUserPresenceAlt),d.idPrefix=d.schema.InternalName+"_"+d.schema.Id},parserFn:function(a){if(d.schema.AllowMultipleValues){var b=d.value&&d.value.results.length>0;q.setValidity("required",!d.schema.Required||b)}else d.peoplePicker&&q.setValidity("unique",d.peoplePicker.TotalUserCount<=1);return a},watchModeFn:function(){j()},watchValueFn:function(a,b){a!==b&&(null!==d.value&&void 0!==d.value||!d.schema.AllowMultipleValues||(d.value={results:[]}),d.selectedUserItems=void 0,j())},postRenderFn:function(){if("edit"===d.currentMode){var a=d.idPrefix+"_$ClientPeoplePicker";c(function(){n(a),d.formCtrl.fieldValueChanged(d.schema.InternalName,d.value,void 0,p(d.selectedUserItems))})}}};a.baseLinkFn.apply(q,arguments),void 0!==i.dependsOn&&d.$on(i.dependsOn+"_changed",function(a,b){d.dependency={fieldName:i.dependsOn,value:b},d.lookupItems=void 0,j()}),d.IMNImageOnClick=function(a){return IMNImageOnClick(a.originalEvent),!1},d.GoToLinkOrDialogNewWindow=function(a){return GoToLinkOrDialogNewWindow(a),!1}}};return h}]),angular.module("ngSharePoint").directive("spfieldValidationMessages",[function(){var a={restrict:"E",replace:!0,templateUrl:"templates/form-templates/spfield-validation-messages.html",link:function(a){a.SPClientRequiredValidatorError=Strings.STS.L_SPClientRequiredValidatorError}};return a}]),function(){"use strict";function a(a,b,c){function d(d){function e(e){var f=[];return b.getWeb(d.field.LookupWebId).then(function(b){return b.getList(d.field.LookupList).then(function(b){var g={$expand:"Fields"};return("Lookup"==d.field.TypeAsString||"LookupMulti"==d.field.TypeAsString)&&(g.$expand+=",Forms"),b.getProperties(g).then(function(){var g=[];return angular.forEach(e,function(a){var e=b.getItemById(a).then(function(e){""===d.field.LookupField&&(d.field.LookupField="Title");var g=e[d.field.LookupField],h=b.Fields[d.field.LookupField];if("DateTime"===h.TypeAsString&&null!==g){var i="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo,j=new Date(g);g=c("date")(j,i.dateTimeFormat.ShortDatePattern+(0===h.DisplayFormat?"":" "+i.dateTimeFormat.ShortTimePattern))}"Number"===h.TypeAsString&&h.Percentage&&(g+="%"),"Computed"===h.TypeAsString&&null!==g&&(g=e.Title);var k="";return k="User"==d.field.TypeAsString||"UserMulti"==d.field.TypeAsString?e.list.web.url.rtrim("/")+"/_layouts/15/userdisp.aspx?ID="+a+"&Source="+encodeURIComponent(window.location):e.list.Forms.results[0].ServerRelativeUrl+"?ID="+a+"&Source="+encodeURIComponent(window.location),f.push({title:g,url:k}),!0});g.push(e)}),a.all(g).then(function(){return f})})})})}if(!angular.isDefined(d.item)||!angular.isDefined(d.field))throw'Required "item" or "field" attributes missing in SPFieldValue directive.';d.fieldValue="";var f=d.field.TypeAsString||d.field.Type,g=d.field.InternalName||d.field.Name;g+="Lookup"==f||"LookupMulti"==f||"User"==f||"UserMulti"==f?"Id":"";var h=d.item[g]||"";if("Calculated"===f)switch(d.field.OutputType){case SP.FieldType.dateTime:case"DateTime":f="DateTime";break;case SP.FieldType["boolean"]:case"Boolean":f="Boolean";break;case SP.FieldType.number:case"Number":f="Number";break;case SP.FieldType.currency:case"Currency":f="Number";break;default:f="Text"}if("Number"===f&&(h=parseFloat(h),isNaN(h)&&(h=void 0)),""!==h){var i="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo;switch(f){case"DateTime":d.fieldValue="<span>"+new Date(h).format(i.dateTimeFormat.ShortDatePattern)+"</span>";break;case"MultiChoice":(void 0===h||null===h)&&(h={results:[]}),d.fieldValue="<span>"+h.results.join("; ")+"</span>";break;case"Boolean":d.fieldValue="<span>"+c("boolean")(h)+"</span>";break;case"User":case"UserMulti":case"Lookup":case"LookupMulti":(void 0===h||null===h)&&(h={results:[]}),angular.isObject(h)||(h={results:[h].filter(Boolean)}),e(h.results).then(function(a){d.fieldValue="<span>",angular.forEach(a,function(a){d.fieldValue+='<a href="'+a.url+'" onclick="if(event.stopPropagation) event.stopPropagation();">'+a.title+"</a>, "}),d.fieldValue=d.fieldValue.replace(/ *, *$/,""),d.fieldValue+="</span>"});break;case"URL":0===d.field.DisplayFormat&&(d.fieldValue+='<a href="'+h.Url+'" target="_blank" onclick="if(event.stopPropagation) event.stopPropagation();">'+h.Description+"</a>"),1===d.field.DisplayFormat&&(d.fieldValue+='<img src="'+h.Url+'" alt="'+h.Description+'" />');break;case"Number":var j="";void 0!==h&&(j=h.toFixed(d.field.Decimals),d.field.Percentage&&(j+=i.numberFormat.PercentSymbol)),d.fieldValue="<span>"+j+"</span>";break;default:d.fieldValue="<span>"+h+"</span>"}}}var e={restrict:"AE",template:'<div ng-bind-html="fieldValue | unsafe"></div>',replace:!0,scope:{item:"=",field:"="},link:d};return e}angular.module("ngSharePoint").directive("spfieldValue",a),a.$inject=["$q","SharePoint","$filter"]}(),angular.module("ngSharePoint").directive("spfieldWorkflowstatus",["SPFieldDirective","SPUtils",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"workflowstatus",replaceAll:!1,displayTemplateUrl:"templates/form-templates/spfield-workflowstatus-display.html",editTemplateUrl:"templates/form-templates/spfield-workflowstatus-display.html"};a.baseLinkFn.apply(c,arguments),b.getWorkflowStatusDisplayValue=function(){return void 0!==b.value&&null!==b.value?b.schema.Choices.results[b.value]:""}}};return b}]),angular.module("ngSharePoint").directive("spfield",["$compile","$templateCache","$http",function(a,b,c){var d={restrict:"EA",require:"^?spform",template:"<div></div>",link:function(d,e,f,g){function h(){var a="";e.replaceWith(a),e=a}if(null!==g){var i,j=f.name||f.spfield;if(g&&(i=g.getFieldSchema(j)),void 0!==i){if("Attachments"===j){var k=g.getItem();if(void 0!==k&&void 0!==k.list&&k.list.EnableAttachments===!1)return console.error('Can\'t add "Attachments" field because the attachments are disabled in the list.'),void h()}c.get("templates/form-templates/spfield.html",{cache:b}).success(function(b){if(0!==e.parent().length){for(var c=e[0].attributes,f="",g=["spfield-wrapper"],h=0;h<c.length;h++){var i=c.item(h).nodeName,j=c.item(h).value;if("ng-repeat"!=i)if("spfield"==i&&(i="name"),"class"!=i)f+=i+'="'+j+'" ';else{if(j=j.replace(/ng-[\w-]*/g,"").trim(),""===j)continue;g.push(j)}}b=b.replace(/\{\{attributes\}\}/g,f.trim()),b=b.replace(/\{\{classAttr\}\}/g,g.join(" "));var k=a(b)(d);e.replaceWith(k),e=k}})}else console.error('Unknown field "'+f.name+'"'),h()}}};return d}]),angular.module("ngSharePoint").directive("spformRule",["$compile","$templateCache","$http","$animate",function(a,b,c,d){var e={restrict:"E",transclude:!0,link:function(e,f,g,h,i){g.templateUrl?c.get(g.templateUrl,{cache:b}).success(function(b){var c=a(b)(e);f.replaceWith(c),f=c}):(i(e,function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];d.enter(c,f.parent(),f)}}),f.remove(),f=null)}};return e}]),angular.module("ngSharePoint").directive("spformToolbar",["$compile","SPUtils","SPRibbon",function(a,b,c){var d={restrict:"EA",templateUrl:"templates/form-templates/spform-toolbar.html",require:"?^spform",replace:!0,transclude:!0,controller:function(a){this.getFormCtrl=function(){return a.formCtrl},this.getRibbonToolbar=function(){return a.ribbonToolbar},this.showToolbarInRibbon=function(){return a.showToolbarInRibbon},this.allowRedirect=function(){return a.noredirect}},link:function(b,d,e,f,g){function h(a){var c=!1;b.showToolbarInRibbon="true"===e.showInRibbon;for(var d=0;d<a.length;d++){var f=a[d];if(void 0!==f.tagName){var g=!1;if(g=f.hasAttribute("show-in-ribbon")?"true"===f.getAttribute("show-in-ribbon").toLowerCase():b.showToolbarInRibbon){if("spform-toolbar-button"===f.tagName.toLowerCase()&&f.hasAttribute("action")||f.hasAttribute("spform-toolbar-button")){var h=f.getAttribute("action").toLowerCase();if("save"!==h&&"cancel"!==h&&"close"!==h){c=!0;break}}if(f.hasAttribute("sp-action")){var i=f.getAttribute("sp-action").toLowerCase();if("save"!==i&&"cancel"!==i&&"close"!==i){c=!0;break}}}}}return c}function i(){var f=d.find("[sp-transclude]");if(void 0!==f&&0!==f.length||void 0===d.attr("sp-transclude")||(f=d),void 0!==f&&0!==f.length&&(g(b,function(a){h(a)?c.ready().then(function(){b.ribbonToolbar=c.createToolbar(e.name,e.tabTitle)}):b.ribbonToolbar=null,f.empty(),angular.forEach(a,function(a){a.nodeType!==a.COMMENT_NODE&&f.append(a)})}),0===f.contents().length)){switch(b.currentMode){case"display":f.append('<button type="button" sp-action="close">'+STSHtmlEncode(Strings.STS.L_CloseButtonCaption)+"</button>");break;case"edit":f.append('<button type="button" sp-action="save">'+STSHtmlEncode(Strings.STS.L_SaveButtonCaption)+"</button>"),f.append('<button type="button" sp-action="cancel">'+STSHtmlEncode(Strings.STS.L_CancelButtonCaption)+"</button>")}a(f)(b)}}null!==f&&(b.formCtrl=f,b.ribbonToolbar=null,b.$watch(f.getFormMode,function(a){b.currentMode=a,b.noredirect=void 0!==e.noredirect,i()}))}};return d}]),angular.module("ngSharePoint").directive("spform",["SPUtils","$compile","$templateCache","$http","$q","$timeout","$injector","SPExpressionResolver","SPListItem",function(a,b,c,d,e,f,g,h,i){var j={restrict:"EA",transclude:!0,replace:!0,scope:{item:"=item",mode:"=mode",extendedSchema:"=?",extendedController:"=?"},templateUrl:"templates/form-templates/spform.html",controllerAs:"spformCtrl",controller:["$scope","$attrs",function(b){this.status={IDLE:0,PROCESSING:1},this.getItem=function(){return b.item},this.getFormCtrl=function(){return b.ngFormCtrl},this.isNew=function(){return b.item.isNew()},this.registerField=function(a){this.formFields=this.formFields||[],this.formFields.push(a)},this.unregisterField=function(a){for(var b=this.formFields.length-1;b>=0;b--)this.formFields[b].name===a.name&&this.formFields.splice(b,1)},this.initField=function(a){var c=e.defer(),d=/{(\w+\W*[\w\s./\[\]\(\)]+)}(?!})/g;if(this.isNew()){var f=this.getFieldSchema(a);h.resolve(f.DefaultValue,b).then(function(e){switch(d.lastIndex=0,void 0!==e&&d.test(f.DefaultValue)&&(e=b.$eval(e)),f.TypeAsString){case"MultiChoice":b.item[a]={results:[]},null!==e&&b.item[a].results.push(e);break;case"DateTime":var g;switch(e){case"[today]":g=new Date;break;case"undefined":case void 0:case"":case null:g=void 0;break;default:g=new Date(e),isNaN(g.getTime())&&(g=void 0)}b.item[a]=g;break;case"Boolean":null!==e&&(b.item[a]="1"==e);break;case"Lookup":case"User":null!==e&&(b.item[a+"Id"]=parseInt(e));break;case"Number":case"Currency":var h=parseFloat(e);isNaN(h)||(b.item[a]=h);break;default:null!==e&&"undefined"!=e&&(b.item[a]=e)}c.resolve()})}else c.resolve();return c.promise},this.getFieldSchema=function(a){if(utils.isGuid(a)){var c=void 0;return angular.forEach(b.schema,function(b){b.Id==a&&(c=b)}),c}return b.schema[a]||b.item.list.Fields[a]||void 0},this.fieldValueChanged=function(a,c,d,e){"edit"===b.mode&&(b.$broadcast(a+"_changed",c,d,e),void 0!==b.$parent&&b.$parent.$emit(a+"_changed",c,d,e))},this.getFormMode=function(){return b.mode||"display"},this.setFormMode=function(a){b.mode=a},this.getWebRegionalSettings=function(){var a=e.defer();return void 0!==b.item.list.web.RegionalSettings?a.resolve(b.item.list.web.RegionalSettings):b.item.list.web.getProperties().then(function(){a.resolve(b.item.list.web.RegionalSettings)}),a.promise},this.getFormStatus=function(){return b.formStatus},this.setFormStatus=function(a){f(function(){b.formStatus=a,b.$apply()},0)},this.setFieldFocus=function(a){var c;this.focusElements=this.focusElements||[];for(var d=0;d<this.focusElements.length;d++)if(void 0!==a){if(this.focusElements[d].name===a){c=this.focusElements[d].element;break}}else{var e=b.ngFormCtrl[this.focusElements[d].name];if(e&&e.$invalid){c=this.focusElements[d].element;break}}return!c&&this.focusElements.length>0&&(c=this.focusElements[0]),void 0!==c&&c.length>0&&c[0].focus(),c},this.save=function(c){function d(){f&&f.close()}var f,g=this,h=e.defer();angular.isString(c)?c={redirectUrl:c}:(!angular.isObject(c)||angular.isArray(c))&&(c={}),b.ngFormCtrl.$setDirty(),b.$broadcast("validate");var i=[];return angular.forEach(this.formFields,function(a){if(void 0!==a.validate){var b=e.when(a.validate());i.push(b)}}),e.all(i).then(function(){var i=g.setFieldFocus();return b.$broadcast("postValidate",i),b.$emit("postValidate",i),b.ngFormCtrl.$valid||c.force===!0?(b.formStatus=this.status.PROCESSING,c.silent!==!0&&(f=SP.UI.ModalDialog.showWaitScreenWithNoClose(SP.Res.dialogLoading15)),angular.forEach(b.schema,function(a,c){a.isVirtualField&&delete b.item[c]}),void e.when(a.callFunctionWithParams(b.onPreSave,b)).then(function(c){c!==!1?b.item.save().then(function(){b.formStatus=this.status.IDLE,e.when(a.callFunctionWithParams(b.onPostSave,b)).then(function(a){a!==!1?h.resolve(a):h.reject(),d()
},function(){d(),h.reject()})},function(a){console.error(a),d();var b=document.createElement("div");b.innerHTML='<div style="color:brown">'+a.code+"<br/><strong>"+a.message+"</strong></div>",SP.UI.ModalDialog.showModalDialog({title:SP.Res.dlgTitleError,html:b,showClose:!0,autoSize:!0,dialogReturnValueCallback:function(){h.reject()}})}):(d(),h.reject())},function(){d(),h.reject()})):(h.reject(),h.promise)}),h.promise},this.cancel=function(){var c=e.defer();return b.ngFormCtrl.$setPristine(),b.formStatus=this.status.PROCESSING,e.when(a.callFunctionWithParams(b.onCancel,b)).then(function(a){a!==!1?(b.item=new i(b.originalItem.list,angular.copy(b.originalItem)),c.resolve(a)):c.reject()},function(){c.reject()}),c.promise},this.closeForm=function(a){window.location=void 0!==a?a:utils.getQueryStringParamByName("Source")||_spPageContextInfo.webServerRelativeUrl}}],compile:function(){return{pre:function(a,b,c){c.name||c.$set("name","spform")},post:function(g,j,k,l,m){function n(){var a=e.defer();return g.formStatus===l.status.PROCESSING?(a.reject(),a.promise):angular.isDefined(g.item)?(angular.isDefined(g.mode)||(g.mode=l.getFormMode()),g.formStatus=l.status.PROCESSING,angular.isDefined(g.extendedController)&&utils.extend(g,g.extendedController),g.item.list.getProperties({$expand:"Fields,ContentTypes,ContentTypes/Fields"}).then(function(){g.item.list.getFields().then(function(b){g.item.list.getContentType(g.item.ContentTypeId).then(function(c){c.getFields().then(function(c){var d=c;g.item.list.EnableAttachments&&(d.Attachments=b.Attachments),g.schema=d;var e={},f=SP.UI.ModalDialog.get_childDialog();if(null!==f){var h=f.get_args();null!==h&&void 0!==h.extendedSchema&&(e=h.extendedSchema)}g.extendedSchema=utils.deepExtend({Fields:{}},g.extendedSchema,e),g.schema=utils.deepExtend(g.item.list.Fields,g.schema,g.extendedSchema.Fields),angular.forEach(g.schema,function(a){a.originalTypeAsString=a.TypeAsString}),a.resolve()})})})}),a.promise):(a.reject(),a.promise)}function o(){e.when(a.callFunctionWithParams(g.onPreBind,g)).then(function(){var a,b=j.find("*");angular.forEach(b,function(b){void 0!==b.attributes["transclusion-container"]&&(a=angular.element(b))}),(void 0===a||0===a.length)&&(a=j),a.empty(),g.rules=[],g.expressions={},k.templateUrl?d.get(k.templateUrl,{cache:c}).success(function(b){q(a,angular.element(b),!1).then(function(){p(a)})}).error(function(b){j.html('<div><h2 class="ms-error">'+b+'</h2><p class="ms-error">Form Template URL: <strong>'+k.templateUrl+"</strong></p></div>"),p(a)}):m(g.childScope,function(b){q(a,b,!0).then(function(){0===a[0].children.length?(g.fields=[],angular.forEach(g.schema,function(a){a.Hidden||a.Sealed||a.ReadOnlyField||"ContentType"===a.InternalName||g.fields.push(a)}),d.get("templates/form-templates/spform-default.html",{cache:c}).success(function(b){a.append(b),p(a)})):p(a)})})})}function p(a){e.when(b(a)(g.childScope)).then(function(){var a=document.querySelector("#form-loading-animation-wrapper-"+g.$id);void 0!==a&&angular.element(a).remove(),f(function(){g.formStatus=l.status.IDLE,r(),g.$broadcast("formRenderComplete"),g.$emit("formRenderComplete")})})}function q(a,b,c,d,f,i){d=d||0,f=f||e.defer(),i=i||!1;var j=utils.getQueryStringParamByName("rule"),k="";if(void 0!==j){j=parseInt(j);for(var l=0,m=0;l<b.length&&(k=b[l],void 0===k.tagName||"spform-rule"!==k.tagName.toLowerCase()||(m++,m!==j));l++);if(""!==k)return h.resolve(k.outerHTML,g).then(function(b){return a.append(angular.element(b)[0]),f.resolve(),f.promise})}var n=b[d++];if(void 0===n)return f.resolve(),f.promise;if(void 0!==n.tagName&&"spform-rule"==n.tagName.toLowerCase())if(i)q(a,b,c,d,f,i);else{var o="false",p="false";n.hasAttribute("test")&&(o=n.getAttribute("test")),n.hasAttribute("terminal")&&(p=n.getAttribute("terminal"));var r;n.hasAttribute("name")&&(r=n.getAttribute("name")),h.resolve(o,g).then(function(e){g.$eval(e)?(n.setAttribute("test",e),h.resolve(p,g).then(function(j){n.setAttribute("terminal",j),i=g.$eval(j),h.resolve(n.outerHTML,g).then(function(h){var k=angular.element(h)[0];a.append(k),g.rules.push({test:o,testResolved:e,terminal:p,terminalResolved:j,solved:!0,name:r}),q(a,b,c,d,f,i)})})):(c&&(n.remove(),n=null),g.rules.push({test:o,testResolved:e,terminal:p,terminalResolved:"n/a",solved:!1,name:r}),q(a,b,c,d,f,i))})}else a.append(n),q(a,b,c,d,f,i);return f.promise}function r(){SP.UI.ModalDialog.get_childDialog()&&f(function(){SP.UI.ModalDialog.get_childDialog().autoSize()})}g.ngFormCtrl=g[k.name],g.isInDesignMode=a.inDesignMode(),g.isInDesignMode||(g.$watch("mode",function(a,b){void 0!==a&&a!==b&&(void 0!==g.childScope&&g.childScope.$destroy(),g.childScope=g.$new(),n().then(function(){o()}))}),g.$watch("item",function(a){void 0!==a&&(void 0!==g.childScope&&g.childScope.$destroy(),g.childScope=g.$new(),g.originalItem=new i(g.item.list,angular.copy(g.item)),n().then(function(){o()}))}))}}}};return j}]),function(){"use strict";function a(){function a(a,b){a.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo,a.contentTypeText="Content Type",a.versionText=SP.Res.storefront_AppDetails_Version,a.createdAtText="Created at",a.lastModifiedText="Last modified at",a.byText="by",void 0!==a.item&&(a.item.isNew()||(a.createdDate=a.item.Created,a.modifiedDate=a.item.Modified,a.authorName=null,a.editorName=null,a.item.list.web.getUserById(a.item.AuthorId).then(function(b){a.authorName=b.Title,a.authorLink=_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/userdisp.aspx?ID="+a.item.AuthorId}),a.item.list.web.getUserById(a.item.EditorId).then(function(b){a.editorName=b.Title,a.editorLink=_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/userdisp.aspx?ID="+a.item.EditorId}))),a.originalAuthoringInfoFound=!1;var c=document.getElementById("ngsharepoint-formbinder-authoringinfo");c&&(b.append(c),c.style.display="block",a.originalAuthoringInfoFound=!0)}var b={restrict:"EA",replace:!0,templateUrl:"templates/form-templates/spitem-authoringinfo.html",link:a};return b}angular.module("ngSharePoint").directive("spitemAuthoringinfo",a),a.$inject=["SharePoint"]}(),angular.module("ngSharePoint").directive("spuser",["SharePoint",function(a){return{restrict:"A",replace:!1,scope:{UserData:"=spuser"},link:function(b,c,d){a.getCurrentWeb().then(function(a){b.currentWeb=a,void 0===c[0].attributes["user-id"]?b.currentWeb.getCurrentUser().then(function(a){b.UserData=a}):b.$watch(function(){return b.$eval(d.userId)},function(a){void 0!==a&&b.currentWeb.getUserById(a).then(function(a){b.UserData=a})})})}}}]),angular.module("ngSharePoint").directive("spworkingonit",[function(){return{restrict:"EA",templateUrl:"templates/spworking-on-it.html"}}]),angular.module("ngSharePoint").filter("boolean",[function(){return function(a){return STSHtmlEncode(a?Strings.STS.L_SPYes:Strings.STS.L_SPNo)}}]),angular.module("ngSharePoint").filter("newlines",["$sce",function(a){return function(b){return a.trustAsHtml((b||"").replace(/\n\r?/g,"<br/>"))}}]),angular.module("ngSharePoint").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("ngSharePointFormPage",["ngSharePoint","ngSharePoint.templates","oc.lazyLoad"]),angular.module("ngSharePointFormPage").config(["SPConfigProvider","$ocLazyLoadProvider",function(a,b){a.options.loadMinimalSharePointInfraestructure=!1,b.config({loadedModules:["ngSharePoint","ngSharePointFormPage"]})}]),angular.module("ngSharePointFormPage").directive("spformpage",["SharePoint","SPUtils","SPListItem","$q","$http","$templateCache","$compile","ctx","$ocLazyLoad","$window",function(a,b,c,d,e,f,g,h,i){return{restrict:"EA",link:function(b,j){function k(a){var e=d.defer();if(h.ControlMode==SPClientTemplates.ClientControlMode.NewForm){var f={ContentTypeId:utils.getQueryStringParamByName("ContentTypeId")},g=new c(b.list,f);e.resolve(g)}else b.list.getItemById(a,"FieldValuesAsHtml").then(function(a){var b=utils.getQueryStringParamByName("ContentTypeId");void 0!==b&&(a.ContentTypeId=b),e.resolve(a)},function(a){console.log("Error item",a)});return e.promise}function l(){var a,c=d.defer(),g="new"==q?q:b.mode;return void 0!==formDefinition.templates&&(a=formDefinition.templates[g]),void 0===a&&(a=b.web.url.rtrim("/")+"/ngSharePointFormTemplates/"+b.list.Title+"-"+h.ListData.Items[0].ContentType+"-"+g+"Form.html"),e.get(a,{cache:f}).success(function(){c.resolve(a)}).error(function(a){console.log(a),c.resolve("")}),c.promise}function m(){var a=d.defer();return SP.SOD.registerSod("formDefinition",b.web.url.rtrim("/")+"/ngSharePointFormTemplates/"+b.list.Title+"-"+h.ListData.Items[0].ContentType+"-definition.js"),SP.SOD.executeFunc("formDefinition",null,function(){var b=[];void 0!==formDefinition?(angular.forEach(formDefinition.angularModules,function(a){b.push(n(a))}),angular.forEach(formDefinition.jsIncludes,function(a){b.push(n(a))}),angular.forEach(formDefinition.cssIncludes,function(a){b.push(n(a))}),i.load(b).then(function(){a.resolve(formDefinition)},function(b){a.reject(b)})):a.resolve({})}),a.promise}function n(a){if(void 0===a)return a;if(a.files)if(angular.isArray(a.files))for(var c=0;c<a.files.length;c++)a.files[c]=a.files[c].replace(/~site/g,b.web.url.rtrim("/"));else angular.isString(a.files)&&(a.files=a.files.replace(/~site/g,b.web.url.rtrim("/")));return a}var o=_spPageContextInfo.pageListId,p=utils.getQueryStringParamByName("ID"),q="display",r="display";switch(b.mode="display",h.ControlMode){case SPClientTemplates.ClientControlMode.Invalid:q="invalid",r="display",b.mode="display";break;case SPClientTemplates.ClientControlMode.DisplayForm:q="display",r="display",b.mode="display";break;case SPClientTemplates.ClientControlMode.EditForm:q="edit",r="edit",b.mode="edit";break;case SPClientTemplates.ClientControlMode.NewForm:q="new",r="edit",b.mode="edit";break;case SPClientTemplates.ClientControlMode.View:q="view",r="display",b.mode="display"}if(void 0===o)throw"Can't access to the page context list or the page context does not exists.";a.getWeb().then(function(a){b.web=a,a.getList(o).then(function(a){b.list=a,a.getProperties({$expand:"Fields,ContentTypes,ContentTypes/Fields"}).then(function(){k(p).then(function(a){m(a).then(function(c){var d=c.hideRibbon,e=SP.UI.ModalDialog.get_childDialog();if(null!==e){var f=e.get_args();null!==f&&void 0!==f.hideRibbon&&(d=f.hideRibbon)}if("function"==typeof d&&(d=d()),d===!0){var h=$("#s4-ribbonrow");h.next().height(h.next().height()+h.height()),h.remove()}c.formModesOverride&&(b.mode=c.formModesOverride[q]||r,"display"!==b.mode&&"edit"!==b.mode&&(b.mode=r)),l().then(function(d){var e="";b.extendedSchema=c.extendedSchema||{},b.controller=c.controller||{},e='<div data-spform="true" name="spform" mode="mode" item="item" extended-schema="extendedSchema" extended-controller="controller" template-url="'+d+'"></div>';var f=g(e)(b);j.replaceWith(f),j=f,b.item=a})},function(a){console.error(a)})})})},function(a){console.log("Error list",a)})},function(a){console.log("Error web",a)})}}}]);