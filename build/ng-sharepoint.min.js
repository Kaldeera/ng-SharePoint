/*
 * ng-sharepoint
 * https://github.com/Kaldeera/ng-sharepoint/
 * Pau Codina & Pedro Castro - Kaldeera
 * Version: 0.0.1 - 2014-12-18
 * License: MIT
 */
angular.module("CamlHelper",[]).value("CamlOperatorEnumerator",{CamlQueryOperator:{BeginsWith:"BeginsWith",Contains:"Contains",DateRangesOverlap:"DateRangesOverlap",Eq:"Eq",Geq:"Geq",Gt:"Gt",In:"In",Includes:"Includes",IsNotNull:"IsNotNull",IsNull:"IsNull",Leq:"Leq",Lt:"Lt",Neq:"Neq",NotIncludes:"NotIncludes"}}).provider("CamlQueryHelperProvider",function(){"use strict";var a=function(a){this.CamlQueryHelper=function(){return{Query:"",OrderByFields:"",GroupByFiels:"",Wrap:function(a,b){return"<"+a+">"+b+"</"+a+">"},Join:function(b,c,d,e,f){var g;g=f?"<FieldRef Name='"+c+"' LookupId='True' />":"<FieldRef Name='"+c+"' />";var h=b,i="";switch(b){case a.CamlQueryOperator.In:e=e.replace("[",""),e=e.replace("]","");var j=e.split(","),k="<Values>";j.forEach(function(a){var b=a.trim(),c="";c=isNaN(parseInt(b))?"<Value Type='Text'>"+b+"</Value>":"<Value Type='Integer'>"+b+"</Value>",k+=c}),k+="</Values>",i=g+k;break;case a.CamlQueryOperator.IsNull:case a.CamlQueryOperator.IsNotNull:i=g;break;default:var l="<Value Type='"+d+"'>"+e+"</Value>";i=g+l}return this.Wrap(h,i)},OrJoin:function(a,b,c,d,e){var f=this.Join(a,b,c,d,e);this.Query?(this.Query+=f,this.Query=this.Wrap("Or",this.Query)):this.Query+=f},AndJoin:function(a,b,c,d,e){var f=this.Join(a,b,c,d,e);this.Query?(this.Query+=f,this.Query=this.Wrap("And",this.Query)):this.Query+=f},AddOrderByField:function(a,b){this.OrderByFields+="<FieldRef Name='"+a+"' Ascending='"+b+"' />"},AddGroupByField:function(a){this.GroupByFiels+="<FieldRef Name='"+a+"' />"},ToString:function(){var a="",b="",c="";return this.Query&&(a=this.Wrap("Where",this.Query)),this.OrderByFields&&(b=this.Wrap("OrderBy",this.OrderByFields)),this.GroupByFiels&&(c=this.Wrap("GroupBy",this.GroupByFiels)),"<Query>"+a+c+b+"</Query>"}}}};this.$get=function(b){return new a(b)}}).provider("ODataSentencePartProvider",function(){var a=function(a){this.ODataSentencePart=function(b,c,d){return{Expression:b,Join:c,Fields:d,ProcessOk:!1,Operator:"",Left:"",Right:"",Field:"",Value:"",process:function(){if(this.testOperator(" eq ")&&this.processOperator(" eq ",a.CamlQueryOperator.Eq),this.testOperator(" ne ")&&this.processOperator(" ne ",a.CamlQueryOperator.Neq),this.testOperator(" gt ")&&this.processOperator(" gt ",a.CamlQueryOperator.Gt),this.testOperator(" ge ")&&this.processOperator(" ge ",a.CamlQueryOperator.Geq),this.testOperator(" lt ")&&this.processOperator(" lt ",a.CamlQueryOperator.Lt),this.testOperator(" le ")&&this.processOperator(" le ",a.CamlQueryOperator.Leq),this.testOperator(" lt ")&&this.processOperator(" lt ",a.CamlQueryOperator.Lt),this.testOperator(" in ")&&this.processOperator(" in ",a.CamlQueryOperator.In),this.testOperator(" contains ")&&this.processOperator(" contains ",a.CamlQueryOperator.Contains),this.testOperator(" beginswith ")&&this.processOperator(" beginswith ",a.CamlQueryOperator.Contains),this.testOperator(" isnull")&&this.processOperator(" isnull",a.CamlQueryOperator.IsNull),this.testOperator(" isnotnull")&&this.processOperator(" isnotnull",a.CamlQueryOperator.IsNotNull),!this.ProcessOk)throw"Invalid sentence: "+this.Expression;if(!this.isValidFieldInternalName(this.Fields,this.Left,this.Right)&&!this.isValidFieldInternalName(this.Fields,this.Right,this.Left))throw"Invalid sentence, any valid field vas specified ("+this.Expression+")"},isValidFieldInternalName:function(a,b,c){try{return this.Field=this.Fields.Fields[b],this.Value=c,!0}catch(d){return!1}},processOperator:function(a,b){this.Operator=b;var c=this.Expression.indexOf(a);this.Left=this.Expression.substring(0,c),this.Right=this.Expression.substring(c+a.length),this.ProcessOk=!0},testOperator:function(a){return-1==this.Expression.toLowerCase().indexOf(a)?!1:!0}}}};this.$get=function(b){return new a(b)}}).provider("ODataParserProvider",function(){var a=function(a,b){this.ODataParser=function(c){if(void 0===c)throw"fieldsSchema not specified";return{Filter:"",Sort:"",Select:"",Top:"",Paging:!1,Skip:"",Sentences:[],FieldsSchema:c,parseExpression:function(a){this.Filter="",this.Sort="",this.Select="",this.Top="",this.Skip="",this.GroupBy="",this.Paging=!1,void 0!==a.filter&&(this.Filter=a.filter),void 0!==a.orderBy&&(this.Sort=a.orderBy),void 0!==a.select&&(this.Select=a.select),void 0!==a.groupBy&&(this.GroupBy=a.groupBy),void 0!==a.top&&(this.Top=a.top),void 0!==a.paging&&(this.Paging=a.paging),void 0!==a.skip&&(this.Skip=a.skip);for(var b=this.Filter;b.length>0;){var c=this.getNextSentence(b),d=c.dataSentencePart;d.process(),b=c.expression,this.Sentences.push(d)}},getCAMLQuery:function(){var b="",c=a.CamlQueryHelper();this.Sentences.reverse();for(var d=0;d<this.Sentences.length;d++){var e=!1,f=this.Sentences[d];if("Lookup"==f.Field.get_typeAsString()||"User"==f.Field.get_typeAsString()||"LookupMulti"==f.Field.get_typeAsString()||"UserMulti"==f.Field.get_typeAsString()){var g=f.Value;g=g.replace("[",""),g=g.replace("]","");var h=g.split(",");e=isNaN(parseInt(h[0]))?!1:!0}switch(f.Join){case"or":c.OrJoin(f.Operator,f.Field.get_internalName(),f.Field.get_typeAsString(),f.Value,e);break;default:c.AndJoin(f.Operator,f.Field.get_internalName(),f.Field.get_typeAsString(),f.Value,e)}}if(this.Sort.length>0)for(var i=this.Sort.split(","),j=0;j<i.length;j++)if(""!==i[j]){var k=i[j],l=k.trim().split(" ");try{var m=this.FieldsSchema.Fields[l[0]],n=!0;l.length>1&&"desc"==l[1].trim().toLowerCase()&&(n=!1),c.AddOrderByField(m.get_internalName(),n)}catch(o){throw o}}if(void 0!==this.GroupBy&&""!==this.GroupBy)for(var p=this.GroupBy.split(","),q=0;q<p.length;q++){var r=p[q].trim();r.length>0&&c.AddGroupByField(r)}b=c.ToString();var s="";void 0!==this.Top&&""!==this.Top&&(s+="<RowLimit Paged='TRUE'>"+this.Top+"</RowLimit>");var t="";if(this.Select.length>0){t="<ViewFields>";for(var u=this.Select.split(","),v=0;v<u.length;v++){var w=u[v].trim();w.length>0&&(t+="<FieldRef Name='"+w+"' />")}t+="</ViewFields>"}return"<View>"+t+b+s+"</View>"},getNextSentence:function(a){var c=-1,d=" and ";c=a.toLowerCase().indexOf(d),-1==c&&(d=" or ",c=a.toLowerCase().indexOf(d)),-1==c&&(c=a.length,d="");var e=a.substring(0,c);a=a.substring(c+d.length);var f=b.ODataSentencePart(e,d.trim(),this.FieldsSchema),g={expression:a,dataSentencePart:f};return g}}}};this.$get=function(b,c,d){return new a(b,c,d)}}),function(){"use strict";function a(a,b,c,d){function e(e,f,g,h){function i(){switch(f.removeAttr("sp-action"),f.attr("ng-click","makeAction();"+(g.ngClick||"")),f.attr("ng-disabled","isInDesignMode || formCtrl.getFormStatus() != status.IDLE"),f.addClass("spform-toolbar-element spform-toolbar-action"),g.spAction.toLowerCase()){case"save":e.action=k,n=n||"default",d.ready().then(function(){d.registerCommand("Ribbon.ListForm.Edit.Commit.Publish",m,!0)});break;case"cancel":e.action=l,n=n||"default",d.ready().then(function(){d.registerCommand("Ribbon.ListForm.Edit.Commit.Cancel",m,!0)});break;case"close":e.action=l,n=n||"default";break;default:e.action=e.spAction,("true"===g.showInRibbon||!angular.isDefined(g.showInRibbon)&&h.showToolbarInRibbon())&&d.ready().then(function(){var a=h.getRibbonToolbar();a&&d.addButtonToToolbar(a,j(),m,o,p)})}a(f)(e)}function j(){var a="";return a="input"==f.get(0).tagName.toLowerCase()?f.val():f.text()}function k(){return e.formCtrl.save(n)}function l(){return e.formCtrl.cancel(n)}function m(){e.formCtrl.setFormStatus(e.status.PROCESSING);var a=function(){try{return e.action()}catch(a){return console.error('>>>> ngSharePoint: sp-action "'+j()+'" rejected automatically due to an unhandled exception.'),b.reject(a)}};b.when(a()).then(function(a){if(a!==!1&&n){switch(n.toLowerCase()){case"display":n=window.location.href.toLowerCase().replace(/new|edit/,"display");break;case"edit":n=window.location.href.toLowerCase().replace(/disp|new/,"edit");break;case"new":n=window.location.href.toLowerCase().replace(/disp|edit/,"new");break;case"default":n=utils.getQueryStringParamByName("Source")||_spPageContextInfo.webServerRelativeUrl}window.location=n}},function(a){a&&console.error(a)}).finally(function(){e.formCtrl.setFormStatus(e.status.IDLE)})}e.formCtrl=h.getFormCtrl(),e.isInDesignMode=c.inDesignMode(),e.status=e.formCtrl.status,e.makeAction=m;var n=g.redirectUrl,o=(g.ngClick,g.tooltip),p=g.description;i()}var f={restrict:"A",require:"^spformToolbar",priority:500,terminal:!0,scope:{spAction:"&",redirectUrl:"@"},link:e};return f}angular.module("ngSharePoint").directive("spAction",a),a.$inject=["$compile","$q","SPUtils","SPRibbon"]}(),angular.module("ngSharePoint").directive("spIf",["$compile","SPExpressionResolver",function(a,b){var c={restrict:"A",terminal:!0,priority:600,link:function(c,d,e){b.resolve(e.spIf,c).then(function(b){c.$eval(b)?(d.removeAttr("sp-if"),d=a(d,600)(c)):(d.remove(),d=null)})}};return c}]),angular.module("ngSharePoint").directive("spfieldAttachments",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(b){var c={fieldTypeName:"attachments",replaceAll:!1,init:function(){b.DeleteAttachmentText=STSHtmlEncode(Strings.STS.L_DeleteDocItem_Text),b.AttachFileText=Resources.core.cui_ButAttachFile,b.L_Menu_LCID=L_Menu_LCID},watchValueFn:function(){c.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),b.$parent.item.getAttachments().then(function(a){b.attachmentFiles=a,c.renderField()},function(a){b.errorMsg=a.message,c.setElementHTML('<span style="color: brown">{{errorMsg}}</span>')})}};a.baseLinkFn.apply(c,arguments),b.onFileSelect=function(a,c){angular.forEach(a,function(a){for(var c=-1,d=0;d<b.attachmentFiles.length;d++)if(b.attachmentFiles[d].FileName==a.name){c=d;break}c>=0?alert(Strings.STS.L_ConflictReplaceTitle+" '"+a.name+"'."):(b.$parent.item.attachments.add.push(a),b.attachmentFiles.push({FileName:a.name,local:!0}))}),c.target.value=""},b.removeAttachment=function(a,c,d){if(a.preventDefault(),d){for(var e=0;e<b.$parent.item.attachments.add.length;e++)if(b.$parent.item.attachments.add[e].name==b.attachmentFiles[c].FileName){b.$parent.item.attachments.add.splice(e,1);break}b.attachmentFiles.splice(c,1)}else{var f=Strings.STS.L_ConfirmDelete_TXT;recycleBinEnabled&&(f=Strings.STS.L_ConfirmRecycle_TXT),confirm(f)&&(b.$parent.item.attachments.remove.push(b.attachmentFiles[c].FileName),b.attachmentFiles.splice(c,1))}return!1}}};return b}]),angular.module("ngSharePoint").directive("fileSelect",["$parse","$timeout","SPRibbon",function(a,b,c){var d=function(d,e,f){var g=a(f.fileSelect);if(e.removeAttr("file-select"),"input"!==e[0].tagName.toLowerCase()||e.attr("type")&&"file"!==e.attr("type").toLowerCase()){for(var h=angular.element('<input type="file">'),i=0;i<e[0].attributes.length;i++)h.attr(e[0].attributes[i].name,e[0].attributes[i].value);e.attr("data-multiple")&&h.attr("multiple","true"),h.css({position:"absolute",top:"0px",bottom:"0px",right:"0px",width:"200%",margin:"0px",padding:"0px",opacity:"0",filter:"alpha(opacity=0)","z-index":"1000",cursor:"pointer"}),e.append(h),h.parent()[0]!=e[0]&&(e.wrap("<span>"),e.css("z-index","-1000"),e.parent().append(h),e=e.parent()),(""===e.css("position")||"static"===e.css("position"))&&e.css("position","relative"),e.css({display:"inline-block",overflow:"hidden",cursor:"pointer"}),e=h}e.bind("change",function(a){var c=[],e=a.__files_||a.target.files;if(null!==e)for(var f=0;f<e.length;f++)c.push(e.item(f));b(function(){g(d,{$files:c,$event:a})})}),c.ready().then(function(){c.attachFileElement=e,c.registerCommand("Ribbon.ListForm.Edit.Actions.AttachFile",function(){c.attachFileElement.click()},!0)})};return d}]),angular.module("ngSharePoint").directive("spfieldBoolean",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"boolean",replaceAll:!1,watchValueFn:function(a){b.displayValue=STSHtmlEncode(a?Strings.STS.L_SPYes:Strings.STS.L_SPNo)}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldCalculated",[function(){var a={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{value:"=ngModel"},templateUrl:"templates/form-templates/spfield-text-display.html"};return a}]),angular.module("ngSharePoint").directive("spfieldChoice",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"choice",replaceAll:!1,init:function(){b.choices=b.schema.Choices.results}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldControl",["$compile","$templateCache","$http",function(a){var b={restrict:"EA",require:"^spform",replace:!0,templateUrl:"templates/form-templates/spfield-control.html",link:function(b,c,d,e){function f(){var a="";c.replaceWith(a),c=a}var g=d.name||d.spfieldControl,h=e.getFieldSchema(g);if(void 0!==h){if("Attachments"===g){var i=e.getItem();if(void 0!==i&&void 0!==i.list&&i.list.EnableAttachments===!1)return console.error('Can\'t add "Attachments" field because the attachments are disabled in the list.'),void f()}if(e.initField(g),"hidden"==d.mode)return void c.addClass("ng-hide");var j=h.hasExtendedSchema?h.originalTypeAsString:h.TypeAsString;"UserMulti"===j&&(j="User");var k=g+("Lookup"==j||"LookupMulti"==j||"User"==j||"UserMulti"==j?"Id":"");if(h.hasExtendedSchema&&(j=h.TypeAsString),("Lookup"==j||"LookupMulti"==j)&&null!==h.PrimaryFieldId){var l=e.getFieldSchema(h.PrimaryFieldId);void 0!==l&&(k=l.InternalName+"Id")}d.required&&(h.Required="true"==d.required);var m=' ng-model="item.'+k+'"',n=' name="'+g+'"',o=d.mode?' mode="'+d.mode+'"':"",p=d.dependsOn?' depends-on="'+d.dependsOn+'"':"",q="hidden"==d.mode?' ng-hide="true"':"",r=' ng-required="'+h.Required+'"';switch(h.TypeAsString){case"Text":case"Note":r+=' ng-maxlength="'+h.MaxLength+'"'}d.renderAs&&(j=d.renderAs);var s="<spfield-"+j+m+n+o+p+q+r+"></spfield-"+j+">",t=a(s)(b);c.replaceWith(t),c=t}else console.error('Unknown field "'+d.name+'"'),f()}};return b}]),angular.module("ngSharePoint").directive("spfieldCurrency",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"currency",replaceAll:!1,init:function(){b.currentyLocaleId=b.schema.CurrencyLocaleId,b.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo},parserFn:function(a){return c.setValidity("number",!a||!isNaN(+a)&&isFinite(a)),(""===a||void 0===a)&&(b.value=null),b.value}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldDatetime",["SPFieldDirective","$filter","$timeout","$q","SPUtils",function(a,b,c,d,e){var f={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(f){function g(){var a=d.defer();return f.formCtrl.getWebRegionalSettings().then(function(c){f.webRegionalSettings=c,e.getRegionalSettings().then(function(a){f.regionalSettings=a,f.direction=a.get_isRightToLeft()?"rtl":"ltr"}),e.getCurrentUserLCID().then(function(c){f.lcid=c,f.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo;var d=["00","05","10","15","20","25","30","35","40","45","50","55"],e=["12 AM","1 AM","2 AM","3 AM","4 AM","5 AM","6 AM","7 AM","8 AM","9 AM","10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM","7 PM","8 PM","9 PM","10 PM","11 PM"],g=["00:","01:","02:","03:","04:","05:","06:","07:","08:","09:","10:","11:","12:","13:","14:","15:","16:","17:","18:","19:","20:","21:","22:","23:"],h="01:59:59.9999809",i="0111110",k="109207",l="2666269";if(f.hoursMode24=f.webRegionalSettings.Time24,f.idPrefix=f.schema.InternalName+"_"+f.schema.Id,f.minutes=d,f.hours=f.hoursMode24?g:e,f.datePickerPath=j(),f.datePickerUrl=STSHtmlEncode(f.datePickerPath)+"iframe.aspx?cal="+STSHtmlEncode(String(f.webRegionalSettings.CalendarType))+"&lcid="+STSHtmlEncode(f.lcid)+"&langid="+STSHtmlEncode(_spPageContextInfo.currentLanguage)+"&tz="+STSHtmlEncode(h)+"&ww="+STSHtmlEncode(i)+"&fdow="+STSHtmlEncode(f.webRegionalSettings.FirstDayOfWeek)+"&fwoy="+STSHtmlEncode(f.webRegionalSettings.FirstWeekOfYear)+"&hj="+STSHtmlEncode(f.webRegionalSettings.AdjustHijriDays)+"&swn="+STSHtmlEncode(f.webRegionalSettings.ShowWeeks)+"&minjday="+STSHtmlEncode(k)+"&maxjday="+STSHtmlEncode(l)+"&date=",f.DatePickerFrameID=g_strDatePickerFrameID,f.DatePickerImageID=g_strDatePickerImageID,null!==f.value&&void 0!==f.value){f.dateModel=new Date(f.value),f.dateOnlyModel=b("date")(f.dateModel,f.cultureInfo.dateTimeFormat.ShortDatePattern),f.minutesModel=f.dateModel.getMinutes().toString();var m=f.dateModel.getHours();f.hoursModel=m.toString()+(f.hoursMode24?":":""),10>m&&(f.hoursModel="0"+f.hoursModel)}else f.dateModel=f.dateOnlyModel=f.minutesModel=f.hoursModel=null;a.resolve()})}),a.promise}function h(){var a=this,b=this.resultfunc;this.resultfunc=function(){b(),c(function(){f.$apply(function(){f.dateOnlyModel=a.resultfield.value})})}}function i(a,b){if(a!==b&&void 0!==f.dateOnlyModel&&null!==f.dateOnlyModel)try{for(var c=f.dateOnlyModel.split(f.cultureInfo.dateTimeFormat.DateSeparator),d=f.cultureInfo.dateTimeFormat.ShortDatePattern.split(f.cultureInfo.dateTimeFormat.DateSeparator),e={},g=0;g<d.length;g++)e[d[g]]=c[g];var h=f.hoursModel;null!==h&&(h=f.hoursMode24?h.substr(0,h.length-1):h.substr(0,2));var i=f.minutesModel,j=new Date(Date.UTC(e.yyyy,(e.MM||e.M)-1,e.dd||e.d,h,i));f.value=j.toISOString()}catch(k){f.value=null}}function j(){var a=_spPageContextInfo.webServerRelativeUrl;return null===a&&(a=""),a.endsWith("/")&&(a=a.substring(0,a.length-1)),a+="/_layouts/15/"}var k={fieldTypeName:"datetime",replaceAll:!1,watchModeFn:function(a){g().then(function(){k.renderField(a)})}};a.baseLinkFn.apply(k,arguments),f.showDatePicker=function(a){var b=f.idPrefix+"_$DateTimeFieldDate",c=document.getElementById(b+g_strDatePickerFrameID);return null!==c&&(Boolean(c.attachEvent)?c.attachEvent("onreadystatechange",h):Boolean(c.addEventListener)&&(c.Picker=c,c.readyState="complete",c.addEventListener("load",h,!1))),clickDatePicker(b,f.datePickerUrl,f.dateOnlyModel,a.originalEvent),!1},f.$watch("[dateOnlyModel, hoursModel, minutesModel]",i,!0)}};return f}]),angular.module("ngSharePoint").directive("spfieldDescription",[function(){var a={restrict:"EA",require:"^spform",replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-description.html",link:function(a,b,c,d){a.schema=d.getFieldSchema(c.name),a.$watch(function(){return a.mode||d.getFormMode()},function(b){a.currentMode=b})}};return a}]),angular.module("ngSharePoint").directive("spfieldFocusElement",[function(){var a={restrict:"A",link:function(a,b){function c(b){for(var c=0;c<a.formCtrl.focusElements.length;c++)if(a.formCtrl.focusElements[c].name===b)return!0;return!1}a.formCtrl&&(a.formCtrl.focusElements=a.formCtrl.focusElements||[],c(a.name)||a.formCtrl.focusElements.push({name:a.name,element:b}))}};return a}]),angular.module("ngSharePoint").directive("spfieldLabel",[function(){var a={restrict:"EA",require:"^spform",replace:!0,scope:{mode:"@"},templateUrl:"templates/form-templates/spfield-label.html",link:function(a,b,c,d){a.schema=d.getFieldSchema(c.name),a.label=void 0!==c.label?c.label:a.schema?a.schema.Title:"",a.$watch(function(){return a.mode||d.getFormMode()},function(b){a.currentMode=b})}};return a}]),angular.module("ngSharePoint").directive("spfieldLookup",["SPFieldDirective","$q","$filter","SharePoint",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(e,f,g){function h(){m.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),i(e.currentMode).then(function(){m.renderField()},function(a){e.errorMsg=a.message,m.setElementHTML(void 0===e.value?"":'<span style="color: brown">{{errorMsg}}</span>')})}function i(a){return"edit"===a?l():k()}function j(){var a=b.defer();return void 0===e.lookupList?d.getWeb(e.schema.LookupWebId).then(function(b){b.getList(e.schema.LookupList).then(function(b){e.lookupList=b,b.getProperties({$expand:"Forms"}).then(function(){b.getFields().then(function(){a.resolve(e.lookupList)},function(b){a.reject(b)})},function(b){a.reject(b)})},function(b){a.reject(b)})}):a.resolve(e.lookupList),a.promise}function k(){var a=b.defer();return void 0!==e.lookupItem?a.resolve(e.lookupItem):j().then(function(b){null===e.value||0===e.value||void 0===e.value?(e.lookupItem={Title:"",url:""},a.resolve(e.lookupItem)):b.getItemById(e.value).then(function(b){var d=b[e.schema.LookupField],f=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===f.TypeAsString&&null!==d){var g=__cultureInfo||Sys.CultureInfo.CurrentCulture,h=new Date(d);d=c("date")(h,g.dateTimeFormat.ShortDatePattern+(0===f.DisplayFormat?"":" "+g.dateTimeFormat.ShortTimePattern))}"Number"===f.TypeAsString&&f.Percentage&&(d+="%"),"Computed"===f.TypeAsString&&null!==d&&(d=b.Title),e.lookupItem={Title:d,url:b.list.Forms.results[0].ServerRelativeUrl+"?ID="+e.value+"&Source="+encodeURIComponent(window.location)},a.resolve(e.lookupItem)},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}function l(){var a=b.defer();return void 0!==e.lookupItems?a.resolve(e.lookupItems):j().then(function(b){var c=void 0;void 0!==e.dependency&&(c={$select:"*, "+e.dependency.fieldName+"/Id",$expand:e.dependency.fieldName+"/Id",$filter:e.dependency.fieldName+"/Id eq "+e.dependency.value}),b.getListItems(c).then(function(b){if(e.lookupItems=b,e.schema.Required||(e.lookupItems=[{Id:0,Title:STSHtmlEncode(Strings.STS.L_LookupFieldNoneOption)}].concat(b)),(null===e.value||void 0===e.value)&&(e.value=e.schema.Required?e.lookupItems.length>0?e.lookupItems[0].Id:null:0),void 0!==e.dependency){var c=e.lookupItems.reduce(function(a,b){return e.value===b.Id||a},!1);c||(e.value=e.lookupItems.length>0?e.lookupItems[0].Id:null)}e.valueChanged(),a.resolve(e.lookupItems)},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}var m={fieldTypeName:"lookup",replaceAll:!1,watchModeFn:function(){h()},watchValueFn:function(a,b){a!==b&&(e.lookupItem=void 0,h())}};a.baseLinkFn.apply(m,arguments),void 0!==g.dependsOn&&e.$on(g.dependsOn+"_changed",function(a,b){e.dependency={fieldName:g.dependsOn,value:b},e.lookupItems=void 0,h()}),e.valueChanged=function(){e.lastValue!==e.value&&(e.formCtrl.fieldValueChanged(e.schema.InternalName,e.value,e.lastValue),e.lastValue=e.value)}}};return e}]),angular.module("ngSharePoint").directive("spfieldLookupmulti",["SPFieldDirective","$q","$filter","SharePoint",function(a,b,c,d){var e={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(e,f,g){function h(){(null===e.value||void 0===e.value)&&(e.value={results:[]}),o.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),i(e.currentMode).then(function(){o.renderField(e.currentMode)},function(a){e.errorMsg=a.message,o.setElementHTML(void 0===e.value?"":'<span style="color: brown">{{errorMsg}}</span>')})}function i(a){return"edit"===a?m():l()}function j(){var a=b.defer();return void 0===e.lookupList?d.getWeb(e.schema.LookupWebId).then(function(b){b.getList(e.schema.LookupList).then(function(b){e.lookupList=b,b.getProperties({$expand:"Forms"}).then(function(){b.getFields().then(function(){a.resolve(e.lookupList)})})})}):a.resolve(e.lookupList),a.promise}function k(a){var c=b.defer();return void 0!==e.lookupItems?c.resolve(e.lookupItems):j().then(function(b){b.getListItems(a).then(function(a){e.lookupItems=a,c.resolve(e.lookupItems)})}),c.promise}function l(){var a=b.defer();return void 0!==e.selectedLookupItems?a.resolve(e.selectedLookupItems):(e.selectedLookupItems=[],k().then(function(b){null!==e.value&&void 0!==e.value&&angular.forEach(e.value.results,function(a){var d=c("filter")(b,{Id:a},!0)[0];if(void 0!==d){var f=d[e.schema.LookupField],g=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===g.TypeAsString&&null!==f){var h=__cultureInfo||Sys.CultureInfo.CurrentCulture,i=new Date(f);f=c("date")(i,h.dateTimeFormat.ShortDatePattern+(0===g.DisplayFormat?"":" "+h.dateTimeFormat.ShortTimePattern))}"Computed"===g.TypeAsString&&null!==f&&(f=d.Title),e.selectedLookupItems.push({Title:f,url:d.list.Forms.results[0].ServerRelativeUrl+"?ID="+a+"&Source="+encodeURIComponent(window.location)})}}),a.resolve(e.selectedLookupItems)})),a.promise}function m(){var a=b.defer(),d=void 0;return void 0!==e.dependency&&(d={$select:"*, "+e.dependency.fieldName+"/Id",$expand:e.dependency.fieldName+"/Id",$filter:e.dependency.fieldName+"/Id eq "+e.dependency.value}),k(d).then(function(b){e.candidateItems=[],e.selectedCandidateItems=[],e.resultItems=[],e.selectedResultItems=[],angular.forEach(b,function(a){var b=a[e.schema.LookupField],d=e.lookupList.Fields[e.schema.LookupField];if("DateTime"===d.TypeAsString){var f=__cultureInfo||Sys.CultureInfo.CurrentCulture,g=new Date(b);b=c("date")(g,f.dateTimeFormat.ShortDatePattern+(0===d.DisplayFormat?"":" "+f.dateTimeFormat.ShortTimePattern))}var h={id:a.Id,name:b,title:b};e.value&&e.value.results&&-1!=e.value.results.indexOf(a.Id)?e.resultItems.push(h):e.candidateItems.push(h)}),a.resolve()}),a.promise}function n(){(null===e.value||void 0===e.value)&&(e.value={}),e.value.results=[],angular.forEach(e.resultItems,function(a){e.value.results.push(a.id)})}var o={fieldTypeName:"lookupmulti",replaceAll:!1,init:function(){e.idPrefix=e.schema.InternalName+"_"+e.schema.Id,e.addButtonText=STSHtmlEncode(Strings.STS.L_LookupMultiFieldAddButtonText)+" >",e.removeButtonText="< "+STSHtmlEncode(Strings.STS.L_LookupMultiFieldRemoveButtonText),e.candidateAltText=STSHtmlEncode(StBuildParam(Strings.STS.L_LookupMultiFieldCandidateAltText,e.schema.Title)),e.resultAltText=STSHtmlEncode(StBuildParam(Strings.STS.L_LookupMultiFieldResultAltText,e.schema.Title)),(null===e.value||void 0===e.value)&&(e.value={results:[]})},parserFn:function(a){return o.setValidity("required",!e.schema.Required||e.value.results.length>0),a},watchModeFn:function(){h()},watchValueFn:function(a,b){a!==b&&(e.selectedLookupItems=void 0,h())}};a.baseLinkFn.apply(o,arguments),void 0!==g.dependsOn&&e.$on(g.dependsOn+"_changed",function(a,b){e.dependency={fieldName:g.dependsOn,value:b},e.lookupItems=void 0,e.value=null,h()}),e.addItems=function(){e.resultItems=e.resultItems.concat(e.selectedCandidateItems),e.candidateItems=c("filter")(e.candidateItems,function(a){for(var b=!1,c=0;c<e.selectedCandidateItems.length;c++)if(a.id==e.selectedCandidateItems[c].id){b=!0;break}return!b}),e.selectedCandidateItems=[],n()},e.removeItems=function(){e.candidateItems=e.candidateItems.concat(e.selectedResultItems),e.resultItems=c("filter")(e.resultItems,function(a){for(var b=!1,c=0;c<e.selectedResultItems.length;c++)if(a.id==e.selectedResultItems[c].id){b=!0;break}return!b}),e.selectedResultItems=[],n()}}};return e}]),angular.module("ngSharePoint").directive("spfieldMultichoice",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){function c(){var a=[];angular.forEach(b.schema.Choices.results,function(c){-1!=b.choices.indexOf(c)&&a.push(c)}),b.choices=b.value.results=a}var d={fieldTypeName:"multichoice",replaceAll:!1,init:function(){(null===b.value||void 0===b.value)&&(b.value={results:[]}),b.choices=b.value.results,c()},parserFn:function(a){return d.setValidity("required",!b.schema.Required||b.choices.length>0),a}};a.baseLinkFn.apply(d,arguments),b.toggleCheckbox=function(a){var d=b.choices.indexOf(a);-1!=d?b.choices.splice(d,1):b.choices.push(a),c()}}};return b}]),angular.module("ngSharePoint").directive("spfieldNote",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(){var b={fieldTypeName:"note",replaceAll:!1};a.baseLinkFn.apply(b,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldNumber",["SPFieldDirective","SPUtils",function(a,b){var c={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(c){var d={fieldTypeName:"number",replaceAll:!1,init:function(){var a=b.parseXmlString(c.schema.SchemaXml),d=a.documentElement.getAttribute("Percentage")||"false",e=a.documentElement.getAttribute("Decimals")||"auto";c.schema.Percentage="true"===d.toLowerCase(),c.schema.Decimals=parseInt(e),c.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo},parserFn:function(a){return d.setValidity("number",!a||!isNaN(+a)&&isFinite(a)),(""===a||void 0===a)&&(c.value=null),c.value}};a.baseLinkFn.apply(d,arguments)}};return c}]),angular.module("ngSharePoint").directive("spPercentage",[function(){var a={restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$formatters.push(function(b){if(a.schema.Percentage&&void 0!==b){var c=isNaN(a.schema.Decimals)?2:a.schema.Decimals;return(100*b).toFixed(c)}return b}),d.$parsers.push(function(b){if(a.schema.Percentage&&void 0!==b){var c=isNaN(a.schema.Decimals)?2:a.schema.Decimals;return(b/100).toFixed(c)}return b})}};return a}]),angular.module("ngSharePoint").directive("spfieldText",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(){var b={fieldTypeName:"text",replaceAll:!1};a.baseLinkFn.apply(b,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldUrl",["SPFieldDirective",function(a){var b={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control.html",link:function(b){var c={fieldTypeName:"url",replaceAll:!1,init:function(){b.UrlFieldTypeText=Strings.STS.L_UrlFieldTypeText,b.UrlFieldTypeDescription=Strings.STS.L_UrlFieldTypeDescription,b.UrlFieldClickText=Strings.STS.L_UrlFieldClickText,b.Description_Text=Strings.STS.L_Description_Text},parserFn:function(a){c.setValidity("required",!b.schema.Required||b.value&&b.value.Url);var d=new RegExp("^http://"),e=!b.value||b.value&&!b.value.Url||b.value&&b.value.Url&&d.test(b.value.Url);return c.setValidity("url",e),a}};a.baseLinkFn.apply(c,arguments)}};return b}]),angular.module("ngSharePoint").directive("spfieldUser",["SPFieldDirective","$q","$timeout","$filter","SharePoint","SPUtils",function(a,b,c,d,e,f){var g={restrict:"EA",require:["^spform","ngModel"],replace:!0,scope:{mode:"@",value:"=ngModel"},templateUrl:"templates/form-templates/spfield-control-loading.html",link:function(d){function g(){null!==d.value&&void 0!==d.value||!d.schema.AllowMultipleValues||(d.value={results:[]}),m.setElementHTML('<div><img src="/_layouts/15/images/loadingcirclests16.gif" alt="" /></div>'),j().then(function(){m.renderField(d.currentMode)},function(){m.setElementHTML('<div style="color: red;">Error al recuperar el usuario {{value}}.</div>')})}function h(){var a=b.defer();return void 0===d.lookupList?e.getWeb().then(function(b){b.getList(d.schema.LookupList).then(function(b){d.lookupList=b,a.resolve(d.lookupList)},function(){a.reject()})},function(){a.reject()}):a.resolve(d.lookupList),a.promise}function i(a){return h().then(function(b){return b.getItemById(a)})
}function j(){var a=b.defer();if(void 0!==d.selectedUserItems)a.resolve(d.selectedUserItems);else{d.selectedUserItems=[];var c=[];if(d.schema.AllowMultipleValues)angular.forEach(d.value.results,function(a){var b=i(a).then(function(a){if(void 0!==a){var b={Title:a[d.schema.LookupField]||a.Title,url:a.list.web.url.rtrim("/")+"/_layouts/15/userdisp.aspx?ID="+d.value+"&Source="+encodeURIComponent(window.location),data:a};d.selectedUserItems.push(b)}});c.push(b)});else{var e={Title:"",url:"",data:null};if(null===d.value||void 0===d.value)d.selectedUserItems.push(e);else{var f=i(d.value).then(function(a){void 0!==a&&(e={Title:a[d.schema.LookupField]||a.Title,url:a.list.web.url.rtrim("/")+"/_layouts/15/userdisp.aspx?ID="+d.value+"&Source="+encodeURIComponent(window.location),data:a},d.selectedUserItems.push(e))});c.push(f)}}b.all(c).then(function(){a.resolve(d.selectedUserItems)})}return a.promise}function k(a){var c={Id:d.schema.Id,Title:d.schema.Title,Hidden:d.schema.Hidden,IMEMode:null,Name:d.schema.InternalName,Required:d.schema.Required,Direction:d.schema.Direction,FieldType:d.schema.TypeAsString,ReadOnlyField:d.schema.ReadOnlyField,Type:"User",DependentLookup:!1,AllowMultipleValues:d.schema.AllowMultipleValues,Presence:d.schema.Presence,WithPicture:!1,DefaultRender:!0,WithPictureDetail:!1,ListFormUrl:"/_layouts/15/listform.aspx",UserDisplayUrl:"/_layouts/15/userdisp.aspx",EntitySeparator:";",PictureOnly:!1,PictureSize:null,UserInfoListId:d.schema.LookupList,SharePointGroupID:d.schema.SelectionGroup,PrincipalAccountType:"User,DL,SecGroup,SPGroup",SearchPrincipalSource:15,ResolvePrincipalSource:15},e=[];angular.forEach(d.selectedUserItems,function(a){if(null!==a.data){var b=a.data.Title,c=a.data.Name,d={AutoFillDisplayText:b,AutoFillKey:c,AutoFillSubDisplayText:"",Description:b,DisplayText:b,EntityType:"User",IsResolved:!0,Key:c,ProviderDisplayName:"",ProviderName:"",Resolved:!0};e.push(d)}}),this.SPClientPeoplePicker_InitStandaloneControlWrapper(a,e,c);var g=this.SPClientPeoplePicker.SPClientPeoplePickerDict[a+"_TopSpan"];d.peoplePicker=g,void 0!==g&&null!==g&&(g.OnUserResolvedClientScript=function(a,c){var e=[],g=[];angular.forEach(c,function(a){if(a.IsResolved)if(d.schema.AllowMultipleValues||0===g.length){var c;c="User"===a.EntityType?f.getUserId(a.Key).then(function(a){return e.push(a),e}):b.when(e.push(a.EntityData.SPGroupID)),g.push(c)}else d.modelCtrl.$setViewValue(d.modelCtrl.$viewValue)}),g.length>0?b.all(g).then(function(){l(e)}):l(e)})}function l(a){d.schema.AllowMultipleValues===!0?d.value.results=a:d.value=a[0]||null,d.modelCtrl.$setViewValue(d.value)}var m={fieldTypeName:"user",replaceAll:!1,init:function(){d.noUserPresenceAlt=STSHtmlEncode(Strings.STS.L_UserFieldNoUserPresenceAlt),d.idPrefix=d.schema.InternalName+"_"+d.schema.Id},parserFn:function(a){return d.schema.AllowMultipleValues?m.setValidity("required",!d.schema.Required||d.value.results.length>0):d.peoplePicker&&m.setValidity("unique",d.peoplePicker.TotalUserCount<=1),a},watchModeFn:function(){g()},watchValueFn:function(a,b){a!==b&&(null!==d.value&&void 0!==d.value||!d.schema.AllowMultipleValues||(d.value={results:[]}),d.selectedUserItems=void 0,g())},postRenderFn:function(){if("edit"===d.currentMode){var a=d.idPrefix+"_$ClientPeoplePicker";c(function(){k(a)})}}};a.baseLinkFn.apply(m,arguments),d.IMNImageOnClick=function(a){return IMNImageOnClick(a.originalEvent),!1},d.GoToLinkOrDialogNewWindow=function(a){return GoToLinkOrDialogNewWindow(a),!1}}};return g}]),angular.module("ngSharePoint").directive("spfieldValidationMessages",[function(){var a={restrict:"E",replace:!0,templateUrl:"templates/form-templates/spfield-validation-messages.html",link:function(a){a.SPClientRequiredValidatorError=Strings.STS.L_SPClientRequiredValidatorError}};return a}]),angular.module("ngSharePoint").directive("spfield",["$compile","$templateCache","$http",function(a,b,c){var d={restrict:"EA",require:"^?spform",template:"<div></div>",link:function(d,e,f,g){function h(){var a="";e.replaceWith(a),e=a}var i,j=f.name||f.spfield;if(g&&(i=g.getFieldSchema(j)),void 0!==i){if("Attachments"===j){var k=g.getItem();if(void 0!==k&&void 0!==k.list&&k.list.EnableAttachments===!1)return console.error('Can\'t add "Attachments" field because the attachments are disabled in the list.'),void h()}c.get("templates/form-templates/spfield.html",{cache:b}).success(function(b){for(var c=e[0].attributes,f="",g=["spfield-wrapper"],h=0;h<c.length;h++){var i=c.item(h).nodeName,j=c.item(h).value;if("ng-repeat"!=i)if("spfield"==i&&(i="name"),"class"!=i)f+=i+'="'+j+'" ';else{if(j=j.replace(/ng-[\w-]*/g,"").trim(),""===j)continue;g.push(j)}}b=b.replace(/\{\{attributes\}\}/g,f.trim()),b=b.replace(/\{\{classAttr\}\}/g,g.join(" "));var k=a(b)(d);e.replaceWith(k),e=k})}else console.error('Unknown field "'+f.name+'"'),h()}};return d}]),angular.module("ngSharePoint").directive("spformRule",["$compile","$templateCache","$http","$animate",function(a,b,c,d){var e={restrict:"E",transclude:!0,link:function(e,f,g,h,i){f.parent().length>0&&(g.templateUrl?c.get(g.templateUrl,{cache:b}).success(function(b){var c=a(b)(e);f.replaceWith(c),f=c}):(i(e,function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];d.enter(c,f.parent(),f)}}),f.remove(),f=null))}};return e}]),angular.module("ngSharePoint").directive("spformToolbarButton",["SPUtils","$q","SPRibbon","$compile",function(a,b,c){var d={restrict:"EA",require:"^spformToolbar",replace:!0,templateUrl:"templates/form-templates/spform-toolbar-button.html",scope:{action:"&",redirectUrl:"@",text:"@"},link:function(d,e,f,g){function h(){return d.formCtrl.save(d.redirectUrl)}function i(){return d.formCtrl.cancel(d.redirectUrl)}d.formCtrl=g.getFormCtrl(),d.isInDesignMode=a.inDesignMode(),d.status=d.formCtrl.status;var j=f.action||f.spformToolbarButton;a.SharePointReady().then(function(){switch(j.toLowerCase()){case"save":d.text=d.text||STSHtmlEncode(Strings.STS.L_SaveButtonCaption),d.action=h,d.redirectUrl=d.redirectUrl||"default",c.ready().then(function(){c.registerCommand("Ribbon.ListForm.Edit.Commit.Publish",d.makeAction,!0)});break;case"cancel":d.text=d.text||STSHtmlEncode(Strings.STS.L_CancelButtonCaption),d.action=i,d.redirectUrl=d.redirectUrl||"default",c.ready().then(function(){c.registerCommand("Ribbon.ListForm.Edit.Commit.Cancel",d.makeAction,!0)});break;case"close":d.text=d.text||STSHtmlEncode(Strings.STS.L_CloseButtonCaption),d.action=i,d.redirectUrl=d.redirectUrl||"default";break;default:d.text=d.text||"",("true"===f.showInRibbon||!angular.isDefined(attrs.showInRibbon)&&g.showToolbarInRibbon())&&c.ready().then(function(){var a=g.getRibbonToolbar();a&&c.addButtonToToolbar(a,d.text,d.makeAction,f.tooltip,f.description)})}}),d.makeAction=function(){d.formCtrl.setFormStatus(d.status.PROCESSING),b.when(d.action()).then(function(a){if(a!==!1&&d.redirectUrl){var b=d.redirectUrl;switch(b.toLowerCase()){case"display":b=window.location.href.toLowerCase().replace(/new|edit/,"display");break;case"edit":b=window.location.href.toLowerCase().replace(/disp|new/,"edit");break;case"new":b=window.location.href.toLowerCase().replace(/disp|edit/,"new");break;case"default":b=utils.getQueryStringParamByName("Source")||_spPageContextInfo.webServerRelativeUrl}window.location=b}d.formCtrl.setFormStatus(d.status.IDLE)},function(){d.formCtrl.setFormStatus(d.status.IDLE)})}}};return d}]),angular.module("ngSharePoint").directive("spformToolbar",["$compile","SPUtils","SPRibbon",function(a,b,c){var d={restrict:"EA",templateUrl:"templates/form-templates/spform-toolbar.html",require:"^spform",replace:!0,transclude:!0,controller:function(a){this.getFormCtrl=function(){return a.formCtrl},this.getRibbonToolbar=function(){return a.ribbonToolbar},this.showToolbarInRibbon=function(){return a.showToolbarInRibbon}},link:function(b,d,e,f,g){function h(a){var c=!1;b.showToolbarInRibbon="true"===e.showInRibbon;for(var d=0;d<a.length;d++){var f=a[d];if(void 0!==f.tagName){var g=!1;if(g=f.hasAttribute("show-in-ribbon")?"true"===f.getAttribute("show-in-ribbon").toLowerCase():b.showToolbarInRibbon){if("spform-toolbar-button"===f.tagName.toLowerCase()&&f.hasAttribute("action")||f.hasAttribute("spform-toolbar-button")){var h=f.getAttribute("action").toLowerCase();if("save"!==h&&"cancel"!==h&&"close"!==h){c=!0;break}}if(f.hasAttribute("sp-action")){var i=f.getAttribute("sp-action").toLowerCase();if("save"!==i&&"cancel"!==i&&"close"!==i){c=!0;break}}}}}return c}function i(){var f=d.find("[sp-transclude]");if(void 0!==f&&0!==f.length||void 0===d.attr("sp-transclude")||(f=d),void 0!==f&&0!==f.length&&(g(b,function(a){h(a)?c.ready().then(function(){b.ribbonToolbar=c.createToolbar(e.name,e.tabTitle)}):b.ribbonToolbar=null,f.empty(),angular.forEach(a,function(a){a.nodeType!==a.COMMENT_NODE&&f.append(a)})}),0===f.contents().length))switch(b.currentMode){case"display":f.append(a('<spform-toolbar-button action="close"></spform-toolbar-button>')(b));break;case"edit":f.append(a('<spform-toolbar-button action="save"></spform-toolbar-button>')(b)),f.append(a('<spform-toolbar-button action="cancel"></spform-toolbar-button>')(b))}}b.formCtrl=f,b.ribbonToolbar=null,b.$watch(f.getFormMode,function(a){b.currentMode=a,i()})}};return d}]),angular.module("ngSharePoint").directive("spform",["SPUtils","$compile","$templateCache","$http","$q","$timeout","SPExpressionResolver","SPListItem",function(a,b,c,d,e,f,g,h){var i={restrict:"EA",transclude:!0,replace:!0,scope:{item:"=item",mode:"=mode",extendedSchema:"=",onPreSave:"&",onPostSave:"&",onCancel:"&"},templateUrl:"templates/form-templates/spform.html",controllerAs:"spformCtrl",controller:["$scope","$attrs",function(a){this.status={IDLE:0,PROCESSING:1},this.getItem=function(){return a.item},this.getFormCtrl=function(){return a.ngFormCtrl},this.isNew=function(){return a.item.isNew()},this.initField=function(b){if(this.isNew()){var c=this.getFieldSchema(b);switch(c.TypeAsString){case"MultiChoice":a.item[b]={results:[]},null!==c.DefaultValue&&a.item[b].results.push(c.DefaultValue);break;case"DateTime":null!==c.DefaultValue&&(a.item[b]=new Date);break;case"Boolean":null!==c.DefaultValue&&(a.item[b]="1"==c.DefaultValue);break;default:null!==c.DefaultValue&&(a.item[b]=c.DefaultValue)}}},this.getFieldSchema=function(b){if(utils.isGuid(b)){var c=void 0;return angular.forEach(a.schema,function(a){a.Id==b&&(c=a)}),c}return a.schema[b]},this.fieldValueChanged=function(b,c,d){a.$broadcast(b+"_changed",c,d),a.$emit(b+"_changed",c,d)},this.getFormMode=function(){return a.mode||"display"},this.setFormMode=function(b){a.mode=b},this.getWebRegionalSettings=function(){var b=e.defer();return void 0!==a.item.list.web.RegionalSettings?b.resolve(a.item.list.web.RegionalSettings):a.item.list.web.getProperties().then(function(){b.resolve(a.item.list.web.RegionalSettings)}),b.promise},this.getFormStatus=function(){return a.formStatus},this.setFormStatus=function(b){f(function(){a.formStatus=b,a.$apply()},0)},this.setFieldFocus=function(b){var c=!1;this.focusElements=this.focusElements||[];for(var d=0;d<this.focusElements.length;d++)if(void 0!==b){if(this.focusElements[d].name===b){this.focusElements[d].element.focus(),c=!0;break}}else{var e=a.ngFormCtrl[this.focusElements[d].name];if(e&&e.$invalid){this.focusElements[d].element.focus(),c=!0;break}}!c&&this.focusElements.length>0&&this.focusElements[0].element.focus()},this.save=function(b){function c(){d&&d.close()}var d,f=this,g=e.defer();return angular.isString(b)?b={redirectUrl:b}:(!angular.isObject(b)||angular.isArray(b))&&(b={}),a.ngFormCtrl.$setDirty(),a.ngFormCtrl.$valid||(e.when(a.$broadcast("validate")).then(function(){f.setFieldFocus()}),b.force===!0)?(a.formStatus=this.status.PROCESSING,b.silent!==!0&&(d=SP.UI.ModalDialog.showWaitScreenWithNoClose(SP.Res.dialogLoading15)),angular.forEach(a.schema,function(b,c){b.isVirtualField&&delete a.item[c]}),e.when((a.onPreSave||angular.noop)()(a.item,a.originalItem)).then(function(b){b!==!1?a.item.save().then(function(){a.formStatus=this.status.IDLE,e.when((a.onPostSave||angular.noop)()(a.item,a.originalItem)).then(function(a){a!==!1?g.resolve(a):g.reject(),c()},function(){c(),g.reject()})},function(a){console.error(a),c();var b=document.createElement("div");b.innerHTML='<div style="color:brown">'+a.code+"<br/><strong>"+a.message+"</strong></div>",SP.UI.ModalDialog.showModalDialog({title:SP.Res.dlgTitleError,html:b,showClose:!0,autoSize:!0,dialogReturnValueCallback:function(){g.reject()}})}):(c(),g.reject())},function(){c(),g.reject()}),g.promise):(g.reject(),g.promise)},this.cancel=function(){var b=e.defer();return a.formStatus=this.status.PROCESSING,e.when((a.onCancel||angular.noop)()(a.item,a.originalItem)).then(function(c){c!==!1?(a.item=new h(a.originalItem.list,a.originalItem),b.resolve(c)):b.reject()},function(){b.reject()}),b.promise},this.closeForm=function(a){window.location=void 0!==a?a:utils.getQueryStringParamByName("Source")||_spPageContextInfo.webServerRelativeUrl}}],compile:function(){return{pre:function(a,b,c){c.name||c.$set("name","spform")},post:function(i,j,k,l,m){function n(){i.formStatus!==l.status.PROCESSING&&angular.isDefined(i.item)&&(angular.isDefined(i.mode)||(i.mode=l.getFormMode()),i.formStatus=l.status.PROCESSING,i.item.list.getProperties().then(function(){i.item.list.getFields().then(function(a){i.item.list.getContentType(i.item.ContentTypeId).then(function(b){b.getFields().then(function(b){var e=b;i.item.list.EnableAttachments&&(e.Attachments=a.Attachments),i.schema=e,angular.isDefined(i.extendedSchema)&&angular.isDefined(i.extendedSchema.Fields)&&angular.forEach(i.extendedSchema.Fields,function(a,b){var c=i.schema[b];angular.isDefined(c)?(a.hasExtendedSchema=!0,a.originalTypeAsString=c.TypeAsString,angular.extend(i.schema[b],a)):(a.isVirtualField=!0,i.schema[b]=a)});var f,g=j.find("*");angular.forEach(g,function(a){void 0!==a.attributes["transclusion-container"]&&(f=angular.element(a))}),(void 0===f||0===f.length)&&(f=j),f.empty(),k.templateUrl?d.get(k.templateUrl,{cache:c}).success(function(a){p(f,angular.element(a),!1).then(function(){o(f)})}).error(function(a){j.html('<div><h2 class="ms-error">'+a+'</h2><p class="ms-error">Form Template URL: <strong>'+k.templateUrl+"</strong></p></div>"),o(f)}):m(i,function(a){p(f,a,!0).then(function(){0===f[0].children.length?(i.fields=[],angular.forEach(i.schema,function(a){a.Hidden||a.Sealed||a.ReadOnlyField||"ContentType"===a.InternalName||i.fields.push(a)}),d.get("templates/form-templates/spform-default.html",{cache:c}).success(function(a){f.append(a),o(f)})):o(f)})})})})})}))}function o(a){e.when(b(a)(i)).then(function(){var a=document.querySelector("#form-loading-animation-wrapper-"+i.$id);void 0!==a&&angular.element(a).remove(),f(function(){i.formStatus=l.status.IDLE,q(),i.$broadcast("formRenderComplete"),i.$emit("formRenderComplete")})})}function p(a,b,c,d,f,h){d=d||0,f=f||e.defer(),h=h||!1;var j=b[d++];if(void 0===j)return f.resolve(),f.promise;if(i.rules=i.rules||[],void 0!==j.tagName&&"spform-rule"==j.tagName.toLowerCase())if(h)p(a,b,c,d,f,h);else{var k="false",l="false";j.hasAttribute("test")&&(k=j.getAttribute("test")),j.hasAttribute("terminal")&&(l=j.getAttribute("terminal")),g.resolve(k,i).then(function(e){i.$eval(e)?(j.setAttribute("test",e),g.resolve(l,i).then(function(m){j.setAttribute("terminal",m),h=i.$eval(m),g.resolve(j.outerHTML,i).then(function(g){var j=angular.element(g)[0];a.append(j),i.rules.push({test:k,testResolved:e,terminal:l,terminalResolved:m,solved:!0}),p(a,b,c,d,f,h)})})):(c&&(j.remove(),j=null),i.rules.push({test:k,testResolved:e,terminal:l,terminalResolved:"n/a",solved:!1}),p(a,b,c,d,f,h))})}else a.append(j),p(a,b,c,d,f,h);return f.promise}function q(){SP.UI.ModalDialog.get_childDialog()&&f(function(){SP.UI.ModalDialog.get_childDialog().autoSize()})}i.ngFormCtrl=i[k.name],i.isInDesignMode=a.inDesignMode(),i.isInDesignMode||(i.$watch("mode",function(a,b){void 0!==a&&a!==b&&n()}),i.$watch("item",function(a){void 0!==a&&(i.originalItem=new h(i.item.list,i.item),n())}))}}}};return i}]),function(){"use strict";function a(){function a(a,b){a.cultureInfo="undefined"==typeof __cultureInfo?Sys.CultureInfo.CurrentCulture:__cultureInfo,a.contentTypeText="Content Type",a.versionText=SP.Res.storefront_AppDetails_Version,a.createdAtText="Created at",a.lastModifiedText="Last modified at",a.byText="by",a.isNewItem=a.item.isNew(),a.item&&!a.isNewItem&&(a.createdDate=a.item.Created,a.modifiedDate=a.item.Modified,a.authorName=null,a.editorName=null,a.item.list.web.getUserById(a.item.AuthorId).then(function(b){a.authorName=b.Title,a.authorLink=_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/userdisp.aspx?ID="+a.item.AuthorId}),a.item.list.web.getUserById(a.item.EditorId).then(function(b){a.editorName=b.Title,a.editorLink=_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/userdisp.aspx?ID="+a.item.EditorId})),a.originalAuthoringInfoFound=!1;var c=document.getElementById("ngsharepoint-formbinder-authoringinfo");c&&(b.append(c),c.style.display="block",a.originalAuthoringInfoFound=!0)}var b={restrict:"EA",replace:!0,templateUrl:"templates/form-templates/spitem-authoringinfo.html",link:a};return b}angular.module("ngSharePoint").directive("spitemAuthoringinfo",a),a.$inject=["SharePoint"]}(),angular.module("ngSharePoint").directive("spuser",["SharePoint",function(a){return{restrict:"A",replace:!1,scope:{UserData:"=spuser"},link:function(b,c,d){a.getCurrentWeb().then(function(a){b.currentWeb=a,void 0===c[0].attributes["user-id"]?b.currentWeb.getCurrentUser().then(function(a){b.UserData=a}):b.$watch(function(){return b.$eval(d.userId)},function(a){void 0!==a&&b.currentWeb.getUserById(a).then(function(a){b.UserData=a})})})}}}]),angular.module("ngSharePoint").directive("spworkingonit",[function(){return{restrict:"EA",templateUrl:"templates/spworking-on-it.html"}}]),angular.module("ngSharePoint").filter("newlines",["$sce",function(a){return function(b){return a.trustAsHtml((b||"").replace(/\n/g,"<br/>"))}}]),angular.module("ngSharePoint").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("ngSharePointFormPage",["ngSharePoint","oc.lazyLoad"]),angular.module("ngSharePointFormPage").config(["SPConfigProvider","$ocLazyLoadProvider",function(a,b){a.options.loadMinimalSharePointInfraestructure=!1,b.config({loadedModules:["ngSharePoint","ngSharePointFormPage"]})}]),angular.module("ngSharePointFormPage").directive("spformpage",["SharePoint","SPUtils","SPListItem","$q","$http","$templateCache","$compile","ctx","$ocLazyLoad","SPExpressionResolver",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"EA",link:function(b,k){function l(a){var e=d.defer();if(h.ControlMode==SPClientTemplates.ClientControlMode.NewForm){var f={ContentTypeId:utils.getQueryStringParamByName("ContentTypeId")},g=new c(b.list,f);e.resolve(g)}else b.list.getItemById(a).then(function(a){e.resolve(a)},function(a){console.log("Error item",a)});return e.promise}function m(){var a=d.defer(),c=b.web.url+"/ngSharePointFormTemplates/"+b.list.Title+"-"+h.ListData.Items[0].ContentType+"-"+SPClientTemplates.Utility.ControlModeToString(h.ControlMode)+".html";return e.get(c,{cache:f}).success(function(){a.resolve(c)}).error(function(b){console.log(b),a.resolve("")}),a.promise}function n(a){var c=d.defer();return SP.SOD.registerSod("formDefinition",b.web.url+"/ngSharePointFormTemplates/"+b.list.Title+"-"+h.ListData.Items[0].ContentType+"-definition.js"),SP.SOD.executeFunc("formDefinition",null,function(){var d=[];if(void 0!==formDefinition){var e=b.$new();e.item=a,j.resolve(angular.toJson(formDefinition),e).then(function(a){a=a.replace(/~site/g,b.web.url),formDefinition=angular.fromJson(a),angular.forEach(formDefinition.angularModules,function(a){d.push(a)}),angular.forEach(formDefinition.jsIncludes,function(a){d.push(a)}),angular.forEach(formDefinition.cssIncludes,function(a){d.push(a)}),i.load(d).then(function(){c.resolve(formDefinition)})})}else c.resolve({})}),c.promise}function o(a){var b,c=k.scope();return angular.isDefined(c.appCtrl)&&(b=c.appCtrl.onPreBind),d.when((b||angular.noop)(a))}var p=_spPageContextInfo.pageListId,q=utils.getQueryStringParamByName("ID");if(b.mode=h.ControlMode==SPClientTemplates.ClientControlMode.DisplayForm?"display":"edit",void 0===p)throw"Can't access to the page context list or the page context does not exists.";a.getWeb().then(function(a){b.web=a,a.getList(p).then(function(a){b.list=a,a.getProperties().then(function(){l(q).then(function(a){n(a).then(function(c){m().then(function(d){var e=c.formController,f=c.useControllerAsSyntax,h="";b.extendedSchema=c.extendedSchema||{},h=angular.isDefined(e)?'<div ng-controller="'+e+(f?' as appCtrl">':'">')+'    <div data-spform="true" mode="mode" item="item" extended-schema="$parent.extendedSchema" on-pre-save="appCtrl.onPreSave" on-post-save="appCtrl.onPostSave" on-cancel="appCtrl.onCancel" template-url="'+d+'"></div></div>':'<div data-spform="true" mode="mode" item="item" extended-schema="extendedSchema" template-url="'+d+'"></div>';var i=g(h)(b);k.replaceWith(i),k=i,o(a).finally(function(){b.item=a})})},function(a){console.error(a)})})})},function(a){console.log("Error list",a)})},function(a){console.log("Error web",a)})}}}]),angular.module("ngSharePoint",["ngSharePoint.templates","CamlHelper"]),angular.module("ngSharePoint").config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]),angular.module("ngSharePoint").value("Constants",{errorTemplate:"templates/error.html",userProfileUrl:"_layouts/userdisp.aspx?ID="}),angular.module("ngSharePoint").provider("SharePoint",[function(){"use strict";var a=function(a,b,c,d){this.getCurrentWeb=function(){return this.getWeb()},this.getWeb=function(a){var e=b.defer();return c.SharePointReady().then(function(){new d(a).then(function(a){e.resolve(a)})}),e.promise}};this.$get=function(b,c,d,e){return new a(b,c,d,e)}}]),angular.module("ngSharePoint").factory("SPCache",["$q","$cacheFactory",function(a,b){"use strict";return{getCache:function(a){var c=b.get(a);return void 0===c&&(c=b(a)),c},getCacheValue:function(a,b){return this.getCache(a).get(b)},setCacheValue:function(a,b,c){this.getCache(a).put(b,c)},removeCacheValue:function(a,b){this.getCache(a).remove(b)}}}]),angular.module("ngSharePoint").provider("SPConfig",[function(){"use strict";var a=this;a.options={force15LayoutsDirectory:!1,loadMinimalSharePointInfraestructure:!0,forceLoadResources:!1,resourceFiles:function(){var b=function(){var b=["core"];this.get=function(){return b},this.add=function(c){var d=!1;angular.isArray(c)?anfular.forEach(c,function(a){angular.isString(a)&&(b.push(a),d=!0)}):angular.isString(c)&&(b.push(c),d=!0),d&&(a.options.forceLoadResources=!0)}};return new b}()},a.$get=function(){var b=function(){};return b.options=a.options,b}}]),angular.module("ngSharePoint").factory("SPContentType",["$q","SPCache","SPFolder","SPListItem",function(a,b){"use strict";var c=function(a,c,d){if(void 0===a)throw"@parentObject parameter not specified in SPContentType constructor.";if(void 0===c)throw"@id parameter not specified in SPContentType constructor.";this.id=c,this.__parent=a,this.apiUrl=this.__parent.apiUrl+"/ContentTypes('"+this.id+"')",this.Fields=b.getCacheValue("SPContentTypeFieldsCache",this.apiUrl),void 0!==d&&(utils.cleanDeferredProperties(d),angular.extend(this,d))};return c.prototype.getFields=function(){var c=this,d=a.defer();if(void 0!==this.Fields)d.resolve(this.Fields);else{var e=new SP.RequestExecutor("/");e.executeAsync({url:c.apiUrl+"/Fields",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a),f={};angular.forEach(e,function(a){f[a.InternalName]=a}),c.Fields=f,b.setCacheValue("SPContentTypeFieldsCache",c.apiUrl,f),d.resolve(f)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},c.prototype.setJSLink=function(b){var c=this,d=a.defer(),e=SP.ClientContext.get_current(),f=e.get_web(),g=f.get_lists().getByTitle(c.__parent.Title),h=g.get_contentTypes(),i=h.getById(c.id);return i.set_jsLink(b),i.update(),e.executeQueryAsync(function(){d.resolve(i)},function(a,b){d.reject({sender:a,args:b})}),d.promise},c.prototype.getJSLink=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor("/");return d.executeAsync({url:b.apiUrl+"/jsLink",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);c.resolve(b)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c}]),angular.module("ngSharePoint").service("SPExpressionResolver",["$q","SharePoint","$parse",function(a,b,c){"use strict";function d(b,c,i,j){i=i||0,j=j||a.defer();var k=b[i++];if(void 0===k)return j.resolve(),j.promise;var l,m=k.substring(0,k.indexOf(/\W/.exec(k)));switch(m){case"param":var n=e(k)[0];l=utils.getQueryStringParamByName(n);break;case"item":l=f(k,c);break;case"currentUser":l=g(k);break;case"fn":var o=/\W(.*)/.exec(k)[1];l=h(o,c)}return a.when(l).then(function(a){b[i-1]=a,d(b,c,i,j)},function(a){b[i-1]=a,d(b,c,i,j)}),j.promise}function e(a){for(var b,c=[];b=j.exec(a);)b.shift(),c.push(b.join(""));return c}function f(a,b){var c=e(a);return b.item.list.getItemQueryById(b.item.Id,c.join("/")).then(function(a){return a[c[c.length-1]]},function(){return void 0})}function g(a){return b.getCurrentWeb().then(function(b){return b.getList("UserInfoList").then(function(b){var c=e(a);return b.getItemQueryById(_spPageContextInfo.userId,c.join("/")).then(function(a){return a[c[c.length-1]]},function(){return void 0})})})}function h(a,b){return b.$eval(c(a))}var i=/{(\w+\W*[\w\s./\[\]\(\)]+)}(?!})/g,j=/[\[./]([\w )]+)/g;this.resolve=function(b,c){var e=a.defer(),f=[];return b=b.replace(i,function(a,b){var c=f.indexOf(b);return-1==c&&(f.push(b),c=f.length-1),"{e:"+c+"}"}),d(f,c).then(function(){for(var a=0;a<f.length;a++)b=b.replace(new RegExp("{e:"+a+"}","g"),f[a]);e.resolve(b)}),e.promise}}]),angular.module("ngSharePoint").service("SPFieldDirective",["$compile","$http","$templateCache",function(a,b,c){function d(){this.modelCtrl.$setViewValue(this.modelCtrl.$viewValue||null)}function e(a,b){a!==b&&this.modelCtrl.$setViewValue(a)}this.baseLinkFn=function(f,g,h,i){var j=this;f.formCtrl=i[0],f.modelCtrl=i[1],f.name=h.name,f.schema=f.formCtrl.getFieldSchema(h.name),f.item=f.formCtrl.getItem(),angular.isFunction(j.init)&&j.init(),angular.isFunction(j.parserFn)&&f.modelCtrl.$parsers.unshift(j.parserFn),angular.isFunction(j.formatterFn)&&f.modelCtrl.$formatters.unshift(j.formatterFn),j.setElementHTML=function(b){if(j.replaceAll===!0){var c=a(b)(f);g.replaceWith(c),g=c}else g.html(b),a(g)(f)},j.renderField=function(){var a="templates/form-templates/spfield-"+j.fieldTypeName+"-"+f.currentMode+".html";"display"===f.currentMode&&j.displayTemplateUrl&&(a=j.displayTemplateUrl),"edit"===f.currentMode&&j.editTemplateUrl&&(a=j.editTemplateUrl),b.get(a,{cache:c}).success(function(a){j.setElementHTML(a),angular.isFunction(j.postRenderFn)&&j.postRenderFn.apply(j,arguments)})},j.setValidity=function(a,b){"edit"===f.currentMode&&f.modelCtrl.$setValidity(a,b)},f.$watch(function(){return f.mode||f.formCtrl.getFormMode()},function(a){f.currentMode=a,angular.isFunction(j.watchModeFn)?j.watchModeFn.apply(j,arguments):j.renderField()}),f.$watch("value",function(){e.apply(f,arguments),angular.isFunction(j.watchValueFn)&&j.watchValueFn.apply(j,arguments)},!0),f.unregisterValidateFn=f.$on("validate",function(){d.apply(f,arguments),angular.isFunction(j.onValidateFn)&&j.onValidateFn.apply(j,arguments)})}}]),angular.module("ngSharePoint").factory("SPFile",["SPObjectProvider","$q","$http",function(a,b){"use strict";var c=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPFile constructor.";if(void 0===b)throw"@path parameter not specified in SPFile constructor.";this.web=a,this.apiUrl="/GetfileByServerRelativeUrl('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return c.prototype.updateAPIUrlById=function(a,b){if(void 0===a)throw"@list parameter not specified in updateAPIUrlById.";if(void 0===b)throw"@itemId parameter not specified in updateAPIUrlById.";this.apiUrl=a.apiUrl+"/GetItemById("+b+")/file"},c.prototype.getProperties=function(a){var c=this,d=b.defer(),e=new SP.RequestExecutor(c.web.url);return e.executeAsync({url:c.apiUrl+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(c,b),d.resolve(c)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.getList=function(){var c=b.defer(),d=this;if(void 0===this.List&&void 0!==this.ListItemAllFields&&void 0!==this.ListItemAllFields.ParentList){var e=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);this.List=e}return void 0!==this.List?c.resolve(this.List):this.getProperties({$expand:"ListItemAllFields, ListItemAllFields/ParentList"}).then(function(){var b=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);d.List=b,c.resolve(b)}),c.promise},c.prototype.getFileListItem=function(){var c=b.defer(),d=this;return void 0!==this.ListItem?c.resolve(this.ListItem):void 0!==this.List?this.getProperties({$expand:"ListItemAllFields, ListItemAllFields/ParentList"}).then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),d.updateAPIUrlById(d.List,d.ListItem.Id),c.resolve(d.ListItem)}):this.getList().then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),d.updateAPIUrlById(d.List,d.ListItem.Id),c.resolve(d.ListItem)}),c.promise},c.prototype.rename=function(a){var c=this,d=b.defer();return this.getFileListItem().then(function(){var b=c.List.Id,e=c.ListItem.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(b);c._fileItem=h.getItemById(e),c._fileItem.set_item("FileLeafRef",a),c._fileItem.update(),f.load(c._fileItem),f.executeQueryAsync(function(){c.getProperties().then(function(){d.resolve()})},function(a,b){var c={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};d.reject(c)})}),d.promise},c.prototype.removeFile=function(a){var c=this,d=b.defer(),e={Accept:"application/json; odata=verbose"},f=c.apiUrl+"/recycle";a===!0&&(f=f.rtrim("/recycle"),e["X-HTTP-Method"]="DELETE");var g=new SP.RequestExecutor(c.web.url);return g.executeAsync({url:f,method:"POST",headers:e,success:function(){d.resolve()},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.checkOut=function(){var a=this,c=b.defer(),d=a.apiUrl+"/checkout",e=new SP.RequestExecutor(a.web.url);return e.executeAsync({url:d,method:"POST",success:function(){a.getProperties({$expand:"CheckedOutByUser, ModifiedBy"}).then(function(){c.resolve()})},error:function(b,d,e){var f=utils.parseError({data:b,errorCode:d,errorMessage:e});a.getProperties({$expand:"CheckedOutByUser, ModifiedBy"}).then(function(){c.reject(f)})}}),c.promise},c.prototype.undoCheckOut=function(){var a=this,c=b.defer(),d=a.apiUrl+"/undocheckout",e=new SP.RequestExecutor(a.web.url);return e.executeAsync({url:d,method:"POST",success:function(){a.getProperties({$expand:"CheckedOutByUser, ModifiedBy"}).then(function(){delete a.CheckedOutByUser,c.resolve()})},error:function(b,d,e){var f=utils.parseError({data:b,errorCode:d,errorMessage:e});a.getProperties({$expand:"CheckedOutByUser, ModifiedBy"}).then(function(){c.reject(f)})}}),c.promise},c.prototype.checkIn=function(a){var c=this,d=b.defer();return a=a||"",c.getList().then(function(){var b=c.List.Id,e=c.ListItemAllFields.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(b),i=h.getItemById(e);c._file=i.get_file(),c._file.checkIn(a,1),f.load(c._file),f.executeQueryAsync(function(){c.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){delete c.CheckedOutByUser,d.resolve()
})},function(a,b){var e={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};c.getProperties({$expand:"CheckedOutByUser,ModifiedBy"}).then(function(){d.reject(e)})})}),d.promise},c}]),angular.module("ngSharePoint").factory("SPFolder",["SPObjectProvider","SPUtils","$q",function(a,b,c){"use strict";var d=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPFolder constructor.";if(void 0===b)throw"@path parameter not specified in SPFolder constructor.";this.web=a,this.apiUrl="/GetFolderByServerRelativeUrl('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return d.prototype.getProperties=function(a){var b=this,d=c.defer(),e=new SP.RequestExecutor(b.web.url);return e.executeAsync({url:b.apiUrl+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var c=utils.parseSPResponse(a);utils.cleanDeferredProperties(c),angular.extend(b,c),d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},d.prototype.getFiles=function(b){var d=this,e=c.defer(),f=new SP.RequestExecutor(d.web.url);return f.executeAsync({url:d.apiUrl+"/Files"+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(b){var c=utils.parseSPResponse(b),f=[];angular.forEach(c,function(b){var c=a.getSPFile(d.web,b.ServerRelativeUrl,b);void 0!=d.List&&(c.List=d.List),f.push(c)}),e.resolve(f)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.getFolders=function(a){var b=this,e=c.defer(),f=new SP.RequestExecutor(b.web.url);return f.executeAsync({url:b.apiUrl+"/Folders"+utils.parseQuery(a),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var c=utils.parseSPResponse(a),f=[];angular.forEach(c,function(a){var c=new d(b.web,a.ServerRelativeUrl,a);void 0!==b.List&&(c.List=b.List),f.push(c)}),e.resolve(f)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.getList=function(){var b=c.defer(),d=this;if(void 0===this.List&&void 0!==this.ListItemAllFields&&void 0!==this.ListItemAllFields.ParentList){var e=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);this.List=e}return void 0!==this.List?b.resolve(this.List):this.getProperties({$expand:"ListItemAllFields, ListItemAllFields/ParentList"}).then(function(){var c=a.getSPList(d.web,d.ListItemAllFields.ParentList.Id,d.ListItemAllFields.ParentList);d.List=c,b.resolve(c)}),b.promise},d.prototype.getFolderListItem=function(){var b=c.defer(),d=this;return void 0!==this.ListItem?b.resolve(this.ListItem):this.getList().then(function(){d.ListItem=a.getSPListItem(d.List,d.ListItemAllFields),b.resolve(d.ListItem)}),b.promise},d.prototype.addFolder=function(a){var b=this,e=c.defer(),f=b.ServerRelativeUrl+"/"+a,g=b.apiUrl+"/folders",h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value);var j=new SP.RequestExecutor(b.web.url),k={__metadata:{type:"SP.Folder"},ServerRelativeUrl:f};return j.executeAsync({url:g,method:"POST",headers:h,body:angular.toJson(k),success:function(a){var c=utils.parseSPResponse(a),g=new d(b.web,f,c);e.resolve(g)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},d.prototype.addFile=function(d,e){var f=this,g=c.defer(),h=(f.ServerRelativeUrl+"/"+d,f.apiUrl+"/files/add(url='"+d+"',overwrite=true)"),i=new SP.RequestExecutor(f.web.url);return b.getFileBinary(e).then(function(b){var c={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},d=document.getElementById("__REQUESTDIGEST");null!==d&&(c["X-RequestDigest"]=d.value),i.executeAsync({url:h,method:"POST",headers:c,body:b,binaryStringRequestBody:!0,success:function(b){var c=utils.parseSPResponse(b),d=a.getSPFile(f.web,c.ServerRelativeUrl,c);d.List=f.List,g.resolve(d)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});g.reject(d)}})}),g.promise},d.prototype.rename=function(a){var b=this,d=c.defer();return this.getFolderListItem().then(function(){var c=b.List.Id,e=b.ListItem.Id,f=new SP.ClientContext.get_current,g=f.get_web(),h=g.get_lists().getById(c);b._folder=h.getItemById(e),b._folder.set_item("FileLeafRef",a),b._folder.update(),f.load(b._folder),f.executeQueryAsync(function(){b.Name=a,d.resolve()},function(a,b){var c={Code:b.get_errorCode(),Details:b.get_errorDetails(),TypeName:b.get_errorTypeName(),Value:b.get_errorValue(),message:b.get_message(),request:b.get_request(),stackTrace:b.get_stackTrace()};d.reject(c)})}),d.promise},d.prototype.removeFolder=function(a,b){var d,e=this,f=c.defer();if("string"==typeof a){var g=a;d=e.ServerRelativeUrl+"/"+g}else"object"==typeof a&&(d=a.ServerRelativeUrl);var h=e.web.apiUrl+"/GetFolderByServerRelativeUrl('"+d+"')/recycle";b===!0&&(h=h.rtrim("/recycle"));var i=new SP.RequestExecutor(e.web.url);return i.executeAsync({url:h,method:"POST",success:function(){f.resolve()},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},d}]),angular.module("ngSharePoint").factory("SPGroup",["$q","SPCache","SPUser",function(a,b,c){"use strict";var d=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPGroup constructor.";if(void 0===b)throw"@groupName parameter not specified in SPGroup constructor.";this.web=a,this.apiUrl="number"==typeof b?"/sitegroups/GetById('"+b+"')":"/sitegroups/GetByName('"+b+"')",this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return d.prototype.getProperties=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f="Owner";return b?b.$expand=f+(b.$expand?", "+b.$expand:""):b={$expand:f},e.executeAsync({url:c.apiUrl+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(c,b),d.resolve(c)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},d.prototype.getUsers=function(){var b=this,d=a.defer();if(void 0!==this.Users)d.resolve(this.Users);else{var e=new SP.RequestExecutor(b.web.url);e.executeAsync({url:b.apiUrl+"/Users",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a),f=[];angular.forEach(e,function(a){f.push(new c(b.web,a.Id,a))}),b.Users=f,d.resolve(f)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},d}]),angular.module("ngSharePoint").factory("SPList",["$q","SPCache","SPFolder","SPListItem","SPContentType",function(a,b,c,d,e){"use strict";var f=function(a,c,d){if(void 0===a)throw"@web parameter not specified in SPList constructor.";if(void 0===c)throw"@listName parameter not specified in SPList constructor.";this.web=a,this.listName=c.trim().ltrim("{").rtrim("}"),this.apiUrl=utils.isGuid(this.listName)?"/Lists(guid'"+this.listName+"')":"userinfolist"==this.listName.toLowerCase()?"/SiteUserInfoList":"/Lists/GetByTitle('"+this.listName+"')",this.apiUrl=a.apiUrl+this.apiUrl,this.Fields=b.getCacheValue("SPListFieldsCache",this.apiUrl),void 0!==d&&(utils.cleanDeferredProperties(d),angular.extend(this,d))};return f.prototype.getListItemEntityTypeFullName=function(){var b=this,c=a.defer();return this.ListItemEntityTypeFullName?c.resolve(this.ListItemEntityTypeFullName):b.getProperties().then(function(){c.resolve(b.ListItemEntityTypeFullName)}),c.promise},f.prototype.getProperties=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f="Views";return b?b.$expand=f+(b.$expand?", "+b.$expand:""):b={$expand:f},e.executeAsync({url:c.apiUrl+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(c,b),d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},f.prototype.updateProperties=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f={__metadata:{type:"SP.List"}};angular.extend(f,b);var g={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*"},h=document.getElementById("__REQUESTDIGEST");return null!==h&&(g["X-RequestDigest"]=h.value),e.executeAsync({url:c.apiUrl,method:"POST",body:angular.toJson(f),headers:g,success:function(a){utils.parseSPResponse(a);angular.extend(c,b),d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},f.prototype.getFields=function(){var c=this,d=a.defer();if(void 0!==this.Fields)d.resolve(this.Fields);else{var e=new SP.RequestExecutor(c.web.url);e.executeAsync({url:c.apiUrl+"/Fields",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a),f={};angular.forEach(e,function(a){f[a.InternalName]=a}),c.Fields=f,b.setCacheValue("SPListFieldsCache",c.apiUrl,f),d.resolve(f)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},f.prototype.getContentTypes=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.web.url);return d.executeAsync({url:b.apiUrl+"/ContentTypes",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a),f=[];angular.forEach(d,function(a){f.push(new e(b,a.StringId,a))}),b.ContentTypes=f,c.resolve(f)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},f.prototype.getContentType=function(b){var c=this,d=a.defer();return c.getContentTypes().then(function(){var a=c.ContentTypes[0];angular.forEach(c.ContentTypes,function(c){c.Id===b&&(a=c)}),d.resolve(a)}),d.promise},f.prototype.getSchema=function(){return this.getContentType().then(function(a){return a.getFields()})},f.prototype.getRootFolder=function(){var b=this,d=a.defer();if(void 0!==this.RootFolder)d.resolve(this.RootFolder);else{var e=new SP.RequestExecutor(b.web.url);e.executeAsync({url:b.apiUrl+"/RootFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var e=utils.parseSPResponse(a);this.RootFolder=new c(b.web,e.ServerRelativeUrl,e),this.RootFolder.List=b,d.resolve(this.RootFolder)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}return d.promise},f.prototype.getListItems=function(b,c){var e=this,f=a.defer(),g=new SP.RequestExecutor(e.web.url),h="ContentType, File, File/ParentFolder, Folder, Folder/ParentFolder",i="";return void 0===this.$skiptoken||c?(b?b.$expand=h+(b.$expand?", "+b.$expand:""):b={$expand:h},i=utils.parseQuery(b)):i="?"+this.$skiptoken,g.executeAsync({url:e.apiUrl+"/Items"+i,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a),c=[];if(angular.forEach(b,function(a){var b=new d(e,a);c.push(b)}),204!=a.statusCode&&a.body){var g=angular.fromJson(a.body||'{ "d": {} }').d;g.__next&&(e.$skiptoken="$"+g.__next.substring(g.__next.indexOf("skiptoken")))}f.resolve(c)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},f.prototype.getItemById=function(b,c){var e=this,f=a.defer(),g=new SP.RequestExecutor(e.web.url),h="ContentType, File, File/ParentFolder, Folder, Folder/ParentFolder",i={$expand:h+(c?", "+c:"")};return g.executeAsync({url:e.apiUrl+"/getItemById("+b+")"+utils.parseQuery(i),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a),c=new d(e,b);f.resolve(c)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});f.reject(d)}}),f.promise},f.prototype.getItemQueryById=function(b,c){var d=this,e=a.defer(),f=new SP.RequestExecutor(d.web.url);return f.executeAsync({url:d.apiUrl+"/getItemById("+b+")/"+c.ltrim("/"),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}}),e.promise},f.prototype.createItem=function(b){var c=this,d=a.defer();return c.getListItemEntityTypeFullName().then(function(a){var e=new SP.RequestExecutor(c.web.url),f={__metadata:{type:a}};angular.extend(f,b);var g={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},h=document.getElementById("__REQUESTDIGEST");null!==h&&(g["X-RequestDigest"]=h.value),e.executeAsync({url:c.apiUrl+"/items",method:"POST",body:angular.toJson(f),headers:g,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}})}),d.promise},f.prototype.updateItem=function(b,c){var d=this,e=a.defer();return d.getListItemEntityTypeFullName().then(function(a){var f=new SP.RequestExecutor(d.web.url),g={__metadata:{type:a}};angular.extend(g,c);var h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value),f.executeAsync({url:d.apiUrl+"/items("+b+")",method:"POST",body:angular.toJson(g),headers:h,success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},f.prototype.deleteItem=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url),f={Accept:"application/json; odata=verbose","X-HTTP-Method":"DELETE","IF-MATCH":"*"},g=document.getElementById("__REQUESTDIGEST");return null!==g&&(f["X-RequestDigest"]=g.value),e.executeAsync({url:c.apiUrl+"/items("+b+")",method:"POST",headers:f,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},f}]),angular.module("ngSharePoint").factory("SPListItem",["$q","SPUtils",function(a,b){"use strict";var c=function(a,b){if(void 0===a)throw"Required @list parameter not specified in SPListItem constructor.";if(this.list=a,void 0!==b)if("object"==typeof b&&void 0===b.concat)utils.cleanDeferredProperties(b),angular.extend(this,b);else{if(isNaN(parseInt(b)))throw"Incorrect @data parameter in SPListItem constructor.";this.Id=b}};return c.prototype.isNew=function(){return void 0===this.Id},c.prototype.getAPIUrl=function(){var a=this.list.apiUrl+"/Items";return void 0!==this.Id&&(a+="("+this.Id+")"),a},c.prototype.getProperties=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl(),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);if(utils.cleanDeferredProperties(d),angular.extend(b,d),0===b.list.BaseType)switch(d.FileSystemObjectType){case 0:b.getFile().then(function(){c.resolve(d)});break;case 1:b.getFolder().then(function(){c.resolve(d)});break;default:c.resolve(d)}else c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getFile=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl()+"/File?$expand=ParentFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getFolder=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return d.executeAsync({url:b.getAPIUrl()+"/Folder?$expand=ParentFolder",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.getAttachments=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url);return this.isNew()?(b.AttachmentFiles=[],b.attachments={add:[],remove:[]},c.resolve(b.AttachmentFiles)):d.executeAsync({url:b.getAPIUrl()+"/AttachmentFiles",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var d=utils.parseSPResponse(a);b.AttachmentFiles=d,b.attachments={add:[],remove:[]},c.resolve(d)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c.prototype.addAttachment=function(c){var d=this,e=a.defer(),f=new SP.RequestExecutor(d.list.web.url);return b.getFileBinary(c).then(function(a){f.executeAsync({url:d.getAPIUrl()+"/AttachmentFiles/add(FileName='"+c.name+"')",method:"POST",binaryStringRequestBody:!0,body:a,state:"Update",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},c.prototype.removeAttachment=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.list.web.url),f={Accept:"application/json; odata=verbose","X-HTTP-Method":"DELETE"},g=document.getElementById("__REQUESTDIGEST");return null!==g&&(f["X-RequestDigest"]=g.value),e.executeAsync({url:c.getAPIUrl()+"/AttachmentFiles('"+b+"')",method:"POST",headers:f,success:function(a){var b=utils.parseSPResponse(a);d.resolve(b)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},c.prototype.processAttachments=function(){var b=this,c=a.defer();if(void 0!==this.attachments){var d=[];void 0!==this.attachments.add&&this.attachments.add.length>0&&angular.forEach(this.attachments.add,function(a){d.push(b.addAttachment(a))}),void 0!==this.attachments.remove&&this.attachments.remove.length>0&&angular.forEach(this.attachments.remove,function(a){d.push(b.removeAttachment(a))}),a.all(d).then(function(){b.attachments.add=[],b.attachments.remove=[],c.resolve()})}else c.resolve();return c.promise},c.prototype.save=function(){var b=this,c=a.defer();return b.list.getListItemEntityTypeFullName().then(function(a){var d=new SP.RequestExecutor(b.list.web.url),e={__metadata:{type:a}},f=angular.extend({},b);delete f.list,delete f.apiUrl;for(var g in f)"function"==typeof f[g]&&delete f[g];angular.forEach(b.list.Fields,function(a){("Computed"===a.TypeAsString||a.ReadOnlyField)&&delete f[a.InternalName]}),delete f.attachments,delete f.AttachmentFiles,angular.extend(e,f),console.log(f,angular.toJson(f));var h={Accept:"application/json; odata=verbose","content-type":"application/json;odata=verbose"},i=document.getElementById("__REQUESTDIGEST");null!==i&&(h["X-RequestDigest"]=i.value),b.isNew()||angular.extend(h,{"X-HTTP-Method":"MERGE","IF-MATCH":"*"}),d.executeAsync({url:b.getAPIUrl(),method:"POST",body:angular.toJson(e),headers:h,success:function(a){var d=utils.parseSPResponse(a);utils.cleanDeferredProperties(d),angular.extend(b,d),b.processAttachments().then(function(){c.resolve(d)},function(){c.resolve(d)})},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}})}),c.promise},c.prototype.remove=function(){var b=this,c=a.defer(),d=new SP.RequestExecutor(b.list.web.url),e={Accept:"application/json; odata=verbose","X-HTTP-Method":"DELETE","IF-MATCH":"*"},f=document.getElementById("__REQUESTDIGEST");return null!==f&&(e["X-RequestDigest"]=f.value),d.executeAsync({url:b.getAPIUrl(),method:"POST",headers:e,success:function(a){var b=utils.parseSPResponse(a);c.resolve(b)},error:function(a,b,d){var e=utils.parseError({data:a,errorCode:b,errorMessage:d});c.reject(e)}}),c.promise},c}]),angular.module("ngSharePoint").factory("SPObjectProvider",["$injector",function(a){"use strict";return{getSPWeb:function(b){var c=a.get("SPWeb");return new c(b)},getSPList:function(b,c,d){var e=a.get("SPList");return new e(b,c,d)},getSPListItem:function(b,c){var d=a.get("SPListItem");return new d(b,c)},getSPFolder:function(b,c,d){var e=a.get("SPFolder");return new e(b,c,d)},getSPFile:function(b,c,d){var e=a.get("SPFile");return new e(b,c,d)},getSPGroup:function(b,c,d){var e=a.get("SPGroup");return new e(b,c,d)},getSPUser:function(b,c,d){var e=a.get("SPUser");return new e(b,c,d)}}}]),function(){"use strict";function a(a){function b(){y=x.get_ribbon(),z=x.get_commandDispatcher(),A.resolve()}function c(){return SP.SOD.executeOrDelayUntilScriptLoaded(function(){x=SP.Ribbon.PageManager.get_instance(),x.add_ribbonInited(b);try{y=x.get_ribbon()}catch(a){}y?b():"function"==typeof _ribbonStartInit&&_ribbonStartInit(_ribbon.initialTabId,!1,null)},"sp.ribbon.js"),A.promise}function d(a,b,c,d,e,f,g){var h=new CUI.Tab(y,a,b,c,d,e||!1,f||"",g||null);return y.addChild(h),y.refresh(),h}function e(a){var b=y.getChild(a);return null===b&&(b=y.getChildByTitle(a)),b}function f(){var a=y.getChild("Ribbon.ListForm.Edit");return null===a&&(a=y.getChild("Ribbon.DocLibListForm.Edit")),null===a&&(a=y.getChild("Ribbon.PostListForm.Edit")),a}function g(){return y.getChild(y.get_selectedTabId())}function h(a,b,c,d,e){var f,g,h,k=y.getChild(a);return null!==k&&(f=new CUI.Group(y,b,c,d,e,null),k.addChild(f),g=i(f),h=j(g),y.refresh()),{group:f,layout:g,section:h}}function i(a){var b=a.get_id()+".Layout",c=new CUI.Layout(y,b,b);return a.addChild(c),c}function j(a){var b=a.get_id()+".Section",c=new CUI.Section(y,b,2,"Top");return a.addChild(c),c}function k(a,b,c,d,e){var f=new CUI.ControlProperties;return f.Command=a,f.Id=a+".ControlProperties",f.TemplateAlias="o1",f.Image32by32=e||"_layouts/15/images/placeholder32x32.png",f.ToolTipTitle=c||b,f.ToolTipDescription=d||c||"",f.LabelText=b,f}function l(a,b,c,d,e,f){var g=new CUI.Controls.Button(y,b,k(b,c,d,e,f)),h=g.createComponentForDisplayMode("Large"),i=a.getRow(1);i.addChild(h)}function m(a){if(!angular.isArray(a)){if(!angular.isString(a))return!1;a=[a]}return a}function n(a,b){var c=m(b),d=x.getPageComponentById(a);return d&&c?(z.registerMultipleCommandHandler(d,c),y.refresh(),!0):!1}function o(a,b){var c=m(b),d=x.getPageComponentById(a);return d&&c?(z.unregisterMultipleCommandHandler(d,c),y.refresh(),!0):!1}function p(a){var b={},c=a.$6_0;if(c)for(var d=c.getEnumerator();d.moveNext();){var e=d.get_current();b[e.get_id()]=e,angular.extend(b[e.get_id()],p(e))}return b}function q(){var a=y.get_selectedTabId(),b=p(y);return y.selectTabById(a),b}function r(a,b){var c,f,i=a||"Toolbar "+t(),j="Ribbon.ngSharePoint."+i.replace(/ /g,"-"),k=j+".Command";if(b){if(c=e(b),null===c){var l="Ribbon.ngSharePoint."+b.replace(/ /g,"-");c=d(l,b,"",l+".Command"),v(l+".Command",angular.noop,!0)}}else c=g();return f=h(c.get_id(),j,i,k),v(k,angular.noop,!0),f}function s(a,b,c,d,e,f,g){var h=a.group.get_id()+".Button-"+u();l(a.section,h,b,d,e,g),a.group.selectLayout(a.layout.get_id()),v(h,c,f)}function t(){return B++}function u(){return C++}function v(a,b,c){var d=x.getPageComponentById("ngSharePointPageComponent");d||(d=w()),d.addCommand(a,b,c)&&n(d.getId(),a)}function w(){Type.registerNamespace("ngSharePointPageComponent"),ngSharePointPageComponent=function(){ngSharePointPageComponent.initializeBase(this)},ngSharePointPageComponent.initializePageComponent=function(){var a=ngSharePointPageComponent.get_instance();return x.addPageComponent(a),a},ngSharePointPageComponent.get_instance=function(){return angular.isDefined(ngSharePointPageComponent.instance)||(ngSharePointPageComponent.instance=new ngSharePointPageComponent),ngSharePointPageComponent.instance},ngSharePointPageComponent.prototype={init:function(){this._commands=[],this._handledCommands={}},getGlobalCommands:function(){return this._commands},getFocusedCommands:function(){return[]},handleCommand:function(a,b,c){return this._handledCommands[a].handle(a,b,c)},canHandleCommand:function(a){var b=this._handledCommands[a].enabled;return angular.isFunction(b)?b():b},isFocusable:function(){return!1},receiveFocus:function(){return!0},yieldFocus:function(){return!1},getId:function(){return"ngSharePointPageComponent"},addCommand:function(a,b,c){return CUI.ScriptUtility.isNullOrUndefined(a)||CUI.ScriptUtility.isNullOrUndefined(b)||Array.contains(this._commands,a)?!1:(this._handledCommands[a]={handle:b,enabled:c||!0},this._commands.push(a),!0)}},o("WebPartWPQ2","Ribbon.ListForm.Edit.Commit.Publish"),o("WebPartWPQ2","Ribbon.ListForm.Edit.Commit.Cancel"),o("WebPartWPQ2","Ribbon.ListForm.Edit.Actions.AttachFile"),ngSharePointPageComponent.registerClass("ngSharePointPageComponent",CUI.Page.PageComponent);var a=ngSharePointPageComponent.initializePageComponent();return a}var x,y,z,A=a.defer(),B=1,C=1,D={ready:c,addTab:d,getTab:e,getEditTab:f,getDefaultTab:g,addGroupToTab:h,addLayoutToGroup:i,addSectionToLayout:j,addButtonToSection:l,registerComponentCommands:n,unregisterComponentCommands:o,getStructure:q,createToolbar:r,addButtonToToolbar:s,registerCommand:v};return D}angular.module("ngSharePoint").factory("SPRibbon",a),a.$inject=["$q","$timeout"]}(),angular.module("ngSharePoint").factory("SPUser",["$q",function(a){var b=function(a,b,c){if(void 0===a)throw"@web parameter not specified in SPUser constructor.";if(void 0===b)throw"@userId parameter not specified in SPUser constructor.";this.web=a,"number"==typeof b?this.apiUrl="/SiteUserInfoList/getItemById('"+b+"')":"string"==typeof b&&(this.apiUrl="/siteusers/getByLoginName(@v)?@v='"+b+"'"),this.apiUrl=a.apiUrl+this.apiUrl,void 0!==c&&(utils.cleanDeferredProperties(c),angular.extend(this,c))};return b.prototype.getProperties=function(b){var c=this,d=a.defer(),e=new SP.RequestExecutor(c.web.url);return e.executeAsync({url:c.apiUrl+utils.parseQuery(b),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(c,b),d.resolve(c)},error:function(a,b,c){var e=utils.parseError({data:a,errorCode:b,errorMessage:c});d.reject(e)}}),d.promise},b}]),angular.module("ngSharePoint").factory("SPUtils",["SPConfig","$q","$http","ODataParserProvider",function(a,b,c,d){"use strict";var e=!1;return{inDesignMode:function(){var a=window.g_disableCheckoutInEditMode,b=document.forms[MSOWebPartPageFormName],c=b.MSOLayout_InDesignMode||b._wikiPageMode;return!!(a||c&&c.value)},SharePointReady:function(){var c=b.defer(),d=this;return e?c.resolve():SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){var f=[],g=[];f.push(d.loadScript("SP.RequestExecutor.js","SP.RequestExecutor")),a.options.loadMinimalSharePointInfraestructure===!1&&(f.push(d.loadScript("SP.UserProfiles.js","SP.UserProfiles")),f.push(d.loadScript("datepicker.debug.js","clickDatePicker")),f.push(d.loadScript("clienttemplates.js","SPClientTemplates")),f.push(d.loadScript("clientforms.js","SPClientForms")),f.push(d.loadScript("clientpeoplepicker.js","SPClientPeoplePicker")),f.push(d.loadScript("autofill.js","SPClientAutoFill")),f.push(d.loadScript(_spPageContextInfo.currentLanguage+"/initstrings.js","Strings")),f.push(d.loadScript(_spPageContextInfo.currentLanguage+"/strings.js","Strings"))),b.all(f).then(function(){(a.options.loadMinimalSharePointInfraestructure===!1||a.options.forceLoadResources)&&angular.forEach(a.options.resourceFiles.get(),function(a){-1==a.indexOf(".resx")&&(a+=".resx"),g.push(d.loadResourceFile(a))}),b.all(g).then(function(){e=!0,c.resolve()},function(a){console.error("Error loading SharePoint resources dependences.",a),c.reject(a)})},function(a){console.error("Error loading SharePoint scripts dependences.",a),c.reject(a)})}),c.promise},loadResourceFile:function(d){var e,f=b.defer(),g=d.lastIndexOf(".resx"),h=d.substr(0,-1!=g?g:d.length),i="?name="+h+"&culture="+STSHtmlEncode(Strings.STS.L_CurrentUICulture_Name||_spPageContextInfo.currentUICultureName);return e=a.options.force15LayoutsDirectory?"/_layouts/15/ScriptResx.ashx"+i:SP.Utilities.Utility.getLayoutsPageUrl("ScriptResx.ashx")+i,c.get(e).success(function(a){window.Resources=window.Resources||{},a=a.replace(/align - right|align-right/g,"align_right"),a=a.replace(/e - mail|e-mail/g,"email"),a=a.replace(/e - Mail|e-Mail/g,"email"),a=a.replace(/tty - TDD|tty-TDD/g,"tty_TDD");try{var b=eval;b(a),window.Res=window.Res||void 0,void 0!==window.Res&&(window.Resources[h]=window.Res)}catch(c){console.error(c)}f.resolve()}).error(function(){f.resolve()}),f.promise},loadScript:function(c,d){var e=b.defer();return a.options.force15LayoutsDirectory?SP.SOD.registerSod(c,"/_layouts/15/"+c):SP.SOD.registerSod(c,SP.Utilities.Utility.getLayoutsPageUrl(c)),EnsureScriptFunc(c,d,function(){e.resolve()}),e.promise},generateCamlQuery:function(a,b){var c,e="";if(void 0===a)c=SP.CamlQuery.createAllItemsQuery();else{if("string"==typeof a)e=a;else if("object"==typeof a){var f=d.ODataParser(b);f.parseExpression(a),e=f.getCAMLQuery()}if(e&&(c=new SP.CamlQuery,c.set_viewXml(e)),a.pagingInfo){var g=new SP.ListItemCollectionPosition;g.set_pagingInfo(a.pagingInfo),c.set_listItemCollectionPosition(g)}}return c},getRegionalSettings:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=b.get_web(),d=c.get_regionalSettings(),e=d.get_timeZone();b.load(d),b.load(e),b.executeQueryAsync(function(){d.TimeZone=e,a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},refreshDigestValue:function(){var a=b.defer();return c({url:_spPageContextInfo.webAbsoluteUrl+"/_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"}}).then(function(b){var c=document.getElementById("__REQUESTDIGEST");null!==c&&(c.value=b.data.d.GetContextWebInformation.FormDigestValue),a.resolve(b.data.d.GetContextWebInformation.FormDigestValue)},function(b){console.log(b.data),a.reject(b.data)}),a.promise},getCurrentUser:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=b.get_web(),d=c.get_currentUser();b.load(d),b.executeQueryAsync(function(){a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},getUserId:function(a){var c=b.defer(),d=new SP.ClientContext.get_current,e=d.get_web().ensureUser(a);return d.load(e),d.executeQueryAsync(function(){c.resolve(e.get_id())},function(a,b){c.reject({sender:a,args:b})}),c.promise},getUserRegionalSettings:function(){var a=b.defer();return this.SharePointReady().then(function(){var b=new SP.ClientContext.get_current,c=new SP.UserProfiles.PeopleManager(b),d=c.getMyProperties();b.load(d),b.executeQueryAsync(function(){a.resolve(d)},function(b,c){a.reject({sender:b,args:c})})}),a.promise},parseXmlString:function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0===a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getCurrentUserLCID:function(){var a=b.defer(),d=_spPageContextInfo.webServerRelativeUrl.rtrim("/")+"/_layouts/15/regionalsetng.aspx?Type=User";return c.get(d).success(function(b){var c,d,e=angular.element(b);if(angular.forEach(e,function(a){a.tagName&&"form"===a.tagName.toLowerCase()&&(c=a)}),void 0!==c){var f=c.querySelector("#ctl00_PlaceHolderMain_ctl02_ctl01_DdlwebLCID"),g=f.querySelector("[selected]");d=g.value}a.resolve(d)}),a.promise},getWebById:function(a){var c=b.defer();
return this.SharePointReady().then(function(){var b=new SP.ClientContext,d=b.get_site(),e=d.openWebById(a.ltrim("{").rtrim("}"));b.load(e,"ServerRelativeUrl"),b.executeQueryAsync(function(){c.resolve(e)},function(a,b){c.reject({sender:a,args:b})})}),c.promise},getFileBinary:function(a){var c=b.defer(),d=new FileReader;return d.onload=function(a){for(var b=a.target.result,d=new Uint8Array(b),e="",f=0;f<d.length;f++)e+=String.fromCharCode(d[f]);c.resolve(e)},d.onerror=function(a){c.reject(a.target.error)},d.readAsArrayBuffer(a),c.promise}}}]),angular.module("ngSharePoint").factory("SPWeb",["$q","SPUtils","SPList","SPUser",function(a,b,c,d){"use strict";var e=function(a){return this.url=a,this.getApiUrl()};return e.prototype.getApiUrl=function(){var c=this,d=a.defer();return void 0!==this.apiUrl?d.resolve(this):void 0===this.url?(this.url=_spPageContextInfo.webServerRelativeUrl,this.apiUrl=this.url.rtrim("/")+"/_api/web",d.resolve(this)):(this.url=this.url.trim().ltrim("{").rtrim("}"),utils.isGuid(this.url)?b.getWebById(this.url).then(function(a){c.url=a.get_serverRelativeUrl(),c.apiUrl=c.url.rtrim("/")+"/_api/web",d.resolve(c)}):(this.apiUrl=this.url.rtrim("/")+"/_api/web",d.resolve(this))),d.promise},e.prototype.getProperties=function(c){var d=this,e=a.defer(),f="RegionalSettings/TimeZone";return b.SharePointReady().then(function(){var a=new SP.RequestExecutor(d.url);c?c.$expand=f+(c.$expand?", "+c.$expand:""):c={$expand:f},a.executeAsync({url:d.apiUrl+utils.parseQuery(c),method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a);utils.cleanDeferredProperties(b),angular.extend(d,b),e.resolve(b)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},e.prototype.getLists=function(){var d=this,e=a.defer();return b.SharePointReady().then(function(){var a=new SP.RequestExecutor(d.url);a.executeAsync({url:d.apiUrl+"/Lists",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(a){var b=utils.parseSPResponse(a),f=[];angular.forEach(b,function(a){var b=new c(d,a.Id,a);f.push(b)}),e.resolve(f)},error:function(a,b,c){var d=utils.parseError({data:a,errorCode:b,errorMessage:c});e.reject(d)}})}),e.promise},e.prototype.getList=function(b){var d=a.defer();return d.resolve(new c(this,b)),d.promise},e.prototype.getCurrentUser=function(){var b=a.defer(),c=this;return void 0!==this.currentUser?b.resolve(this.currentUser):this.getUserById(_spPageContextInfo.userId).then(function(a){c.currentUser=a,b.resolve(a)}),b.promise},e.prototype.getUserById=function(b){var c=a.defer();return new d(this,b).getProperties().then(function(a){c.resolve(a)}),c.promise},e.staticMethod=function(){},e}]),String.prototype.ltrim=function(a){return this.replace(new RegExp("^"+a),"")},String.prototype.rtrim=function(a){return this.replace(new RegExp(a+"*$"),"")},String.prototype.trimS=function(a){return this.replace(new RegExp("^"+a),"").replace(new RegExp(a+"*$"),"")};var utils={isGuid:function(a){var b=new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$");return b.test((a||"").trim().ltrim("{").rtrim("}"))},getQueryStringParameter:function(a){var b=window.location.search.split("?");if(b.length>1){b=b[1].split("&");for(var c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]==a)return d[1]}}},getQueryStringParamByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null!==d?decodeURIComponent(d[1].replace(/\+/g," ")):void 0},parseQuery:function(a){if(void 0===a)return"";var b="";return angular.forEach(a,function(a,c){var d=c+"="+a;"restfunc"===c.toLowerCase()&&(d="$"+a),b+=(""===b?"?":"&")+d}),b},parseError:function(a){var b={data:a.data,code:a.errorCode,message:a.errorMessage};try{var c=a.data.body.rtrim("\x00");if(-1!=a.data.contentType.indexOf("application/json")){var d=angular.fromJson(c).error;b.code=d.code,b.message=d.message.value}else b.message=c}catch(e){}return b},parseSPResponse:function(a){var b={};if(204!=a.statusCode&&(b=angular.fromJson(a.body||'{ "d": {} }').d,b.results&&(b=b.results)),a.headers["X-REQUESTDIGEST"]){var c=document.getElementById("__REQUESTDIGEST");null!==c&&(c.value=a.headers["X-REQUESTDIGEST"])}return b},cleanDeferredProperties:function(a){var b=a;angular.forEach(a,function(a,c){"object"==typeof a&&null!==a&&"__parent"!==c&&(a.__deferred?delete b[c]:utils.cleanDeferredProperties(a))})},getFunctionParameterNames:function(a){var b=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,d=a.toString().replace(b,""),e=d.slice(d.indexOf("(")+1,d.indexOf(")")).match(c);return e||[]}};